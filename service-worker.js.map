{
  "version": 3,
  "sources": ["../src/libraries/path.ts", "../src/libraries/dexie.js", "../src/utils/index.ts", "../src/database/worker.ts", "../src/service-worker.ts"],
  "sourcesContent": ["/**\r\nMIT License\r\n\r\nCopyright (c) 2015 Thomas Roch\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n */\r\n\r\ntype arrayFormat = \"none\" | \"brackets\" | \"index\";\r\ntype booleanFormat = \"none\" | \"string\" | \"unicode\" | \"empty-true\";\r\ntype nullFormat = \"default\" | \"string\" | \"hidden\";\r\n\r\ninterface IOptions {\r\n\tarrayFormat?: arrayFormat;\r\n\tbooleanFormat?: booleanFormat;\r\n\tnullFormat?: nullFormat;\r\n}\r\n\r\ninterface IFinalOptions {\r\n\tarrayFormat: arrayFormat;\r\n\tbooleanFormat: booleanFormat;\r\n\tnullFormat: nullFormat;\r\n}\r\n\r\nconst makeOptions = (opts: IOptions = {}): IFinalOptions => ({\r\n\tarrayFormat: opts.arrayFormat || \"none\",\r\n\tbooleanFormat: opts.booleanFormat || \"none\",\r\n\tnullFormat: opts.nullFormat || \"default\",\r\n});\r\n\r\nconst encodeValue = (value: any): string => encodeURIComponent(value);\r\n\r\nconst decodeValue = (value: string): string =>\r\n\tdecodeURIComponent(value.replace(/\\+/g, \" \"));\r\n\r\nconst encodeBoolean = (\r\n\tname: string,\r\n\tvalue: boolean,\r\n\topts: IFinalOptions,\r\n): string => {\r\n\tif (opts.booleanFormat === \"empty-true\" && value) {\r\n\t\treturn name;\r\n\t}\r\n\r\n\tlet encodedValue: string;\r\n\r\n\tif (opts.booleanFormat === \"unicode\") {\r\n\t\tencodedValue = value ? \"\u2713\" : \"\u2717\";\r\n\t} else {\r\n\t\tencodedValue = value.toString();\r\n\t}\r\n\r\n\treturn `${name}=${encodedValue}`;\r\n};\r\n\r\nconst encodeNull = (name: string, opts: IFinalOptions): string => {\r\n\tif (opts.nullFormat === \"hidden\") {\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\tif (opts.nullFormat === \"string\") {\r\n\t\treturn `${name}=null`;\r\n\t}\r\n\r\n\treturn name;\r\n};\r\n\r\ntype nameEncoder = (val: string, index: number) => string;\r\n\r\nconst getNameEncoder = (opts: IFinalOptions): nameEncoder => {\r\n\tif (opts.arrayFormat === \"index\") {\r\n\t\treturn (name: string, index: number): string => `${name}[${index}]`;\r\n\t}\r\n\r\n\tif (opts.arrayFormat === \"brackets\") {\r\n\t\treturn (name: string): string => `${name}[]`;\r\n\t}\r\n\r\n\treturn (name: string): string => name;\r\n};\r\n\r\nconst encodeArray = (name: string, arr: any[], opts: IFinalOptions): string => {\r\n\tconst encodeName = getNameEncoder(opts);\r\n\r\n\treturn arr\r\n\t\t.map((val, index) => `${encodeName(name, index)}=${encodeValue(val)}`)\r\n\t\t.join(\"&\");\r\n};\r\n\r\nconst encode = (name: string, value: any, opts: IFinalOptions): string => {\r\n\tconst encodedName = encodeValue(name);\r\n\r\n\tif (value === null) {\r\n\t\treturn encodeNull(encodedName, opts);\r\n\t}\r\n\r\n\tif (typeof value === \"boolean\") {\r\n\t\treturn encodeBoolean(encodedName, value, opts);\r\n\t}\r\n\r\n\tif (Array.isArray(value)) {\r\n\t\treturn encodeArray(encodedName, value, opts);\r\n\t}\r\n\r\n\treturn `${encodedName}=${encodeValue(value)}`;\r\n};\r\n\r\nconst decode = (value: any, opts: IFinalOptions): boolean | string | null => {\r\n\tif (value === undefined) {\r\n\t\treturn opts.booleanFormat === \"empty-true\" ? true : null;\r\n\t}\r\n\r\n\tif (opts.booleanFormat === \"string\") {\r\n\t\tif (value === \"true\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (value === \"false\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\tif (opts.nullFormat === \"string\") {\r\n\t\tif (value === \"null\") {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tconst decodedValue = decodeValue(value);\r\n\r\n\tif (opts.booleanFormat === \"unicode\") {\r\n\t\tif (decodedValue === \"\u2713\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (decodedValue === \"\u2717\") {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\treturn decodedValue;\r\n};\r\n\r\nconst getSearch = (path: string): string => {\r\n\tconst pos = path.indexOf(\"?\");\r\n\r\n\tif (pos === -1) {\r\n\t\treturn path;\r\n\t}\r\n\r\n\treturn path.slice(pos + 1);\r\n};\r\n\r\nconst isSerializable = (val: any): boolean => val !== undefined;\r\n\r\ninterface IParsedName {\r\n\thasBrackets: boolean;\r\n\tname: string;\r\n}\r\n\r\nconst parseName = (name: string): IParsedName => {\r\n\tconst bracketPosition = name.indexOf(\"[\");\r\n\tconst hasBrackets = bracketPosition !== -1;\r\n\r\n\treturn {\r\n\t\thasBrackets,\r\n\t\tname: hasBrackets ? name.slice(0, bracketPosition) : name,\r\n\t};\r\n};\r\n\r\ntype SearchParams = Record<\r\n\tstring,\r\n\tstring | boolean | null | Array<string | boolean | null> | undefined\r\n>;\r\n\r\n/**\r\n * Parse a querystring and return an object of parameters\r\n */\r\nconst parseQueryParams = <T extends Record<string, any> = SearchParams>(\r\n\tpath: string,\r\n\topts?: IOptions,\r\n): T => {\r\n\tconst options = makeOptions(opts);\r\n\r\n\treturn getSearch(path)\r\n\t\t.split(\"&\")\r\n\t\t.reduce<Record<string, any>>((params, param) => {\r\n\t\t\tconst [rawName, value] = param.split(\"=\");\r\n\t\t\tconst { hasBrackets, name } = parseName(rawName);\r\n\t\t\tconst decodedName = decodeValue(name);\r\n\t\t\tconst currentValue = params[name];\r\n\t\t\tconst decodedValue = decode(value, options);\r\n\r\n\t\t\tif (currentValue === undefined) {\r\n\t\t\t\tparams[decodedName] = hasBrackets ? [decodedValue] : decodedValue;\r\n\t\t\t} else {\r\n\t\t\t\tparams[decodedName] = (\r\n\t\t\t\t\tArray.isArray(currentValue) ? currentValue : [currentValue]\r\n\t\t\t\t).concat(decodedValue);\r\n\t\t\t}\r\n\r\n\t\t\treturn params;\r\n\t\t}, {}) as T;\r\n};\r\n\r\n/**\r\n * Build a querystring from an object of parameters\r\n */\r\nconst buildQueryParams = <T extends Record<string, any> = SearchParams>(\r\n\tparams: T,\r\n\topts?: IOptions,\r\n): string => {\r\n\tconst options = makeOptions(opts);\r\n\r\n\treturn Object.keys(params)\r\n\t\t.filter((paramName) => isSerializable(params[paramName]))\r\n\t\t.map((paramName) => encode(paramName, params[paramName], options))\r\n\t\t.filter(Boolean)\r\n\t\t.join(\"&\");\r\n};\r\n\r\n/**\r\n * We encode using encodeURIComponent but we want to\r\n * preserver certain characters which are commonly used\r\n * (sub delimiters and ':')\r\n *\r\n * https://www.ietf.org/rfc/rfc3986.txt\r\n *\r\n * reserved    = gen-delims / sub-delims\r\n *\r\n * gen-delims  = \":\" / \"/\" / \"?\" / \"#\" / \"[\" / \"]\" / \"@\"\r\n *\r\n * sub-delims  = \"!\" / \"$\" / \"&\" / \"'\" / \"(\" / \")\"\r\n              / \"*\" / \"+\" / \",\" / \";\" / \"=\"\r\n */\r\n\r\nconst excludeSubDelimiters = /[^!$'()*+,;|:]/g;\r\n\r\nexport type URLParamsEncodingType =\r\n\t| \"default\"\r\n\t| \"uri\"\r\n\t| \"uriComponent\"\r\n\t| \"none\"\r\n\t| \"legacy\";\r\n\r\nconst encodeURIComponentExcludingSubDelims = (segment: string): string =>\r\n\tsegment.replace(excludeSubDelimiters, (match) => encodeURIComponent(match));\r\n\r\nconst encodingMethods: Record<\r\n\tURLParamsEncodingType,\r\n\t(param: string) => string\r\n> = {\r\n\tdefault: encodeURIComponentExcludingSubDelims,\r\n\turi: encodeURI,\r\n\turiComponent: encodeURIComponent,\r\n\tnone: (val) => val,\r\n\tlegacy: encodeURI,\r\n};\r\n\r\nconst decodingMethods: Record<\r\n\tURLParamsEncodingType,\r\n\t(param: string) => string\r\n> = {\r\n\tdefault: decodeURIComponent,\r\n\turi: decodeURI,\r\n\turiComponent: decodeURIComponent,\r\n\tnone: (val) => val,\r\n\tlegacy: decodeURIComponent,\r\n};\r\n\r\nconst encodeParam = (\r\n\tparam: string | number | boolean,\r\n\tencoding: URLParamsEncodingType,\r\n\tisSpatParam: boolean,\r\n): string => {\r\n\tconst encoder =\r\n\t\tencodingMethods[encoding] || encodeURIComponentExcludingSubDelims;\r\n\r\n\tif (isSpatParam) {\r\n\t\treturn String(param).split(\"/\").map(encoder).join(\"/\");\r\n\t}\r\n\r\n\treturn encoder(String(param));\r\n};\r\n\r\nconst decodeParam = (param: string, encoding: URLParamsEncodingType): string =>\r\n\t(decodingMethods[encoding] || decodeURIComponent)(param);\r\n\r\nconst defaultOrConstrained = (match: string): string =>\r\n\t`(${match ? match.replace(/(^<|>$)/g, \"\") : \"[a-zA-Z0-9-_.~%':|=+\\\\*@$]+\"})`;\r\n\r\ntype RegExpFactory = (match: any) => RegExp;\r\n\r\ninterface IRule {\r\n\t/* The name of the rule */\r\n\tname: string;\r\n\t/* The regular expression used to find a token in a path definition */\r\n\tpattern: RegExp;\r\n\t/* The derived regular expression to match a path */\r\n\tregex?: RegExp | RegExpFactory;\r\n}\r\n\r\nconst rules: IRule[] = [\r\n\t{\r\n\t\tname: \"url-parameter\",\r\n\t\tpattern: /^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,\r\n\t\tregex: (match: RegExpMatchArray) =>\r\n\t\t\tnew RegExp(defaultOrConstrained(match[2])),\r\n\t},\r\n\t{\r\n\t\tname: \"url-parameter-splat\",\r\n\t\tpattern: /^\\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,\r\n\t\tregex: /([^?]*)/,\r\n\t},\r\n\t{\r\n\t\tname: \"url-parameter-matrix\",\r\n\t\tpattern: /^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,\r\n\t\tregex: (match: RegExpMatchArray) =>\r\n\t\t\tnew RegExp(`;${match[1]}=${defaultOrConstrained(match[2])}`),\r\n\t},\r\n\t{\r\n\t\tname: \"query-parameter\",\r\n\t\tpattern: /^(?:\\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,\r\n\t},\r\n\t{\r\n\t\tname: \"delimiter\",\r\n\t\tpattern: /^(\\/|\\?)/,\r\n\t\tregex: (match: RegExpMatchArray) => new RegExp(`\\\\${match[0]}`),\r\n\t},\r\n\t{\r\n\t\tname: \"sub-delimiter\",\r\n\t\tpattern: /^(!|&|-|_|\\.|;)/,\r\n\t\tregex: (match: RegExpMatchArray) => new RegExp(match[0]),\r\n\t},\r\n\t{\r\n\t\tname: \"fragment\",\r\n\t\tpattern: /^([0-9a-zA-Z]+)/,\r\n\t\tregex: (match: RegExpMatchArray) => new RegExp(match[0]),\r\n\t},\r\n];\r\n\r\ninterface Token {\r\n\ttype: string;\r\n\tmatch: string;\r\n\tval: any;\r\n\totherVal: any;\r\n\tregex?: RegExp;\r\n}\r\n\r\nconst tokenise = (str: string, tokens: Token[] = []): Token[] => {\r\n\t// Look for a matching rule\r\n\tconst matched = rules.some((rule) => {\r\n\t\tconst match = str.match(rule.pattern);\r\n\t\tif (!match) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\ttokens.push({\r\n\t\t\ttype: rule.name,\r\n\t\t\tmatch: match[0],\r\n\t\t\tval: match.slice(1, 2),\r\n\t\t\totherVal: match.slice(2),\r\n\t\t\tregex: rule.regex instanceof Function ? rule.regex(match) : rule.regex,\r\n\t\t});\r\n\r\n\t\tif (match[0].length < str.length) {\r\n\t\t\ttokens = tokenise(str.substr(match[0].length), tokens);\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\t// If no rules matched, throw an error (possible malformed path)\r\n\tif (!matched) {\r\n\t\tthrow new Error(`Could not parse path '${str}'`);\r\n\t}\r\n\r\n\treturn tokens;\r\n};\r\n\r\nconst exists = (val: any) => val !== undefined && val !== null;\r\n\r\nconst optTrailingSlash = (source: string, strictTrailingSlash: boolean) => {\r\n\tif (strictTrailingSlash) {\r\n\t\treturn source;\r\n\t}\r\n\r\n\tif (source === \"\\\\/\") {\r\n\t\treturn source;\r\n\t}\r\n\r\n\treturn `${source.replace(/\\\\\\/$/, \"\")}(?:\\\\/)?`;\r\n};\r\n\r\nconst upToDelimiter = (source: string, delimiter?: boolean) => {\r\n\tif (!delimiter) {\r\n\t\treturn source;\r\n\t}\r\n\r\n\treturn /(\\/)$/.test(source) ? source : `${source}(\\\\/|\\\\?|\\\\.|;|$)`;\r\n};\r\n\r\nconst appendQueryParam = (\r\n\tparams: Record<string, any>,\r\n\tparam: string,\r\n\tval = \"\",\r\n) => {\r\n\tconst existingVal = params[param];\r\n\r\n\tif (existingVal === undefined) {\r\n\t\tparams[param] = val;\r\n\t} else {\r\n\t\tparams[param] = Array.isArray(existingVal)\r\n\t\t\t? existingVal.concat(val)\r\n\t\t\t: [existingVal, val];\r\n\t}\r\n\r\n\treturn params;\r\n};\r\n\r\nexport interface PathOptions {\r\n\t/**\r\n\t * Query parameters buiding and matching options, see\r\n\t * https://github.com/troch/search-params#options\r\n\t */\r\n\tqueryParams?: IOptions;\r\n\t/**\r\n\t * Specifies the method used to encode URL parameters:\r\n\t *   - `'default': `encodeURIComponent` and `decodeURIComponent`\r\n\t *      are used but some characters to encode and decode URL parameters,\r\n\t *      but some characters are preserved when encoding\r\n\t *      (sub-delimiters: `+`, `:`, `'`, `!`, `,`, `;`, `'*'`).\r\n\t *   - `'uriComponent'`: use `encodeURIComponent` and `decodeURIComponent`\r\n\t *      for encoding and decoding URL parameters.\r\n\t *   - `'uri'`: use `encodeURI` and `decodeURI for encoding amd decoding\r\n\t *      URL parameters.\r\n\t *   - `'none'`: no encoding or decoding is performed\r\n\t *   - `'legacy'`: the approach for version 5.x and below (not recoomended)\r\n\t */\r\n\turlParamsEncoding?: URLParamsEncodingType;\r\n}\r\n\r\nexport interface InternalPathOptions {\r\n\tqueryParams?: IOptions;\r\n\turlParamsEncoding: URLParamsEncodingType;\r\n}\r\n\r\nconst defaultOptions: InternalPathOptions = {\r\n\turlParamsEncoding: \"default\",\r\n};\r\n\r\nexport interface PathPartialTestOptions extends PathOptions {\r\n\tcaseSensitive?: boolean;\r\n\tdelimited?: boolean;\r\n}\r\n\r\nexport interface PathTestOptions extends PathOptions {\r\n\tcaseSensitive?: boolean;\r\n\tstrictTrailingSlash?: boolean;\r\n}\r\n\r\nexport interface PathBuildOptions extends PathOptions {\r\n\tignoreConstraints?: boolean;\r\n\tignoreSearch?: boolean;\r\n}\r\n\r\nexport type TestMatch<T extends Record<string, any> = Record<string, any>> =\r\n\tT | null;\r\n\r\nexport class Path<T extends Record<string, any> = Record<string, any>> {\r\n\tpublic static createPath<T extends Record<string, any> = Record<string, any>>(\r\n\t\tpath: string,\r\n\t\toptions?: PathOptions,\r\n\t) {\r\n\t\treturn new Path<T>(path, options);\r\n\t}\r\n\r\n\tpublic path: string;\r\n\tpublic tokens: Token[];\r\n\tpublic hasUrlParams: boolean;\r\n\tpublic hasSpatParam: boolean;\r\n\tpublic hasMatrixParams: boolean;\r\n\tpublic hasQueryParams: boolean;\r\n\tpublic options: InternalPathOptions;\r\n\tpublic spatParams: string[];\r\n\tpublic urlParams: string[];\r\n\tpublic queryParams: string[];\r\n\tpublic params: string[];\r\n\tpublic source: string;\r\n\r\n\tconstructor(path: string, options?: PathOptions) {\r\n\t\tif (!path) {\r\n\t\t\tthrow new Error(\"Missing path in Path constructor\");\r\n\t\t}\r\n\t\tthis.path = path;\r\n\t\tthis.options = {\r\n\t\t\t...defaultOptions,\r\n\t\t\t...options,\r\n\t\t};\r\n\t\tthis.tokens = tokenise(path);\r\n\r\n\t\tthis.hasUrlParams =\r\n\t\t\tthis.tokens.filter((t) => /^url-parameter/.test(t.type)).length > 0;\r\n\t\tthis.hasSpatParam =\r\n\t\t\tthis.tokens.filter((t) => /splat$/.test(t.type)).length > 0;\r\n\t\tthis.hasMatrixParams =\r\n\t\t\tthis.tokens.filter((t) => /matrix$/.test(t.type)).length > 0;\r\n\t\tthis.hasQueryParams =\r\n\t\t\tthis.tokens.filter((t) => /^query-parameter/.test(t.type)).length > 0;\r\n\t\t// Extract named parameters from tokens\r\n\t\tthis.spatParams = this.getParams(\"url-parameter-splat\");\r\n\t\tthis.urlParams = this.getParams(/^url-parameter/);\r\n\t\t// Query params\r\n\t\tthis.queryParams = this.getParams(\"query-parameter\");\r\n\t\t// All params\r\n\t\tthis.params = this.urlParams.concat(this.queryParams);\r\n\t\t// Check if hasQueryParams\r\n\t\t// Regular expressions for url part only (full and partial match)\r\n\t\tthis.source = this.tokens\r\n\t\t\t.filter((t) => t.regex !== undefined)\r\n\t\t\t.map((t) => t.regex!.source)\r\n\t\t\t.join(\"\");\r\n\t}\r\n\r\n\tpublic isQueryParam(name: string): boolean {\r\n\t\treturn this.queryParams.indexOf(name) !== -1;\r\n\t}\r\n\r\n\tpublic isSpatParam(name: string): boolean {\r\n\t\treturn this.spatParams.indexOf(name) !== -1;\r\n\t}\r\n\r\n\tpublic test(path: string, opts?: PathTestOptions): TestMatch<T> {\r\n\t\tconst options = {\r\n\t\t\tcaseSensitive: false,\r\n\t\t\tstrictTrailingSlash: false,\r\n\t\t\t...this.options,\r\n\t\t\t...opts,\r\n\t\t} as const;\r\n\t\t// trailingSlash: falsy => non optional, truthy => optional\r\n\t\tconst source = optTrailingSlash(this.source, options.strictTrailingSlash);\r\n\t\t// Check if exact match\r\n\t\tconst match = this.urlTest(\r\n\t\t\tpath,\r\n\t\t\tsource + (this.hasQueryParams ? \"(\\\\?.*$|$)\" : \"$\"),\r\n\t\t\toptions.caseSensitive,\r\n\t\t\toptions.urlParamsEncoding,\r\n\t\t);\r\n\t\t// If no match, or no query params, no need to go further\r\n\t\tif (!match || !this.hasQueryParams) {\r\n\t\t\treturn match;\r\n\t\t}\r\n\t\t// Extract query params\r\n\t\tconst queryParams = parseQueryParams(path, options.queryParams);\r\n\t\tconst unexpectedQueryParams = Object.keys(queryParams).filter(\r\n\t\t\t(p) => !this.isQueryParam(p),\r\n\t\t);\r\n\r\n\t\tif (unexpectedQueryParams.length === 0) {\r\n\t\t\t// Extend url match\r\n\t\t\tObject.keys(queryParams).forEach(\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\t(p) => (match[p] = (queryParams as any)[p]),\r\n\t\t\t);\r\n\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tpublic partialTest(\r\n\t\tpath: string,\r\n\t\topts?: PathPartialTestOptions,\r\n\t): TestMatch<T> {\r\n\t\tconst options = {\r\n\t\t\tcaseSensitive: false,\r\n\t\t\tdelimited: true,\r\n\t\t\t...this.options,\r\n\t\t\t...opts,\r\n\t\t} as const;\r\n\t\t// Check if partial match (start of given path matches regex)\r\n\t\t// trailingSlash: falsy => non optional, truthy => optional\r\n\t\tconst source = upToDelimiter(this.source, options.delimited);\r\n\t\tconst match = this.urlTest(\r\n\t\t\tpath,\r\n\t\t\tsource,\r\n\t\t\toptions.caseSensitive,\r\n\t\t\toptions.urlParamsEncoding,\r\n\t\t);\r\n\r\n\t\tif (!match) {\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\tif (!this.hasQueryParams) {\r\n\t\t\treturn match;\r\n\t\t}\r\n\r\n\t\tconst queryParams = parseQueryParams(path, options.queryParams);\r\n\r\n\t\tObject.keys(queryParams)\r\n\t\t\t.filter((p) => this.isQueryParam(p))\r\n\t\t\t.forEach((p) => appendQueryParam(match, p, (queryParams as any)[p]));\r\n\r\n\t\treturn match;\r\n\t}\r\n\r\n\tpublic build(params: T = {} as T, opts?: PathBuildOptions): string {\r\n\t\tconst options = {\r\n\t\t\tignoreConstraints: false,\r\n\t\t\tignoreSearch: false,\r\n\t\t\tqueryParams: {},\r\n\t\t\t...this.options,\r\n\t\t\t...opts,\r\n\t\t} as const;\r\n\t\tconst encodedUrlParams = Object.keys(params)\r\n\t\t\t.filter((p) => !this.isQueryParam(p))\r\n\t\t\t.reduce<Record<string, any>>((acc, key) => {\r\n\t\t\t\tif (!exists(params[key])) {\r\n\t\t\t\t\treturn acc;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst val = params[key];\r\n\t\t\t\tconst isSpatParam = this.isSpatParam(key);\r\n\r\n\t\t\t\tif (typeof val === \"boolean\") {\r\n\t\t\t\t\tacc[key] = val;\r\n\t\t\t\t} else if (Array.isArray(val)) {\r\n\t\t\t\t\tacc[key] = val.map((v) =>\r\n\t\t\t\t\t\tencodeParam(v, options.urlParamsEncoding, isSpatParam),\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tacc[key] = encodeParam(val, options.urlParamsEncoding, isSpatParam);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn acc;\r\n\t\t\t}, {});\r\n\r\n\t\t// Check all params are provided (not search parameters which are optional)\r\n\t\tif (this.urlParams.some((p) => !exists(params[p]))) {\r\n\t\t\tconst missingParameters = this.urlParams.filter(\r\n\t\t\t\t(p) => !exists(params[p]),\r\n\t\t\t);\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`Cannot build path: '${this.path}' requires missing parameters { ${missingParameters.join(\", \")} }`,\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Check constraints\r\n\t\tif (!options.ignoreConstraints) {\r\n\t\t\tconst constraintsPassed = this.tokens\r\n\t\t\t\t.filter((t) => /^url-parameter/.test(t.type) && !/-splat$/.test(t.type))\r\n\t\t\t\t.every((t) =>\r\n\t\t\t\t\tnew RegExp(`^${defaultOrConstrained(t.otherVal[0])}$`).test(\r\n\t\t\t\t\t\tencodedUrlParams[t.val],\r\n\t\t\t\t\t),\r\n\t\t\t\t);\r\n\r\n\t\t\tif (!constraintsPassed) {\r\n\t\t\t\tthrow new Error(\r\n\t\t\t\t\t`Some parameters of '${this.path}' are of invalid format`,\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst base = this.tokens\r\n\t\t\t.filter((t) => /^query-parameter/.test(t.type) === false)\r\n\t\t\t.map((t) => {\r\n\t\t\t\tif (t.type === \"url-parameter-matrix\") {\r\n\t\t\t\t\treturn `;${t.val}=${encodedUrlParams[t.val[0]]}`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn /^url-parameter/.test(t.type)\r\n\t\t\t\t\t? encodedUrlParams[t.val[0]]\r\n\t\t\t\t\t: t.match;\r\n\t\t\t})\r\n\t\t\t.join(\"\");\r\n\r\n\t\tif (options.ignoreSearch) {\r\n\t\t\treturn base;\r\n\t\t}\r\n\r\n\t\tconst searchParams = this.queryParams\r\n\t\t\t.filter((p) => Object.keys(params).indexOf(p) !== -1)\r\n\t\t\t.reduce<Record<string, any>>((sparams, paramName) => {\r\n\t\t\t\tsparams[paramName] = params[paramName];\r\n\t\t\t\treturn sparams;\r\n\t\t\t}, {});\r\n\t\tconst searchPart = buildQueryParams(searchParams, options.queryParams);\r\n\r\n\t\treturn searchPart ? `${base}?${searchPart}` : base;\r\n\t}\r\n\r\n\tprivate getParams(type: string | RegExp): string[] {\r\n\t\tconst predicate =\r\n\t\t\ttype instanceof RegExp\r\n\t\t\t\t? (t: Token) => type.test(t.type)\r\n\t\t\t\t: (t: Token) => t.type === type;\r\n\r\n\t\treturn this.tokens.filter(predicate).map((t) => t.val[0]);\r\n\t}\r\n\r\n\tprivate urlTest(\r\n\t\tpath: string,\r\n\t\tsource: string,\r\n\t\tcaseSensitive: boolean,\r\n\t\turlParamsEncoding: URLParamsEncodingType,\r\n\t): TestMatch<T> {\r\n\t\tconst regex = new RegExp(`^${source}`, caseSensitive ? \"\" : \"i\");\r\n\t\tconst match = path.match(regex);\r\n\t\tif (!match) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (!this.urlParams.length) {\r\n\t\t\treturn {} as T;\r\n\t\t}\r\n\t\t// Reduce named params to key-value pairs\r\n\t\treturn match\r\n\t\t\t.slice(1, this.urlParams.length + 1)\r\n\t\t\t.reduce<Record<string, any>>((params, m, i) => {\r\n\t\t\t\tparams[this.urlParams[i]] = decodeParam(m, urlParamsEncoding);\r\n\t\t\t\treturn params;\r\n\t\t\t}, {}) as T;\r\n\t}\r\n}\r\n\r\nexport default Path;\r\n", "/*\n * Dexie.js - a minimalistic wrapper for IndexedDB\n * ===============================================\n *\n * By David Fahlander, david.fahlander@gmail.com\n *\n * Version 4.0.8, Wed Jul 10 2024\n *\n * https://dexie.org\n *\n * Apache License Version 2.0, January 2004, http://www.apache.org/licenses/\n */\n \nconst _global = typeof globalThis !== 'undefined' ? globalThis :\n    typeof self !== 'undefined' ? self :\n        typeof window !== 'undefined' ? window :\n            global;\n\nconst keys = Object.keys;\nconst isArray = Array.isArray;\nif (typeof Promise !== 'undefined' && !_global.Promise) {\n    _global.Promise = Promise;\n}\nfunction extend(obj, extension) {\n    if (typeof extension !== 'object')\n        return obj;\n    keys(extension).forEach(function (key) {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\nconst getProto = Object.getPrototypeOf;\nconst _hasOwn = {}.hasOwnProperty;\nfunction hasOwn(obj, prop) {\n    return _hasOwn.call(obj, prop);\n}\nfunction props(proto, extension) {\n    if (typeof extension === 'function')\n        extension = extension(getProto(proto));\n    (typeof Reflect === \"undefined\" ? keys : Reflect.ownKeys)(extension).forEach(key => {\n        setProp(proto, key, extension[key]);\n    });\n}\nconst defineProperty = Object.defineProperty;\nfunction setProp(obj, prop, functionOrGetSet, options) {\n    defineProperty(obj, prop, extend(functionOrGetSet && hasOwn(functionOrGetSet, \"get\") && typeof functionOrGetSet.get === 'function' ?\n        { get: functionOrGetSet.get, set: functionOrGetSet.set, configurable: true } :\n        { value: functionOrGetSet, configurable: true, writable: true }, options));\n}\nfunction derive(Child) {\n    return {\n        from: function (Parent) {\n            Child.prototype = Object.create(Parent.prototype);\n            setProp(Child.prototype, \"constructor\", Child);\n            return {\n                extend: props.bind(null, Child.prototype)\n            };\n        }\n    };\n}\nconst getOwnPropertyDescriptor = Object.getOwnPropertyDescriptor;\nfunction getPropertyDescriptor(obj, prop) {\n    const pd = getOwnPropertyDescriptor(obj, prop);\n    let proto;\n    return pd || (proto = getProto(obj)) && getPropertyDescriptor(proto, prop);\n}\nconst _slice = [].slice;\nfunction slice(args, start, end) {\n    return _slice.call(args, start, end);\n}\nfunction override(origFunc, overridedFactory) {\n    return overridedFactory(origFunc);\n}\nfunction assert(b) {\n    if (!b)\n        throw new Error(\"Assertion Failed\");\n}\nfunction asap$1(fn) {\n    if (_global.setImmediate)\n        setImmediate(fn);\n    else\n        setTimeout(fn, 0);\n}\nfunction arrayToObject(array, extractor) {\n    return array.reduce((result, item, i) => {\n        var nameAndValue = extractor(item, i);\n        if (nameAndValue)\n            result[nameAndValue[0]] = nameAndValue[1];\n        return result;\n    }, {});\n}\nfunction getByKeyPath(obj, keyPath) {\n    if (typeof keyPath === 'string' && hasOwn(obj, keyPath))\n        return obj[keyPath];\n    if (!keyPath)\n        return obj;\n    if (typeof keyPath !== 'string') {\n        var rv = [];\n        for (var i = 0, l = keyPath.length; i < l; ++i) {\n            var val = getByKeyPath(obj, keyPath[i]);\n            rv.push(val);\n        }\n        return rv;\n    }\n    var period = keyPath.indexOf('.');\n    if (period !== -1) {\n        var innerObj = obj[keyPath.substr(0, period)];\n        return innerObj == null ? undefined : getByKeyPath(innerObj, keyPath.substr(period + 1));\n    }\n    return undefined;\n}\nfunction setByKeyPath(obj, keyPath, value) {\n    if (!obj || keyPath === undefined)\n        return;\n    if ('isFrozen' in Object && Object.isFrozen(obj))\n        return;\n    if (typeof keyPath !== 'string' && 'length' in keyPath) {\n        assert(typeof value !== 'string' && 'length' in value);\n        for (var i = 0, l = keyPath.length; i < l; ++i) {\n            setByKeyPath(obj, keyPath[i], value[i]);\n        }\n    }\n    else {\n        var period = keyPath.indexOf('.');\n        if (period !== -1) {\n            var currentKeyPath = keyPath.substr(0, period);\n            var remainingKeyPath = keyPath.substr(period + 1);\n            if (remainingKeyPath === \"\")\n                if (value === undefined) {\n                    if (isArray(obj) && !isNaN(parseInt(currentKeyPath)))\n                        obj.splice(currentKeyPath, 1);\n                    else\n                        delete obj[currentKeyPath];\n                }\n                else\n                    obj[currentKeyPath] = value;\n            else {\n                var innerObj = obj[currentKeyPath];\n                if (!innerObj || !hasOwn(obj, currentKeyPath))\n                    innerObj = (obj[currentKeyPath] = {});\n                setByKeyPath(innerObj, remainingKeyPath, value);\n            }\n        }\n        else {\n            if (value === undefined) {\n                if (isArray(obj) && !isNaN(parseInt(keyPath)))\n                    obj.splice(keyPath, 1);\n                else\n                    delete obj[keyPath];\n            }\n            else\n                obj[keyPath] = value;\n        }\n    }\n}\nfunction delByKeyPath(obj, keyPath) {\n    if (typeof keyPath === 'string')\n        setByKeyPath(obj, keyPath, undefined);\n    else if ('length' in keyPath)\n        [].map.call(keyPath, function (kp) {\n            setByKeyPath(obj, kp, undefined);\n        });\n}\nfunction shallowClone(obj) {\n    var rv = {};\n    for (var m in obj) {\n        if (hasOwn(obj, m))\n            rv[m] = obj[m];\n    }\n    return rv;\n}\nconst concat = [].concat;\nfunction flatten(a) {\n    return concat.apply([], a);\n}\nconst intrinsicTypeNames = \"BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey\"\n    .split(',').concat(flatten([8, 16, 32, 64].map(num => [\"Int\", \"Uint\", \"Float\"].map(t => t + num + \"Array\")))).filter(t => _global[t]);\nconst intrinsicTypes = new Set(intrinsicTypeNames.map(t => _global[t]));\nfunction cloneSimpleObjectTree(o) {\n    const rv = {};\n    for (const k in o)\n        if (hasOwn(o, k)) {\n            const v = o[k];\n            rv[k] = !v || typeof v !== 'object' || intrinsicTypes.has(v.constructor) ? v : cloneSimpleObjectTree(v);\n        }\n    return rv;\n}\nfunction objectIsEmpty(o) {\n    for (const k in o)\n        if (hasOwn(o, k))\n            return false;\n    return true;\n}\nlet circularRefs = null;\nfunction deepClone(any) {\n    circularRefs = new WeakMap();\n    const rv = innerDeepClone(any);\n    circularRefs = null;\n    return rv;\n}\nfunction innerDeepClone(x) {\n    if (!x || typeof x !== 'object')\n        return x;\n    let rv = circularRefs.get(x);\n    if (rv)\n        return rv;\n    if (isArray(x)) {\n        rv = [];\n        circularRefs.set(x, rv);\n        for (var i = 0, l = x.length; i < l; ++i) {\n            rv.push(innerDeepClone(x[i]));\n        }\n    }\n    else if (intrinsicTypes.has(x.constructor)) {\n        rv = x;\n    }\n    else {\n        const proto = getProto(x);\n        rv = proto === Object.prototype ? {} : Object.create(proto);\n        circularRefs.set(x, rv);\n        for (var prop in x) {\n            if (hasOwn(x, prop)) {\n                rv[prop] = innerDeepClone(x[prop]);\n            }\n        }\n    }\n    return rv;\n}\nconst { toString } = {};\nfunction toStringTag(o) {\n    return toString.call(o).slice(8, -1);\n}\nconst iteratorSymbol = typeof Symbol !== 'undefined' ?\n    Symbol.iterator :\n    '@@iterator';\nconst getIteratorOf = typeof iteratorSymbol === \"symbol\" ? function (x) {\n    var i;\n    return x != null && (i = x[iteratorSymbol]) && i.apply(x);\n} : function () { return null; };\nfunction delArrayItem(a, x) {\n    const i = a.indexOf(x);\n    if (i >= 0)\n        a.splice(i, 1);\n    return i >= 0;\n}\nconst NO_CHAR_ARRAY = {};\nfunction getArrayOf(arrayLike) {\n    var i, a, x, it;\n    if (arguments.length === 1) {\n        if (isArray(arrayLike))\n            return arrayLike.slice();\n        if (this === NO_CHAR_ARRAY && typeof arrayLike === 'string')\n            return [arrayLike];\n        if ((it = getIteratorOf(arrayLike))) {\n            a = [];\n            while ((x = it.next()), !x.done)\n                a.push(x.value);\n            return a;\n        }\n        if (arrayLike == null)\n            return [arrayLike];\n        i = arrayLike.length;\n        if (typeof i === 'number') {\n            a = new Array(i);\n            while (i--)\n                a[i] = arrayLike[i];\n            return a;\n        }\n        return [arrayLike];\n    }\n    i = arguments.length;\n    a = new Array(i);\n    while (i--)\n        a[i] = arguments[i];\n    return a;\n}\nconst isAsyncFunction = typeof Symbol !== 'undefined'\n    ? (fn) => fn[Symbol.toStringTag] === 'AsyncFunction'\n    : () => false;\n\nvar dexieErrorNames = [\n    'Modify',\n    'Bulk',\n    'OpenFailed',\n    'VersionChange',\n    'Schema',\n    'Upgrade',\n    'InvalidTable',\n    'MissingAPI',\n    'NoSuchDatabase',\n    'InvalidArgument',\n    'SubTransaction',\n    'Unsupported',\n    'Internal',\n    'DatabaseClosed',\n    'PrematureCommit',\n    'ForeignAwait'\n];\nvar idbDomErrorNames = [\n    'Unknown',\n    'Constraint',\n    'Data',\n    'TransactionInactive',\n    'ReadOnly',\n    'Version',\n    'NotFound',\n    'InvalidState',\n    'InvalidAccess',\n    'Abort',\n    'Timeout',\n    'QuotaExceeded',\n    'Syntax',\n    'DataClone'\n];\nvar errorList = dexieErrorNames.concat(idbDomErrorNames);\nvar defaultTexts = {\n    VersionChanged: \"Database version changed by other database connection\",\n    DatabaseClosed: \"Database has been closed\",\n    Abort: \"Transaction aborted\",\n    TransactionInactive: \"Transaction has already completed or failed\",\n    MissingAPI: \"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb\"\n};\nfunction DexieError(name, msg) {\n    this.name = name;\n    this.message = msg;\n}\nderive(DexieError).from(Error).extend({\n    toString: function () { return this.name + \": \" + this.message; }\n});\nfunction getMultiErrorMessage(msg, failures) {\n    return msg + \". Errors: \" + Object.keys(failures)\n        .map(key => failures[key].toString())\n        .filter((v, i, s) => s.indexOf(v) === i)\n        .join('\\n');\n}\nfunction ModifyError(msg, failures, successCount, failedKeys) {\n    this.failures = failures;\n    this.failedKeys = failedKeys;\n    this.successCount = successCount;\n    this.message = getMultiErrorMessage(msg, failures);\n}\nderive(ModifyError).from(DexieError);\nfunction BulkError(msg, failures) {\n    this.name = \"BulkError\";\n    this.failures = Object.keys(failures).map(pos => failures[pos]);\n    this.failuresByPos = failures;\n    this.message = getMultiErrorMessage(msg, this.failures);\n}\nderive(BulkError).from(DexieError);\nvar errnames = errorList.reduce((obj, name) => (obj[name] = name + \"Error\", obj), {});\nconst BaseException = DexieError;\nvar exceptions = errorList.reduce((obj, name) => {\n    var fullName = name + \"Error\";\n    function DexieError(msgOrInner, inner) {\n        this.name = fullName;\n        if (!msgOrInner) {\n            this.message = defaultTexts[name] || fullName;\n            this.inner = null;\n        }\n        else if (typeof msgOrInner === 'string') {\n            this.message = `${msgOrInner}${!inner ? '' : '\\n ' + inner}`;\n            this.inner = inner || null;\n        }\n        else if (typeof msgOrInner === 'object') {\n            this.message = `${msgOrInner.name} ${msgOrInner.message}`;\n            this.inner = msgOrInner;\n        }\n    }\n    derive(DexieError).from(BaseException);\n    obj[name] = DexieError;\n    return obj;\n}, {});\nexceptions.Syntax = SyntaxError;\nexceptions.Type = TypeError;\nexceptions.Range = RangeError;\nvar exceptionMap = idbDomErrorNames.reduce((obj, name) => {\n    obj[name + \"Error\"] = exceptions[name];\n    return obj;\n}, {});\nfunction mapError(domError, message) {\n    if (!domError || domError instanceof DexieError || domError instanceof TypeError || domError instanceof SyntaxError || !domError.name || !exceptionMap[domError.name])\n        return domError;\n    var rv = new exceptionMap[domError.name](message || domError.message, domError);\n    if (\"stack\" in domError) {\n        setProp(rv, \"stack\", { get: function () {\n                return this.inner.stack;\n            } });\n    }\n    return rv;\n}\nvar fullNameExceptions = errorList.reduce((obj, name) => {\n    if ([\"Syntax\", \"Type\", \"Range\"].indexOf(name) === -1)\n        obj[name + \"Error\"] = exceptions[name];\n    return obj;\n}, {});\nfullNameExceptions.ModifyError = ModifyError;\nfullNameExceptions.DexieError = DexieError;\nfullNameExceptions.BulkError = BulkError;\n\nfunction nop() { }\nfunction mirror(val) { return val; }\nfunction pureFunctionChain(f1, f2) {\n    if (f1 == null || f1 === mirror)\n        return f2;\n    return function (val) {\n        return f2(f1(val));\n    };\n}\nfunction callBoth(on1, on2) {\n    return function () {\n        on1.apply(this, arguments);\n        on2.apply(this, arguments);\n    };\n}\nfunction hookCreatingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        var res = f1.apply(this, arguments);\n        if (res !== undefined)\n            arguments[0] = res;\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = null;\n        this.onerror = null;\n        var res2 = f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        return res2 !== undefined ? res2 : res;\n    };\n}\nfunction hookDeletingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        f1.apply(this, arguments);\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = this.onerror = null;\n        f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n    };\n}\nfunction hookUpdatingChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function (modifications) {\n        var res = f1.apply(this, arguments);\n        extend(modifications, res);\n        var onsuccess = this.onsuccess,\n        onerror = this.onerror;\n        this.onsuccess = null;\n        this.onerror = null;\n        var res2 = f2.apply(this, arguments);\n        if (onsuccess)\n            this.onsuccess = this.onsuccess ? callBoth(onsuccess, this.onsuccess) : onsuccess;\n        if (onerror)\n            this.onerror = this.onerror ? callBoth(onerror, this.onerror) : onerror;\n        return res === undefined ?\n            (res2 === undefined ? undefined : res2) :\n            (extend(res, res2));\n    };\n}\nfunction reverseStoppableEventChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        if (f2.apply(this, arguments) === false)\n            return false;\n        return f1.apply(this, arguments);\n    };\n}\nfunction promisableChain(f1, f2) {\n    if (f1 === nop)\n        return f2;\n    return function () {\n        var res = f1.apply(this, arguments);\n        if (res && typeof res.then === 'function') {\n            var thiz = this, i = arguments.length, args = new Array(i);\n            while (i--)\n                args[i] = arguments[i];\n            return res.then(function () {\n                return f2.apply(thiz, args);\n            });\n        }\n        return f2.apply(this, arguments);\n    };\n}\n\nvar debug = typeof location !== 'undefined' &&\n    /^(http|https):\\/\\/(localhost|127\\.0\\.0\\.1)/.test(location.href);\nfunction setDebug(value, filter) {\n    debug = value;\n}\n\nvar INTERNAL = {};\nconst ZONE_ECHO_LIMIT = 100, [resolvedNativePromise, nativePromiseProto, resolvedGlobalPromise] = typeof Promise === 'undefined' ?\n    [] :\n    (() => {\n        let globalP = Promise.resolve();\n        if (typeof crypto === 'undefined' || !crypto.subtle)\n            return [globalP, getProto(globalP), globalP];\n        const nativeP = crypto.subtle.digest(\"SHA-512\", new Uint8Array([0]));\n        return [\n            nativeP,\n            getProto(nativeP),\n            globalP\n        ];\n    })(), nativePromiseThen = nativePromiseProto && nativePromiseProto.then;\nconst NativePromise = resolvedNativePromise && resolvedNativePromise.constructor;\nconst patchGlobalPromise = !!resolvedGlobalPromise;\nfunction schedulePhysicalTick() {\n    queueMicrotask(physicalTick);\n}\nvar asap = function (callback, args) {\n    microtickQueue.push([callback, args]);\n    if (needsNewPhysicalTick) {\n        schedulePhysicalTick();\n        needsNewPhysicalTick = false;\n    }\n};\nvar isOutsideMicroTick = true,\nneedsNewPhysicalTick = true,\nunhandledErrors = [],\nrejectingErrors = [],\nrejectionMapper = mirror;\nvar globalPSD = {\n    id: 'global',\n    global: true,\n    ref: 0,\n    unhandleds: [],\n    onunhandled: nop,\n    pgp: false,\n    env: {},\n    finalize: nop\n};\nvar PSD = globalPSD;\nvar microtickQueue = [];\nvar numScheduledCalls = 0;\nvar tickFinalizers = [];\nfunction DexiePromise(fn) {\n    if (typeof this !== 'object')\n        throw new TypeError('Promises must be constructed via new');\n    this._listeners = [];\n    this._lib = false;\n    var psd = (this._PSD = PSD);\n    if (typeof fn !== 'function') {\n        if (fn !== INTERNAL)\n            throw new TypeError('Not a function');\n        this._state = arguments[1];\n        this._value = arguments[2];\n        if (this._state === false)\n            handleRejection(this, this._value);\n        return;\n    }\n    this._state = null;\n    this._value = null;\n    ++psd.ref;\n    executePromiseTask(this, fn);\n}\nconst thenProp = {\n    get: function () {\n        var psd = PSD, microTaskId = totalEchoes;\n        function then(onFulfilled, onRejected) {\n            var possibleAwait = !psd.global && (psd !== PSD || microTaskId !== totalEchoes);\n            const cleanup = possibleAwait && !decrementExpectedAwaits();\n            var rv = new DexiePromise((resolve, reject) => {\n                propagateToListener(this, new Listener(nativeAwaitCompatibleWrap(onFulfilled, psd, possibleAwait, cleanup), nativeAwaitCompatibleWrap(onRejected, psd, possibleAwait, cleanup), resolve, reject, psd));\n            });\n            if (this._consoleTask)\n                rv._consoleTask = this._consoleTask;\n            return rv;\n        }\n        then.prototype = INTERNAL;\n        return then;\n    },\n    set: function (value) {\n        setProp(this, 'then', value && value.prototype === INTERNAL ?\n            thenProp :\n            {\n                get: function () {\n                    return value;\n                },\n                set: thenProp.set\n            });\n    }\n};\nprops(DexiePromise.prototype, {\n    then: thenProp,\n    _then: function (onFulfilled, onRejected) {\n        propagateToListener(this, new Listener(null, null, onFulfilled, onRejected, PSD));\n    },\n    catch: function (onRejected) {\n        if (arguments.length === 1)\n            return this.then(null, onRejected);\n        var type = arguments[0], handler = arguments[1];\n        return typeof type === 'function' ? this.then(null, err =>\n        err instanceof type ? handler(err) : PromiseReject(err))\n            : this.then(null, err =>\n            err && err.name === type ? handler(err) : PromiseReject(err));\n    },\n    finally: function (onFinally) {\n        return this.then(value => {\n            return DexiePromise.resolve(onFinally()).then(() => value);\n        }, err => {\n            return DexiePromise.resolve(onFinally()).then(() => PromiseReject(err));\n        });\n    },\n    timeout: function (ms, msg) {\n        return ms < Infinity ?\n            new DexiePromise((resolve, reject) => {\n                var handle = setTimeout(() => reject(new exceptions.Timeout(msg)), ms);\n                this.then(resolve, reject).finally(clearTimeout.bind(null, handle));\n            }) : this;\n    }\n});\nif (typeof Symbol !== 'undefined' && Symbol.toStringTag)\n    setProp(DexiePromise.prototype, Symbol.toStringTag, 'Dexie.Promise');\nglobalPSD.env = snapShot();\nfunction Listener(onFulfilled, onRejected, resolve, reject, zone) {\n    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n    this.resolve = resolve;\n    this.reject = reject;\n    this.psd = zone;\n}\nprops(DexiePromise, {\n    all: function () {\n        var values = getArrayOf.apply(null, arguments)\n            .map(onPossibleParallellAsync);\n        return new DexiePromise(function (resolve, reject) {\n            if (values.length === 0)\n                resolve([]);\n            var remaining = values.length;\n            values.forEach((a, i) => DexiePromise.resolve(a).then(x => {\n                values[i] = x;\n                if (!--remaining)\n                    resolve(values);\n            }, reject));\n        });\n    },\n    resolve: value => {\n        if (value instanceof DexiePromise)\n            return value;\n        if (value && typeof value.then === 'function')\n            return new DexiePromise((resolve, reject) => {\n                value.then(resolve, reject);\n            });\n        var rv = new DexiePromise(INTERNAL, true, value);\n        return rv;\n    },\n    reject: PromiseReject,\n    race: function () {\n        var values = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n        return new DexiePromise((resolve, reject) => {\n            values.map(value => DexiePromise.resolve(value).then(resolve, reject));\n        });\n    },\n    PSD: {\n        get: () => PSD,\n        set: value => PSD = value\n    },\n    totalEchoes: { get: () => totalEchoes },\n    newPSD: newScope,\n    usePSD: usePSD,\n    scheduler: {\n        get: () => asap,\n        set: value => { asap = value; }\n    },\n    rejectionMapper: {\n        get: () => rejectionMapper,\n        set: value => { rejectionMapper = value; }\n    },\n    follow: (fn, zoneProps) => {\n        return new DexiePromise((resolve, reject) => {\n            return newScope((resolve, reject) => {\n                var psd = PSD;\n                psd.unhandleds = [];\n                psd.onunhandled = reject;\n                psd.finalize = callBoth(function () {\n                    run_at_end_of_this_or_next_physical_tick(() => {\n                        this.unhandleds.length === 0 ? resolve() : reject(this.unhandleds[0]);\n                    });\n                }, psd.finalize);\n                fn();\n            }, zoneProps, resolve, reject);\n        });\n    }\n});\nif (NativePromise) {\n    if (NativePromise.allSettled)\n        setProp(DexiePromise, \"allSettled\", function () {\n            const possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise(resolve => {\n                if (possiblePromises.length === 0)\n                    resolve([]);\n                let remaining = possiblePromises.length;\n                const results = new Array(remaining);\n                possiblePromises.forEach((p, i) => DexiePromise.resolve(p).then(value => results[i] = { status: \"fulfilled\", value }, reason => results[i] = { status: \"rejected\", reason })\n                    .then(() => --remaining || resolve(results)));\n            });\n        });\n    if (NativePromise.any && typeof AggregateError !== 'undefined')\n        setProp(DexiePromise, \"any\", function () {\n            const possiblePromises = getArrayOf.apply(null, arguments).map(onPossibleParallellAsync);\n            return new DexiePromise((resolve, reject) => {\n                if (possiblePromises.length === 0)\n                    reject(new AggregateError([]));\n                let remaining = possiblePromises.length;\n                const failures = new Array(remaining);\n                possiblePromises.forEach((p, i) => DexiePromise.resolve(p).then(value => resolve(value), failure => {\n                    failures[i] = failure;\n                    if (!--remaining)\n                        reject(new AggregateError(failures));\n                }));\n            });\n        });\n}\nfunction executePromiseTask(promise, fn) {\n    try {\n        fn(value => {\n            if (promise._state !== null)\n                return;\n            if (value === promise)\n                throw new TypeError('A promise cannot be resolved with itself.');\n            var shouldExecuteTick = promise._lib && beginMicroTickScope();\n            if (value && typeof value.then === 'function') {\n                executePromiseTask(promise, (resolve, reject) => {\n                    value instanceof DexiePromise ?\n                        value._then(resolve, reject) :\n                        value.then(resolve, reject);\n                });\n            }\n            else {\n                promise._state = true;\n                promise._value = value;\n                propagateAllListeners(promise);\n            }\n            if (shouldExecuteTick)\n                endMicroTickScope();\n        }, handleRejection.bind(null, promise));\n    }\n    catch (ex) {\n        handleRejection(promise, ex);\n    }\n}\nfunction handleRejection(promise, reason) {\n    rejectingErrors.push(reason);\n    if (promise._state !== null)\n        return;\n    var shouldExecuteTick = promise._lib && beginMicroTickScope();\n    reason = rejectionMapper(reason);\n    promise._state = false;\n    promise._value = reason;\n    addPossiblyUnhandledError(promise);\n    propagateAllListeners(promise);\n    if (shouldExecuteTick)\n        endMicroTickScope();\n}\nfunction propagateAllListeners(promise) {\n    var listeners = promise._listeners;\n    promise._listeners = [];\n    for (var i = 0, len = listeners.length; i < len; ++i) {\n        propagateToListener(promise, listeners[i]);\n    }\n    var psd = promise._PSD;\n    --psd.ref || psd.finalize();\n    if (numScheduledCalls === 0) {\n        ++numScheduledCalls;\n        asap(() => {\n            if (--numScheduledCalls === 0)\n                finalizePhysicalTick();\n        }, []);\n    }\n}\nfunction propagateToListener(promise, listener) {\n    if (promise._state === null) {\n        promise._listeners.push(listener);\n        return;\n    }\n    var cb = promise._state ? listener.onFulfilled : listener.onRejected;\n    if (cb === null) {\n        return (promise._state ? listener.resolve : listener.reject)(promise._value);\n    }\n    ++listener.psd.ref;\n    ++numScheduledCalls;\n    asap(callListener, [cb, promise, listener]);\n}\nfunction callListener(cb, promise, listener) {\n    try {\n        var ret, value = promise._value;\n        if (!promise._state && rejectingErrors.length)\n            rejectingErrors = [];\n        ret = debug && promise._consoleTask ? promise._consoleTask.run(() => cb(value)) : cb(value);\n        if (!promise._state && rejectingErrors.indexOf(value) === -1) {\n            markErrorAsHandled(promise);\n        }\n        listener.resolve(ret);\n    }\n    catch (e) {\n        listener.reject(e);\n    }\n    finally {\n        if (--numScheduledCalls === 0)\n            finalizePhysicalTick();\n        --listener.psd.ref || listener.psd.finalize();\n    }\n}\nfunction physicalTick() {\n    usePSD(globalPSD, () => {\n        beginMicroTickScope() && endMicroTickScope();\n    });\n}\nfunction beginMicroTickScope() {\n    var wasRootExec = isOutsideMicroTick;\n    isOutsideMicroTick = false;\n    needsNewPhysicalTick = false;\n    return wasRootExec;\n}\nfunction endMicroTickScope() {\n    var callbacks, i, l;\n    do {\n        while (microtickQueue.length > 0) {\n            callbacks = microtickQueue;\n            microtickQueue = [];\n            l = callbacks.length;\n            for (i = 0; i < l; ++i) {\n                var item = callbacks[i];\n                item[0].apply(null, item[1]);\n            }\n        }\n    } while (microtickQueue.length > 0);\n    isOutsideMicroTick = true;\n    needsNewPhysicalTick = true;\n}\nfunction finalizePhysicalTick() {\n    var unhandledErrs = unhandledErrors;\n    unhandledErrors = [];\n    unhandledErrs.forEach(p => {\n        p._PSD.onunhandled.call(null, p._value, p);\n    });\n    var finalizers = tickFinalizers.slice(0);\n    var i = finalizers.length;\n    while (i)\n        finalizers[--i]();\n}\nfunction run_at_end_of_this_or_next_physical_tick(fn) {\n    function finalizer() {\n        fn();\n        tickFinalizers.splice(tickFinalizers.indexOf(finalizer), 1);\n    }\n    tickFinalizers.push(finalizer);\n    ++numScheduledCalls;\n    asap(() => {\n        if (--numScheduledCalls === 0)\n            finalizePhysicalTick();\n    }, []);\n}\nfunction addPossiblyUnhandledError(promise) {\n    if (!unhandledErrors.some(p => p._value === promise._value))\n        unhandledErrors.push(promise);\n}\nfunction markErrorAsHandled(promise) {\n    var i = unhandledErrors.length;\n    while (i)\n        if (unhandledErrors[--i]._value === promise._value) {\n            unhandledErrors.splice(i, 1);\n            return;\n        }\n}\nfunction PromiseReject(reason) {\n    return new DexiePromise(INTERNAL, false, reason);\n}\nfunction wrap(fn, errorCatcher) {\n    var psd = PSD;\n    return function () {\n        var wasRootExec = beginMicroTickScope(), outerScope = PSD;\n        try {\n            switchToZone(psd, true);\n            return fn.apply(this, arguments);\n        }\n        catch (e) {\n            errorCatcher && errorCatcher(e);\n        }\n        finally {\n            switchToZone(outerScope, false);\n            if (wasRootExec)\n                endMicroTickScope();\n        }\n    };\n}\nconst task = { awaits: 0, echoes: 0, id: 0 };\nvar taskCounter = 0;\nvar zoneStack = [];\nvar zoneEchoes = 0;\nvar totalEchoes = 0;\nvar zone_id_counter = 0;\nfunction newScope(fn, props, a1, a2) {\n    var parent = PSD, psd = Object.create(parent);\n    psd.parent = parent;\n    psd.ref = 0;\n    psd.global = false;\n    psd.id = ++zone_id_counter;\n    globalPSD.env;\n    psd.env = patchGlobalPromise ? {\n        Promise: DexiePromise,\n        PromiseProp: { value: DexiePromise, configurable: true, writable: true },\n        all: DexiePromise.all,\n        race: DexiePromise.race,\n        allSettled: DexiePromise.allSettled,\n        any: DexiePromise.any,\n        resolve: DexiePromise.resolve,\n        reject: DexiePromise.reject,\n    } : {};\n    if (props)\n        extend(psd, props);\n    ++parent.ref;\n    psd.finalize = function () {\n        --this.parent.ref || this.parent.finalize();\n    };\n    var rv = usePSD(psd, fn, a1, a2);\n    if (psd.ref === 0)\n        psd.finalize();\n    return rv;\n}\nfunction incrementExpectedAwaits() {\n    if (!task.id)\n        task.id = ++taskCounter;\n    ++task.awaits;\n    task.echoes += ZONE_ECHO_LIMIT;\n    return task.id;\n}\nfunction decrementExpectedAwaits() {\n    if (!task.awaits)\n        return false;\n    if (--task.awaits === 0)\n        task.id = 0;\n    task.echoes = task.awaits * ZONE_ECHO_LIMIT;\n    return true;\n}\nif (('' + nativePromiseThen).indexOf('[native code]') === -1) {\n    incrementExpectedAwaits = decrementExpectedAwaits = nop;\n}\nfunction onPossibleParallellAsync(possiblePromise) {\n    if (task.echoes && possiblePromise && possiblePromise.constructor === NativePromise) {\n        incrementExpectedAwaits();\n        return possiblePromise.then(x => {\n            decrementExpectedAwaits();\n            return x;\n        }, e => {\n            decrementExpectedAwaits();\n            return rejection(e);\n        });\n    }\n    return possiblePromise;\n}\nfunction zoneEnterEcho(targetZone) {\n    ++totalEchoes;\n    if (!task.echoes || --task.echoes === 0) {\n        task.echoes = task.awaits = task.id = 0;\n    }\n    zoneStack.push(PSD);\n    switchToZone(targetZone, true);\n}\nfunction zoneLeaveEcho() {\n    var zone = zoneStack[zoneStack.length - 1];\n    zoneStack.pop();\n    switchToZone(zone, false);\n}\nfunction switchToZone(targetZone, bEnteringZone) {\n    var currentZone = PSD;\n    if (bEnteringZone ? task.echoes && (!zoneEchoes++ || targetZone !== PSD) : zoneEchoes && (!--zoneEchoes || targetZone !== PSD)) {\n        queueMicrotask(bEnteringZone ? zoneEnterEcho.bind(null, targetZone) : zoneLeaveEcho);\n    }\n    if (targetZone === PSD)\n        return;\n    PSD = targetZone;\n    if (currentZone === globalPSD)\n        globalPSD.env = snapShot();\n    if (patchGlobalPromise) {\n        var GlobalPromise = globalPSD.env.Promise;\n        var targetEnv = targetZone.env;\n        if (currentZone.global || targetZone.global) {\n            Object.defineProperty(_global, 'Promise', targetEnv.PromiseProp);\n            GlobalPromise.all = targetEnv.all;\n            GlobalPromise.race = targetEnv.race;\n            GlobalPromise.resolve = targetEnv.resolve;\n            GlobalPromise.reject = targetEnv.reject;\n            if (targetEnv.allSettled)\n                GlobalPromise.allSettled = targetEnv.allSettled;\n            if (targetEnv.any)\n                GlobalPromise.any = targetEnv.any;\n        }\n    }\n}\nfunction snapShot() {\n    var GlobalPromise = _global.Promise;\n    return patchGlobalPromise ? {\n        Promise: GlobalPromise,\n        PromiseProp: Object.getOwnPropertyDescriptor(_global, \"Promise\"),\n        all: GlobalPromise.all,\n        race: GlobalPromise.race,\n        allSettled: GlobalPromise.allSettled,\n        any: GlobalPromise.any,\n        resolve: GlobalPromise.resolve,\n        reject: GlobalPromise.reject,\n    } : {};\n}\nfunction usePSD(psd, fn, a1, a2, a3) {\n    var outerScope = PSD;\n    try {\n        switchToZone(psd, true);\n        return fn(a1, a2, a3);\n    }\n    finally {\n        switchToZone(outerScope, false);\n    }\n}\nfunction nativeAwaitCompatibleWrap(fn, zone, possibleAwait, cleanup) {\n    return typeof fn !== 'function' ? fn : function () {\n        var outerZone = PSD;\n        if (possibleAwait)\n            incrementExpectedAwaits();\n        switchToZone(zone, true);\n        try {\n            return fn.apply(this, arguments);\n        }\n        finally {\n            switchToZone(outerZone, false);\n            if (cleanup)\n                queueMicrotask(decrementExpectedAwaits);\n        }\n    };\n}\nfunction execInGlobalContext(cb) {\n    if (Promise === NativePromise && task.echoes === 0) {\n        if (zoneEchoes === 0) {\n            cb();\n        }\n        else {\n            enqueueNativeMicroTask(cb);\n        }\n    }\n    else {\n        setTimeout(cb, 0);\n    }\n}\nvar rejection = DexiePromise.reject;\n\nfunction tempTransaction(db, mode, storeNames, fn) {\n    if (!db.idbdb || (!db._state.openComplete && (!PSD.letThrough && !db._vip))) {\n        if (db._state.openComplete) {\n            return rejection(new exceptions.DatabaseClosed(db._state.dbOpenError));\n        }\n        if (!db._state.isBeingOpened) {\n            if (!db._state.autoOpen)\n                return rejection(new exceptions.DatabaseClosed());\n            db.open().catch(nop);\n        }\n        return db._state.dbReadyPromise.then(() => tempTransaction(db, mode, storeNames, fn));\n    }\n    else {\n        var trans = db._createTransaction(mode, storeNames, db._dbSchema);\n        try {\n            trans.create();\n            db._state.PR1398_maxLoop = 3;\n        }\n        catch (ex) {\n            if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                console.warn('Dexie: Need to reopen db');\n                db.close({ disableAutoOpen: false });\n                return db.open().then(() => tempTransaction(db, mode, storeNames, fn));\n            }\n            return rejection(ex);\n        }\n        return trans._promise(mode, (resolve, reject) => {\n            return newScope(() => {\n                PSD.trans = trans;\n                return fn(resolve, reject, trans);\n            });\n        }).then(result => {\n            if (mode === 'readwrite')\n                try {\n                    trans.idbtrans.commit();\n                }\n                catch { }\n            return mode === 'readonly' ? result : trans._completion.then(() => result);\n        });\n    }\n}\n\nconst DEXIE_VERSION = '4.0.8';\nconst maxString = String.fromCharCode(65535);\nconst minKey = -Infinity;\nconst INVALID_KEY_ARGUMENT = \"Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.\";\nconst STRING_EXPECTED = \"String expected.\";\nconst connections = [];\nconst DBNAMES_DB = '__dbnames';\nconst READONLY = 'readonly';\nconst READWRITE = 'readwrite';\n\nfunction combine(filter1, filter2) {\n    return filter1 ?\n        filter2 ?\n            function () { return filter1.apply(this, arguments) && filter2.apply(this, arguments); } :\n            filter1 :\n        filter2;\n}\n\nconst AnyRange = {\n    type: 3 ,\n    lower: -Infinity,\n    lowerOpen: false,\n    upper: [[]],\n    upperOpen: false\n};\n\nfunction workaroundForUndefinedPrimKey(keyPath) {\n    return typeof keyPath === \"string\" && !/\\./.test(keyPath)\n        ? (obj) => {\n            if (obj[keyPath] === undefined && (keyPath in obj)) {\n                obj = deepClone(obj);\n                delete obj[keyPath];\n            }\n            return obj;\n        }\n        : (obj) => obj;\n}\n\nfunction Entity() {\n    throw exceptions.Type();\n}\n\nfunction cmp(a, b) {\n    try {\n        const ta = type(a);\n        const tb = type(b);\n        if (ta !== tb) {\n            if (ta === 'Array')\n                return 1;\n            if (tb === 'Array')\n                return -1;\n            if (ta === 'binary')\n                return 1;\n            if (tb === 'binary')\n                return -1;\n            if (ta === 'string')\n                return 1;\n            if (tb === 'string')\n                return -1;\n            if (ta === 'Date')\n                return 1;\n            if (tb !== 'Date')\n                return NaN;\n            return -1;\n        }\n        switch (ta) {\n            case 'number':\n            case 'Date':\n            case 'string':\n                return a > b ? 1 : a < b ? -1 : 0;\n            case 'binary': {\n                return compareUint8Arrays(getUint8Array(a), getUint8Array(b));\n            }\n            case 'Array':\n                return compareArrays(a, b);\n        }\n    }\n    catch { }\n    return NaN;\n}\nfunction compareArrays(a, b) {\n    const al = a.length;\n    const bl = b.length;\n    const l = al < bl ? al : bl;\n    for (let i = 0; i < l; ++i) {\n        const res = cmp(a[i], b[i]);\n        if (res !== 0)\n            return res;\n    }\n    return al === bl ? 0 : al < bl ? -1 : 1;\n}\nfunction compareUint8Arrays(a, b) {\n    const al = a.length;\n    const bl = b.length;\n    const l = al < bl ? al : bl;\n    for (let i = 0; i < l; ++i) {\n        if (a[i] !== b[i])\n            return a[i] < b[i] ? -1 : 1;\n    }\n    return al === bl ? 0 : al < bl ? -1 : 1;\n}\nfunction type(x) {\n    const t = typeof x;\n    if (t !== 'object')\n        return t;\n    if (ArrayBuffer.isView(x))\n        return 'binary';\n    const tsTag = toStringTag(x);\n    return tsTag === 'ArrayBuffer' ? 'binary' : tsTag;\n}\nfunction getUint8Array(a) {\n    if (a instanceof Uint8Array)\n        return a;\n    if (ArrayBuffer.isView(a))\n        return new Uint8Array(a.buffer, a.byteOffset, a.byteLength);\n    return new Uint8Array(a);\n}\n\nclass Table {\n    _trans(mode, fn, writeLocked) {\n        const trans = this._tx || PSD.trans;\n        const tableName = this.name;\n        const task = debug && typeof console !== 'undefined' && console.createTask && console.createTask(`Dexie: ${mode === 'readonly' ? 'read' : 'write'} ${this.name}`);\n        function checkTableInTransaction(resolve, reject, trans) {\n            if (!trans.schema[tableName])\n                throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n            return fn(trans.idbtrans, trans);\n        }\n        const wasRootExec = beginMicroTickScope();\n        try {\n            let p = trans && trans.db._novip === this.db._novip ?\n                trans === PSD.trans ?\n                    trans._promise(mode, checkTableInTransaction, writeLocked) :\n                    newScope(() => trans._promise(mode, checkTableInTransaction, writeLocked), { trans: trans, transless: PSD.transless || PSD }) :\n                tempTransaction(this.db, mode, [this.name], checkTableInTransaction);\n            if (task) {\n                p._consoleTask = task;\n                p = p.catch(err => {\n                    console.trace(err);\n                    return rejection(err);\n                });\n            }\n            return p;\n        }\n        finally {\n            if (wasRootExec)\n                endMicroTickScope();\n        }\n    }\n    get(keyOrCrit, cb) {\n        if (keyOrCrit && keyOrCrit.constructor === Object)\n            return this.where(keyOrCrit).first(cb);\n        if (keyOrCrit == null)\n            return rejection(new exceptions.Type(`Invalid argument to Table.get()`));\n        return this._trans('readonly', (trans) => {\n            return this.core.get({ trans, key: keyOrCrit })\n                .then(res => this.hook.reading.fire(res));\n        }).then(cb);\n    }\n    where(indexOrCrit) {\n        if (typeof indexOrCrit === 'string')\n            return new this.db.WhereClause(this, indexOrCrit);\n        if (isArray(indexOrCrit))\n            return new this.db.WhereClause(this, `[${indexOrCrit.join('+')}]`);\n        const keyPaths = keys(indexOrCrit);\n        if (keyPaths.length === 1)\n            return this\n                .where(keyPaths[0])\n                .equals(indexOrCrit[keyPaths[0]]);\n        const compoundIndex = this.schema.indexes.concat(this.schema.primKey).filter(ix => {\n            if (ix.compound &&\n                keyPaths.every(keyPath => ix.keyPath.indexOf(keyPath) >= 0)) {\n                for (let i = 0; i < keyPaths.length; ++i) {\n                    if (keyPaths.indexOf(ix.keyPath[i]) === -1)\n                        return false;\n                }\n                return true;\n            }\n            return false;\n        }).sort((a, b) => a.keyPath.length - b.keyPath.length)[0];\n        if (compoundIndex && this.db._maxKey !== maxString) {\n            const keyPathsInValidOrder = compoundIndex.keyPath.slice(0, keyPaths.length);\n            return this\n                .where(keyPathsInValidOrder)\n                .equals(keyPathsInValidOrder.map(kp => indexOrCrit[kp]));\n        }\n        if (!compoundIndex && debug)\n            console.warn(`The query ${JSON.stringify(indexOrCrit)} on ${this.name} would benefit from a ` +\n                `compound index [${keyPaths.join('+')}]`);\n        const { idxByName } = this.schema;\n        const idb = this.db._deps.indexedDB;\n        function equals(a, b) {\n            return idb.cmp(a, b) === 0;\n        }\n        const [idx, filterFunction] = keyPaths.reduce(([prevIndex, prevFilterFn], keyPath) => {\n            const index = idxByName[keyPath];\n            const value = indexOrCrit[keyPath];\n            return [\n                prevIndex || index,\n                prevIndex || !index ?\n                    combine(prevFilterFn, index && index.multi ?\n                        x => {\n                            const prop = getByKeyPath(x, keyPath);\n                            return isArray(prop) && prop.some(item => equals(value, item));\n                        } : x => equals(value, getByKeyPath(x, keyPath)))\n                    : prevFilterFn\n            ];\n        }, [null, null]);\n        return idx ?\n            this.where(idx.name).equals(indexOrCrit[idx.keyPath])\n                .filter(filterFunction) :\n            compoundIndex ?\n                this.filter(filterFunction) :\n                this.where(keyPaths).equals('');\n    }\n    filter(filterFunction) {\n        return this.toCollection().and(filterFunction);\n    }\n    count(thenShortcut) {\n        return this.toCollection().count(thenShortcut);\n    }\n    offset(offset) {\n        return this.toCollection().offset(offset);\n    }\n    limit(numRows) {\n        return this.toCollection().limit(numRows);\n    }\n    each(callback) {\n        return this.toCollection().each(callback);\n    }\n    toArray(thenShortcut) {\n        return this.toCollection().toArray(thenShortcut);\n    }\n    toCollection() {\n        return new this.db.Collection(new this.db.WhereClause(this));\n    }\n    orderBy(index) {\n        return new this.db.Collection(new this.db.WhereClause(this, isArray(index) ?\n            `[${index.join('+')}]` :\n            index));\n    }\n    reverse() {\n        return this.toCollection().reverse();\n    }\n    mapToClass(constructor) {\n        const { db, name: tableName } = this;\n        this.schema.mappedClass = constructor;\n        if (constructor.prototype instanceof Entity) {\n            constructor = class extends constructor {\n                get db() { return db; }\n                table() { return tableName; }\n            };\n        }\n        const inheritedProps = new Set();\n        for (let proto = constructor.prototype; proto; proto = getProto(proto)) {\n            Object.getOwnPropertyNames(proto).forEach(propName => inheritedProps.add(propName));\n        }\n        const readHook = (obj) => {\n            if (!obj)\n                return obj;\n            const res = Object.create(constructor.prototype);\n            for (let m in obj)\n                if (!inheritedProps.has(m))\n                    try {\n                        res[m] = obj[m];\n                    }\n                    catch (_) { }\n            return res;\n        };\n        if (this.schema.readHook) {\n            this.hook.reading.unsubscribe(this.schema.readHook);\n        }\n        this.schema.readHook = readHook;\n        this.hook(\"reading\", readHook);\n        return constructor;\n    }\n    defineClass() {\n        function Class(content) {\n            extend(this, content);\n        }\n        return this.mapToClass(Class);\n    }\n    add(obj, key) {\n        const { auto, keyPath } = this.schema.primKey;\n        let objToAdd = obj;\n        if (keyPath && auto) {\n            objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n        }\n        return this._trans('readwrite', trans => {\n            return this.core.mutate({ trans, type: 'add', keys: key != null ? [key] : null, values: [objToAdd] });\n        }).then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult)\n            .then(lastResult => {\n            if (keyPath) {\n                try {\n                    setByKeyPath(obj, keyPath, lastResult);\n                }\n                catch (_) { }\n            }\n            return lastResult;\n        });\n    }\n    update(keyOrObject, modifications) {\n        if (typeof keyOrObject === 'object' && !isArray(keyOrObject)) {\n            const key = getByKeyPath(keyOrObject, this.schema.primKey.keyPath);\n            if (key === undefined)\n                return rejection(new exceptions.InvalidArgument(\"Given object does not contain its primary key\"));\n            return this.where(\":id\").equals(key).modify(modifications);\n        }\n        else {\n            return this.where(\":id\").equals(keyOrObject).modify(modifications);\n        }\n    }\n    put(obj, key) {\n        const { auto, keyPath } = this.schema.primKey;\n        let objToAdd = obj;\n        if (keyPath && auto) {\n            objToAdd = workaroundForUndefinedPrimKey(keyPath)(obj);\n        }\n        return this._trans('readwrite', trans => this.core.mutate({ trans, type: 'put', values: [objToAdd], keys: key != null ? [key] : null }))\n            .then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : res.lastResult)\n            .then(lastResult => {\n            if (keyPath) {\n                try {\n                    setByKeyPath(obj, keyPath, lastResult);\n                }\n                catch (_) { }\n            }\n            return lastResult;\n        });\n    }\n    delete(key) {\n        return this._trans('readwrite', trans => this.core.mutate({ trans, type: 'delete', keys: [key] }))\n            .then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined);\n    }\n    clear() {\n        return this._trans('readwrite', trans => this.core.mutate({ trans, type: 'deleteRange', range: AnyRange }))\n            .then(res => res.numFailures ? DexiePromise.reject(res.failures[0]) : undefined);\n    }\n    bulkGet(keys) {\n        return this._trans('readonly', trans => {\n            return this.core.getMany({\n                keys,\n                trans\n            }).then(result => result.map(res => this.hook.reading.fire(res)));\n        });\n    }\n    bulkAdd(objects, keysOrOptions, options) {\n        const keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n        options = options || (keys ? undefined : keysOrOptions);\n        const wantResults = options ? options.allKeys : undefined;\n        return this._trans('readwrite', trans => {\n            const { auto, keyPath } = this.schema.primKey;\n            if (keyPath && keys)\n                throw new exceptions.InvalidArgument(\"bulkAdd(): keys argument invalid on tables with inbound keys\");\n            if (keys && keys.length !== objects.length)\n                throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n            const numObjects = objects.length;\n            let objectsToAdd = keyPath && auto ?\n                objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                objects;\n            return this.core.mutate({ trans, type: 'add', keys: keys, values: objectsToAdd, wantResults })\n                .then(({ numFailures, results, lastResult, failures }) => {\n                const result = wantResults ? results : lastResult;\n                if (numFailures === 0)\n                    return result;\n                throw new BulkError(`${this.name}.bulkAdd(): ${numFailures} of ${numObjects} operations failed`, failures);\n            });\n        });\n    }\n    bulkPut(objects, keysOrOptions, options) {\n        const keys = Array.isArray(keysOrOptions) ? keysOrOptions : undefined;\n        options = options || (keys ? undefined : keysOrOptions);\n        const wantResults = options ? options.allKeys : undefined;\n        return this._trans('readwrite', trans => {\n            const { auto, keyPath } = this.schema.primKey;\n            if (keyPath && keys)\n                throw new exceptions.InvalidArgument(\"bulkPut(): keys argument invalid on tables with inbound keys\");\n            if (keys && keys.length !== objects.length)\n                throw new exceptions.InvalidArgument(\"Arguments objects and keys must have the same length\");\n            const numObjects = objects.length;\n            let objectsToPut = keyPath && auto ?\n                objects.map(workaroundForUndefinedPrimKey(keyPath)) :\n                objects;\n            return this.core.mutate({ trans, type: 'put', keys: keys, values: objectsToPut, wantResults })\n                .then(({ numFailures, results, lastResult, failures }) => {\n                const result = wantResults ? results : lastResult;\n                if (numFailures === 0)\n                    return result;\n                throw new BulkError(`${this.name}.bulkPut(): ${numFailures} of ${numObjects} operations failed`, failures);\n            });\n        });\n    }\n    bulkUpdate(keysAndChanges) {\n        const coreTable = this.core;\n        const keys = keysAndChanges.map((entry) => entry.key);\n        const changeSpecs = keysAndChanges.map((entry) => entry.changes);\n        const offsetMap = [];\n        return this._trans('readwrite', (trans) => {\n            return coreTable.getMany({ trans, keys, cache: 'clone' }).then((objs) => {\n                const resultKeys = [];\n                const resultObjs = [];\n                keysAndChanges.forEach(({ key, changes }, idx) => {\n                    const obj = objs[idx];\n                    if (obj) {\n                        for (const keyPath of Object.keys(changes)) {\n                            const value = changes[keyPath];\n                            if (keyPath === this.schema.primKey.keyPath) {\n                                if (cmp(value, key) !== 0) {\n                                    throw new exceptions.Constraint(`Cannot update primary key in bulkUpdate()`);\n                                }\n                            }\n                            else {\n                                setByKeyPath(obj, keyPath, value);\n                            }\n                        }\n                        offsetMap.push(idx);\n                        resultKeys.push(key);\n                        resultObjs.push(obj);\n                    }\n                });\n                const numEntries = resultKeys.length;\n                return coreTable\n                    .mutate({\n                    trans,\n                    type: 'put',\n                    keys: resultKeys,\n                    values: resultObjs,\n                    updates: {\n                        keys,\n                        changeSpecs\n                    }\n                })\n                    .then(({ numFailures, failures }) => {\n                    if (numFailures === 0)\n                        return numEntries;\n                    for (const offset of Object.keys(failures)) {\n                        const mappedOffset = offsetMap[Number(offset)];\n                        if (mappedOffset != null) {\n                            const failure = failures[offset];\n                            delete failures[offset];\n                            failures[mappedOffset] = failure;\n                        }\n                    }\n                    throw new BulkError(`${this.name}.bulkUpdate(): ${numFailures} of ${numEntries} operations failed`, failures);\n                });\n            });\n        });\n    }\n    bulkDelete(keys) {\n        const numKeys = keys.length;\n        return this._trans('readwrite', trans => {\n            return this.core.mutate({ trans, type: 'delete', keys: keys });\n        }).then(({ numFailures, lastResult, failures }) => {\n            if (numFailures === 0)\n                return lastResult;\n            throw new BulkError(`${this.name}.bulkDelete(): ${numFailures} of ${numKeys} operations failed`, failures);\n        });\n    }\n}\n\nfunction Events(ctx) {\n    var evs = {};\n    var rv = function (eventName, subscriber) {\n        if (subscriber) {\n            var i = arguments.length, args = new Array(i - 1);\n            while (--i)\n                args[i - 1] = arguments[i];\n            evs[eventName].subscribe.apply(null, args);\n            return ctx;\n        }\n        else if (typeof (eventName) === 'string') {\n            return evs[eventName];\n        }\n    };\n    rv.addEventType = add;\n    for (var i = 1, l = arguments.length; i < l; ++i) {\n        add(arguments[i]);\n    }\n    return rv;\n    function add(eventName, chainFunction, defaultFunction) {\n        if (typeof eventName === 'object')\n            return addConfiguredEvents(eventName);\n        if (!chainFunction)\n            chainFunction = reverseStoppableEventChain;\n        if (!defaultFunction)\n            defaultFunction = nop;\n        var context = {\n            subscribers: [],\n            fire: defaultFunction,\n            subscribe: function (cb) {\n                if (context.subscribers.indexOf(cb) === -1) {\n                    context.subscribers.push(cb);\n                    context.fire = chainFunction(context.fire, cb);\n                }\n            },\n            unsubscribe: function (cb) {\n                context.subscribers = context.subscribers.filter(function (fn) { return fn !== cb; });\n                context.fire = context.subscribers.reduce(chainFunction, defaultFunction);\n            }\n        };\n        evs[eventName] = rv[eventName] = context;\n        return context;\n    }\n    function addConfiguredEvents(cfg) {\n        keys(cfg).forEach(function (eventName) {\n            var args = cfg[eventName];\n            if (isArray(args)) {\n                add(eventName, cfg[eventName][0], cfg[eventName][1]);\n            }\n            else if (args === 'asap') {\n                var context = add(eventName, mirror, function fire() {\n                    var i = arguments.length, args = new Array(i);\n                    while (i--)\n                        args[i] = arguments[i];\n                    context.subscribers.forEach(function (fn) {\n                        asap$1(function fireEvent() {\n                            fn.apply(null, args);\n                        });\n                    });\n                });\n            }\n            else\n                throw new exceptions.InvalidArgument(\"Invalid event config\");\n        });\n    }\n}\n\nfunction makeClassConstructor(prototype, constructor) {\n    derive(constructor).from({ prototype });\n    return constructor;\n}\n\nfunction createTableConstructor(db) {\n    return makeClassConstructor(Table.prototype, function Table(name, tableSchema, trans) {\n        this.db = db;\n        this._tx = trans;\n        this.name = name;\n        this.schema = tableSchema;\n        this.hook = db._allTables[name] ? db._allTables[name].hook : Events(null, {\n            \"creating\": [hookCreatingChain, nop],\n            \"reading\": [pureFunctionChain, mirror],\n            \"updating\": [hookUpdatingChain, nop],\n            \"deleting\": [hookDeletingChain, nop]\n        });\n    });\n}\n\nfunction isPlainKeyRange(ctx, ignoreLimitFilter) {\n    return !(ctx.filter || ctx.algorithm || ctx.or) &&\n        (ignoreLimitFilter ? ctx.justLimit : !ctx.replayFilter);\n}\nfunction addFilter(ctx, fn) {\n    ctx.filter = combine(ctx.filter, fn);\n}\nfunction addReplayFilter(ctx, factory, isLimitFilter) {\n    var curr = ctx.replayFilter;\n    ctx.replayFilter = curr ? () => combine(curr(), factory()) : factory;\n    ctx.justLimit = isLimitFilter && !curr;\n}\nfunction addMatchFilter(ctx, fn) {\n    ctx.isMatch = combine(ctx.isMatch, fn);\n}\nfunction getIndexOrStore(ctx, coreSchema) {\n    if (ctx.isPrimKey)\n        return coreSchema.primaryKey;\n    const index = coreSchema.getIndexByKeyPath(ctx.index);\n    if (!index)\n        throw new exceptions.Schema(\"KeyPath \" + ctx.index + \" on object store \" + coreSchema.name + \" is not indexed\");\n    return index;\n}\nfunction openCursor(ctx, coreTable, trans) {\n    const index = getIndexOrStore(ctx, coreTable.schema);\n    return coreTable.openCursor({\n        trans,\n        values: !ctx.keysOnly,\n        reverse: ctx.dir === 'prev',\n        unique: !!ctx.unique,\n        query: {\n            index,\n            range: ctx.range\n        }\n    });\n}\nfunction iter(ctx, fn, coreTrans, coreTable) {\n    const filter = ctx.replayFilter ? combine(ctx.filter, ctx.replayFilter()) : ctx.filter;\n    if (!ctx.or) {\n        return iterate(openCursor(ctx, coreTable, coreTrans), combine(ctx.algorithm, filter), fn, !ctx.keysOnly && ctx.valueMapper);\n    }\n    else {\n        const set = {};\n        const union = (item, cursor, advance) => {\n            if (!filter || filter(cursor, advance, result => cursor.stop(result), err => cursor.fail(err))) {\n                var primaryKey = cursor.primaryKey;\n                var key = '' + primaryKey;\n                if (key === '[object ArrayBuffer]')\n                    key = '' + new Uint8Array(primaryKey);\n                if (!hasOwn(set, key)) {\n                    set[key] = true;\n                    fn(item, cursor, advance);\n                }\n            }\n        };\n        return Promise.all([\n            ctx.or._iterate(union, coreTrans),\n            iterate(openCursor(ctx, coreTable, coreTrans), ctx.algorithm, union, !ctx.keysOnly && ctx.valueMapper)\n        ]);\n    }\n}\nfunction iterate(cursorPromise, filter, fn, valueMapper) {\n    var mappedFn = valueMapper ? (x, c, a) => fn(valueMapper(x), c, a) : fn;\n    var wrappedFn = wrap(mappedFn);\n    return cursorPromise.then(cursor => {\n        if (cursor) {\n            return cursor.start(() => {\n                var c = () => cursor.continue();\n                if (!filter || filter(cursor, advancer => c = advancer, val => { cursor.stop(val); c = nop; }, e => { cursor.fail(e); c = nop; }))\n                    wrappedFn(cursor.value, cursor, advancer => c = advancer);\n                c();\n            });\n        }\n    });\n}\n\nconst PropModSymbol = Symbol();\nclass PropModification {\n    execute(value) {\n        if (this.add !== undefined) {\n            const term = this.add;\n            if (isArray(term)) {\n                return [...(isArray(value) ? value : []), ...term].sort();\n            }\n            if (typeof term === 'number')\n                return (Number(value) || 0) + term;\n            if (typeof term === 'bigint') {\n                try {\n                    return BigInt(value) + term;\n                }\n                catch {\n                    return BigInt(0) + term;\n                }\n            }\n            throw new TypeError(`Invalid term ${term}`);\n        }\n        if (this.remove !== undefined) {\n            const subtrahend = this.remove;\n            if (isArray(subtrahend)) {\n                return isArray(value) ? value.filter(item => !subtrahend.includes(item)).sort() : [];\n            }\n            if (typeof subtrahend === 'number')\n                return Number(value) - subtrahend;\n            if (typeof subtrahend === 'bigint') {\n                try {\n                    return BigInt(value) - subtrahend;\n                }\n                catch {\n                    return BigInt(0) - subtrahend;\n                }\n            }\n            throw new TypeError(`Invalid subtrahend ${subtrahend}`);\n        }\n        const prefixToReplace = this.replacePrefix?.[0];\n        if (prefixToReplace && typeof value === 'string' && value.startsWith(prefixToReplace)) {\n            return this.replacePrefix[1] + value.substring(prefixToReplace.length);\n        }\n        return value;\n    }\n    constructor(spec) {\n        Object.assign(this, spec);\n    }\n}\n\nclass Collection {\n    _read(fn, cb) {\n        var ctx = this._ctx;\n        return ctx.error ?\n            ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n            ctx.table._trans('readonly', fn).then(cb);\n    }\n    _write(fn) {\n        var ctx = this._ctx;\n        return ctx.error ?\n            ctx.table._trans(null, rejection.bind(null, ctx.error)) :\n            ctx.table._trans('readwrite', fn, \"locked\");\n    }\n    _addAlgorithm(fn) {\n        var ctx = this._ctx;\n        ctx.algorithm = combine(ctx.algorithm, fn);\n    }\n    _iterate(fn, coreTrans) {\n        return iter(this._ctx, fn, coreTrans, this._ctx.table.core);\n    }\n    clone(props) {\n        var rv = Object.create(this.constructor.prototype), ctx = Object.create(this._ctx);\n        if (props)\n            extend(ctx, props);\n        rv._ctx = ctx;\n        return rv;\n    }\n    raw() {\n        this._ctx.valueMapper = null;\n        return this;\n    }\n    each(fn) {\n        var ctx = this._ctx;\n        return this._read(trans => iter(ctx, fn, trans, ctx.table.core));\n    }\n    count(cb) {\n        return this._read(trans => {\n            const ctx = this._ctx;\n            const coreTable = ctx.table.core;\n            if (isPlainKeyRange(ctx, true)) {\n                return coreTable.count({\n                    trans,\n                    query: {\n                        index: getIndexOrStore(ctx, coreTable.schema),\n                        range: ctx.range\n                    }\n                }).then(count => Math.min(count, ctx.limit));\n            }\n            else {\n                var count = 0;\n                return iter(ctx, () => { ++count; return false; }, trans, coreTable)\n                    .then(() => count);\n            }\n        }).then(cb);\n    }\n    sortBy(keyPath, cb) {\n        const parts = keyPath.split('.').reverse(), lastPart = parts[0], lastIndex = parts.length - 1;\n        function getval(obj, i) {\n            if (i)\n                return getval(obj[parts[i]], i - 1);\n            return obj[lastPart];\n        }\n        var order = this._ctx.dir === \"next\" ? 1 : -1;\n        function sorter(a, b) {\n            var aVal = getval(a, lastIndex), bVal = getval(b, lastIndex);\n            return aVal < bVal ? -order : aVal > bVal ? order : 0;\n        }\n        return this.toArray(function (a) {\n            return a.sort(sorter);\n        }).then(cb);\n    }\n    toArray(cb) {\n        return this._read(trans => {\n            var ctx = this._ctx;\n            if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n                const { valueMapper } = ctx;\n                const index = getIndexOrStore(ctx, ctx.table.core.schema);\n                return ctx.table.core.query({\n                    trans,\n                    limit: ctx.limit,\n                    values: true,\n                    query: {\n                        index,\n                        range: ctx.range\n                    }\n                }).then(({ result }) => valueMapper ? result.map(valueMapper) : result);\n            }\n            else {\n                const a = [];\n                return iter(ctx, item => a.push(item), trans, ctx.table.core).then(() => a);\n            }\n        }, cb);\n    }\n    offset(offset) {\n        var ctx = this._ctx;\n        if (offset <= 0)\n            return this;\n        ctx.offset += offset;\n        if (isPlainKeyRange(ctx)) {\n            addReplayFilter(ctx, () => {\n                var offsetLeft = offset;\n                return (cursor, advance) => {\n                    if (offsetLeft === 0)\n                        return true;\n                    if (offsetLeft === 1) {\n                        --offsetLeft;\n                        return false;\n                    }\n                    advance(() => {\n                        cursor.advance(offsetLeft);\n                        offsetLeft = 0;\n                    });\n                    return false;\n                };\n            });\n        }\n        else {\n            addReplayFilter(ctx, () => {\n                var offsetLeft = offset;\n                return () => (--offsetLeft < 0);\n            });\n        }\n        return this;\n    }\n    limit(numRows) {\n        this._ctx.limit = Math.min(this._ctx.limit, numRows);\n        addReplayFilter(this._ctx, () => {\n            var rowsLeft = numRows;\n            return function (cursor, advance, resolve) {\n                if (--rowsLeft <= 0)\n                    advance(resolve);\n                return rowsLeft >= 0;\n            };\n        }, true);\n        return this;\n    }\n    until(filterFunction, bIncludeStopEntry) {\n        addFilter(this._ctx, function (cursor, advance, resolve) {\n            if (filterFunction(cursor.value)) {\n                advance(resolve);\n                return bIncludeStopEntry;\n            }\n            else {\n                return true;\n            }\n        });\n        return this;\n    }\n    first(cb) {\n        return this.limit(1).toArray(function (a) { return a[0]; }).then(cb);\n    }\n    last(cb) {\n        return this.reverse().first(cb);\n    }\n    filter(filterFunction) {\n        addFilter(this._ctx, function (cursor) {\n            return filterFunction(cursor.value);\n        });\n        addMatchFilter(this._ctx, filterFunction);\n        return this;\n    }\n    and(filter) {\n        return this.filter(filter);\n    }\n    or(indexName) {\n        return new this.db.WhereClause(this._ctx.table, indexName, this);\n    }\n    reverse() {\n        this._ctx.dir = (this._ctx.dir === \"prev\" ? \"next\" : \"prev\");\n        if (this._ondirectionchange)\n            this._ondirectionchange(this._ctx.dir);\n        return this;\n    }\n    desc() {\n        return this.reverse();\n    }\n    eachKey(cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        return this.each(function (val, cursor) { cb(cursor.key, cursor); });\n    }\n    eachUniqueKey(cb) {\n        this._ctx.unique = \"unique\";\n        return this.eachKey(cb);\n    }\n    eachPrimaryKey(cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        return this.each(function (val, cursor) { cb(cursor.primaryKey, cursor); });\n    }\n    keys(cb) {\n        var ctx = this._ctx;\n        ctx.keysOnly = !ctx.isMatch;\n        var a = [];\n        return this.each(function (item, cursor) {\n            a.push(cursor.key);\n        }).then(function () {\n            return a;\n        }).then(cb);\n    }\n    primaryKeys(cb) {\n        var ctx = this._ctx;\n        if (ctx.dir === 'next' && isPlainKeyRange(ctx, true) && ctx.limit > 0) {\n            return this._read(trans => {\n                var index = getIndexOrStore(ctx, ctx.table.core.schema);\n                return ctx.table.core.query({\n                    trans,\n                    values: false,\n                    limit: ctx.limit,\n                    query: {\n                        index,\n                        range: ctx.range\n                    }\n                });\n            }).then(({ result }) => result).then(cb);\n        }\n        ctx.keysOnly = !ctx.isMatch;\n        var a = [];\n        return this.each(function (item, cursor) {\n            a.push(cursor.primaryKey);\n        }).then(function () {\n            return a;\n        }).then(cb);\n    }\n    uniqueKeys(cb) {\n        this._ctx.unique = \"unique\";\n        return this.keys(cb);\n    }\n    firstKey(cb) {\n        return this.limit(1).keys(function (a) { return a[0]; }).then(cb);\n    }\n    lastKey(cb) {\n        return this.reverse().firstKey(cb);\n    }\n    distinct() {\n        var ctx = this._ctx, idx = ctx.index && ctx.table.schema.idxByName[ctx.index];\n        if (!idx || !idx.multi)\n            return this;\n        var set = {};\n        addFilter(this._ctx, function (cursor) {\n            var strKey = cursor.primaryKey.toString();\n            var found = hasOwn(set, strKey);\n            set[strKey] = true;\n            return !found;\n        });\n        return this;\n    }\n    modify(changes) {\n        var ctx = this._ctx;\n        return this._write(trans => {\n            var modifyer;\n            if (typeof changes === 'function') {\n                modifyer = changes;\n            }\n            else {\n                var keyPaths = keys(changes);\n                var numKeys = keyPaths.length;\n                modifyer = function (item) {\n                    let anythingModified = false;\n                    for (let i = 0; i < numKeys; ++i) {\n                        let keyPath = keyPaths[i];\n                        let val = changes[keyPath];\n                        let origVal = getByKeyPath(item, keyPath);\n                        if (val instanceof PropModification) {\n                            setByKeyPath(item, keyPath, val.execute(origVal));\n                            anythingModified = true;\n                        }\n                        else if (origVal !== val) {\n                            setByKeyPath(item, keyPath, val);\n                            anythingModified = true;\n                        }\n                    }\n                    return anythingModified;\n                };\n            }\n            const coreTable = ctx.table.core;\n            const { outbound, extractKey } = coreTable.schema.primaryKey;\n            const limit = this.db._options.modifyChunkSize || 200;\n            const totalFailures = [];\n            let successCount = 0;\n            const failedKeys = [];\n            const applyMutateResult = (expectedCount, res) => {\n                const { failures, numFailures } = res;\n                successCount += expectedCount - numFailures;\n                for (let pos of keys(failures)) {\n                    totalFailures.push(failures[pos]);\n                }\n            };\n            return this.clone().primaryKeys().then(keys => {\n                const criteria = isPlainKeyRange(ctx) &&\n                    ctx.limit === Infinity &&\n                    (typeof changes !== 'function' || changes === deleteCallback) && {\n                    index: ctx.index,\n                    range: ctx.range\n                };\n                const nextChunk = (offset) => {\n                    const count = Math.min(limit, keys.length - offset);\n                    return coreTable.getMany({\n                        trans,\n                        keys: keys.slice(offset, offset + count),\n                        cache: \"immutable\"\n                    }).then(values => {\n                        const addValues = [];\n                        const putValues = [];\n                        const putKeys = outbound ? [] : null;\n                        const deleteKeys = [];\n                        for (let i = 0; i < count; ++i) {\n                            const origValue = values[i];\n                            const ctx = {\n                                value: deepClone(origValue),\n                                primKey: keys[offset + i]\n                            };\n                            if (modifyer.call(ctx, ctx.value, ctx) !== false) {\n                                if (ctx.value == null) {\n                                    deleteKeys.push(keys[offset + i]);\n                                }\n                                else if (!outbound && cmp(extractKey(origValue), extractKey(ctx.value)) !== 0) {\n                                    deleteKeys.push(keys[offset + i]);\n                                    addValues.push(ctx.value);\n                                }\n                                else {\n                                    putValues.push(ctx.value);\n                                    if (outbound)\n                                        putKeys.push(keys[offset + i]);\n                                }\n                            }\n                        }\n                        return Promise.resolve(addValues.length > 0 &&\n                            coreTable.mutate({ trans, type: 'add', values: addValues })\n                                .then(res => {\n                                for (let pos in res.failures) {\n                                    deleteKeys.splice(parseInt(pos), 1);\n                                }\n                                applyMutateResult(addValues.length, res);\n                            })).then(() => (putValues.length > 0 || (criteria && typeof changes === 'object')) &&\n                            coreTable.mutate({\n                                trans,\n                                type: 'put',\n                                keys: putKeys,\n                                values: putValues,\n                                criteria,\n                                changeSpec: typeof changes !== 'function'\n                                    && changes,\n                                isAdditionalChunk: offset > 0\n                            }).then(res => applyMutateResult(putValues.length, res))).then(() => (deleteKeys.length > 0 || (criteria && changes === deleteCallback)) &&\n                            coreTable.mutate({\n                                trans,\n                                type: 'delete',\n                                keys: deleteKeys,\n                                criteria,\n                                isAdditionalChunk: offset > 0\n                            }).then(res => applyMutateResult(deleteKeys.length, res))).then(() => {\n                            return keys.length > offset + count && nextChunk(offset + limit);\n                        });\n                    });\n                };\n                return nextChunk(0).then(() => {\n                    if (totalFailures.length > 0)\n                        throw new ModifyError(\"Error modifying one or more objects\", totalFailures, successCount, failedKeys);\n                    return keys.length;\n                });\n            });\n        });\n    }\n    delete() {\n        var ctx = this._ctx, range = ctx.range;\n        if (isPlainKeyRange(ctx) &&\n            (ctx.isPrimKey || range.type === 3 ))\n         {\n            return this._write(trans => {\n                const { primaryKey } = ctx.table.core.schema;\n                const coreRange = range;\n                return ctx.table.core.count({ trans, query: { index: primaryKey, range: coreRange } }).then(count => {\n                    return ctx.table.core.mutate({ trans, type: 'deleteRange', range: coreRange })\n                        .then(({ failures, lastResult, results, numFailures }) => {\n                        if (numFailures)\n                            throw new ModifyError(\"Could not delete some values\", Object.keys(failures).map(pos => failures[pos]), count - numFailures);\n                        return count - numFailures;\n                    });\n                });\n            });\n        }\n        return this.modify(deleteCallback);\n    }\n}\nconst deleteCallback = (value, ctx) => ctx.value = null;\n\nfunction createCollectionConstructor(db) {\n    return makeClassConstructor(Collection.prototype, function Collection(whereClause, keyRangeGenerator) {\n        this.db = db;\n        let keyRange = AnyRange, error = null;\n        if (keyRangeGenerator)\n            try {\n                keyRange = keyRangeGenerator();\n            }\n            catch (ex) {\n                error = ex;\n            }\n        const whereCtx = whereClause._ctx;\n        const table = whereCtx.table;\n        const readingHook = table.hook.reading.fire;\n        this._ctx = {\n            table: table,\n            index: whereCtx.index,\n            isPrimKey: (!whereCtx.index || (table.schema.primKey.keyPath && whereCtx.index === table.schema.primKey.name)),\n            range: keyRange,\n            keysOnly: false,\n            dir: \"next\",\n            unique: \"\",\n            algorithm: null,\n            filter: null,\n            replayFilter: null,\n            justLimit: true,\n            isMatch: null,\n            offset: 0,\n            limit: Infinity,\n            error: error,\n            or: whereCtx.or,\n            valueMapper: readingHook !== mirror ? readingHook : null\n        };\n    });\n}\n\nfunction simpleCompare(a, b) {\n    return a < b ? -1 : a === b ? 0 : 1;\n}\nfunction simpleCompareReverse(a, b) {\n    return a > b ? -1 : a === b ? 0 : 1;\n}\n\nfunction fail(collectionOrWhereClause, err, T) {\n    var collection = collectionOrWhereClause instanceof WhereClause ?\n        new collectionOrWhereClause.Collection(collectionOrWhereClause) :\n        collectionOrWhereClause;\n    collection._ctx.error = T ? new T(err) : new TypeError(err);\n    return collection;\n}\nfunction emptyCollection(whereClause) {\n    return new whereClause.Collection(whereClause, () => rangeEqual(\"\")).limit(0);\n}\nfunction upperFactory(dir) {\n    return dir === \"next\" ?\n        (s) => s.toUpperCase() :\n        (s) => s.toLowerCase();\n}\nfunction lowerFactory(dir) {\n    return dir === \"next\" ?\n        (s) => s.toLowerCase() :\n        (s) => s.toUpperCase();\n}\nfunction nextCasing(key, lowerKey, upperNeedle, lowerNeedle, cmp, dir) {\n    var length = Math.min(key.length, lowerNeedle.length);\n    var llp = -1;\n    for (var i = 0; i < length; ++i) {\n        var lwrKeyChar = lowerKey[i];\n        if (lwrKeyChar !== lowerNeedle[i]) {\n            if (cmp(key[i], upperNeedle[i]) < 0)\n                return key.substr(0, i) + upperNeedle[i] + upperNeedle.substr(i + 1);\n            if (cmp(key[i], lowerNeedle[i]) < 0)\n                return key.substr(0, i) + lowerNeedle[i] + upperNeedle.substr(i + 1);\n            if (llp >= 0)\n                return key.substr(0, llp) + lowerKey[llp] + upperNeedle.substr(llp + 1);\n            return null;\n        }\n        if (cmp(key[i], lwrKeyChar) < 0)\n            llp = i;\n    }\n    if (length < lowerNeedle.length && dir === \"next\")\n        return key + upperNeedle.substr(key.length);\n    if (length < key.length && dir === \"prev\")\n        return key.substr(0, upperNeedle.length);\n    return (llp < 0 ? null : key.substr(0, llp) + lowerNeedle[llp] + upperNeedle.substr(llp + 1));\n}\nfunction addIgnoreCaseAlgorithm(whereClause, match, needles, suffix) {\n    var upper, lower, compare, upperNeedles, lowerNeedles, direction, nextKeySuffix, needlesLen = needles.length;\n    if (!needles.every(s => typeof s === 'string')) {\n        return fail(whereClause, STRING_EXPECTED);\n    }\n    function initDirection(dir) {\n        upper = upperFactory(dir);\n        lower = lowerFactory(dir);\n        compare = (dir === \"next\" ? simpleCompare : simpleCompareReverse);\n        var needleBounds = needles.map(function (needle) {\n            return { lower: lower(needle), upper: upper(needle) };\n        }).sort(function (a, b) {\n            return compare(a.lower, b.lower);\n        });\n        upperNeedles = needleBounds.map(function (nb) { return nb.upper; });\n        lowerNeedles = needleBounds.map(function (nb) { return nb.lower; });\n        direction = dir;\n        nextKeySuffix = (dir === \"next\" ? \"\" : suffix);\n    }\n    initDirection(\"next\");\n    var c = new whereClause.Collection(whereClause, () => createRange(upperNeedles[0], lowerNeedles[needlesLen - 1] + suffix));\n    c._ondirectionchange = function (direction) {\n        initDirection(direction);\n    };\n    var firstPossibleNeedle = 0;\n    c._addAlgorithm(function (cursor, advance, resolve) {\n        var key = cursor.key;\n        if (typeof key !== 'string')\n            return false;\n        var lowerKey = lower(key);\n        if (match(lowerKey, lowerNeedles, firstPossibleNeedle)) {\n            return true;\n        }\n        else {\n            var lowestPossibleCasing = null;\n            for (var i = firstPossibleNeedle; i < needlesLen; ++i) {\n                var casing = nextCasing(key, lowerKey, upperNeedles[i], lowerNeedles[i], compare, direction);\n                if (casing === null && lowestPossibleCasing === null)\n                    firstPossibleNeedle = i + 1;\n                else if (lowestPossibleCasing === null || compare(lowestPossibleCasing, casing) > 0) {\n                    lowestPossibleCasing = casing;\n                }\n            }\n            if (lowestPossibleCasing !== null) {\n                advance(function () { cursor.continue(lowestPossibleCasing + nextKeySuffix); });\n            }\n            else {\n                advance(resolve);\n            }\n            return false;\n        }\n    });\n    return c;\n}\nfunction createRange(lower, upper, lowerOpen, upperOpen) {\n    return {\n        type: 2 ,\n        lower,\n        upper,\n        lowerOpen,\n        upperOpen\n    };\n}\nfunction rangeEqual(value) {\n    return {\n        type: 1 ,\n        lower: value,\n        upper: value\n    };\n}\n\nclass WhereClause {\n    get Collection() {\n        return this._ctx.table.db.Collection;\n    }\n    between(lower, upper, includeLower, includeUpper) {\n        includeLower = includeLower !== false;\n        includeUpper = includeUpper === true;\n        try {\n            if ((this._cmp(lower, upper) > 0) ||\n                (this._cmp(lower, upper) === 0 && (includeLower || includeUpper) && !(includeLower && includeUpper)))\n                return emptyCollection(this);\n            return new this.Collection(this, () => createRange(lower, upper, !includeLower, !includeUpper));\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n    }\n    equals(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => rangeEqual(value));\n    }\n    above(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(value, undefined, true));\n    }\n    aboveOrEqual(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(value, undefined, false));\n    }\n    below(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(undefined, value, false, true));\n    }\n    belowOrEqual(value) {\n        if (value == null)\n            return fail(this, INVALID_KEY_ARGUMENT);\n        return new this.Collection(this, () => createRange(undefined, value));\n    }\n    startsWith(str) {\n        if (typeof str !== 'string')\n            return fail(this, STRING_EXPECTED);\n        return this.between(str, str + maxString, true, true);\n    }\n    startsWithIgnoreCase(str) {\n        if (str === \"\")\n            return this.startsWith(str);\n        return addIgnoreCaseAlgorithm(this, (x, a) => x.indexOf(a[0]) === 0, [str], maxString);\n    }\n    equalsIgnoreCase(str) {\n        return addIgnoreCaseAlgorithm(this, (x, a) => x === a[0], [str], \"\");\n    }\n    anyOfIgnoreCase() {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return emptyCollection(this);\n        return addIgnoreCaseAlgorithm(this, (x, a) => a.indexOf(x) !== -1, set, \"\");\n    }\n    startsWithAnyOfIgnoreCase() {\n        var set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return emptyCollection(this);\n        return addIgnoreCaseAlgorithm(this, (x, a) => a.some(n => x.indexOf(n) === 0), set, maxString);\n    }\n    anyOf() {\n        const set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        let compare = this._cmp;\n        try {\n            set.sort(compare);\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        if (set.length === 0)\n            return emptyCollection(this);\n        const c = new this.Collection(this, () => createRange(set[0], set[set.length - 1]));\n        c._ondirectionchange = direction => {\n            compare = (direction === \"next\" ?\n                this._ascending :\n                this._descending);\n            set.sort(compare);\n        };\n        let i = 0;\n        c._addAlgorithm((cursor, advance, resolve) => {\n            const key = cursor.key;\n            while (compare(key, set[i]) > 0) {\n                ++i;\n                if (i === set.length) {\n                    advance(resolve);\n                    return false;\n                }\n            }\n            if (compare(key, set[i]) === 0) {\n                return true;\n            }\n            else {\n                advance(() => { cursor.continue(set[i]); });\n                return false;\n            }\n        });\n        return c;\n    }\n    notEqual(value) {\n        return this.inAnyRange([[minKey, value], [value, this.db._maxKey]], { includeLowers: false, includeUppers: false });\n    }\n    noneOf() {\n        const set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (set.length === 0)\n            return new this.Collection(this);\n        try {\n            set.sort(this._ascending);\n        }\n        catch (e) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        const ranges = set.reduce((res, val) => res ?\n            res.concat([[res[res.length - 1][1], val]]) :\n            [[minKey, val]], null);\n        ranges.push([set[set.length - 1], this.db._maxKey]);\n        return this.inAnyRange(ranges, { includeLowers: false, includeUppers: false });\n    }\n    inAnyRange(ranges, options) {\n        const cmp = this._cmp, ascending = this._ascending, descending = this._descending, min = this._min, max = this._max;\n        if (ranges.length === 0)\n            return emptyCollection(this);\n        if (!ranges.every(range => range[0] !== undefined &&\n            range[1] !== undefined &&\n            ascending(range[0], range[1]) <= 0)) {\n            return fail(this, \"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower\", exceptions.InvalidArgument);\n        }\n        const includeLowers = !options || options.includeLowers !== false;\n        const includeUppers = options && options.includeUppers === true;\n        function addRange(ranges, newRange) {\n            let i = 0, l = ranges.length;\n            for (; i < l; ++i) {\n                const range = ranges[i];\n                if (cmp(newRange[0], range[1]) < 0 && cmp(newRange[1], range[0]) > 0) {\n                    range[0] = min(range[0], newRange[0]);\n                    range[1] = max(range[1], newRange[1]);\n                    break;\n                }\n            }\n            if (i === l)\n                ranges.push(newRange);\n            return ranges;\n        }\n        let sortDirection = ascending;\n        function rangeSorter(a, b) { return sortDirection(a[0], b[0]); }\n        let set;\n        try {\n            set = ranges.reduce(addRange, []);\n            set.sort(rangeSorter);\n        }\n        catch (ex) {\n            return fail(this, INVALID_KEY_ARGUMENT);\n        }\n        let rangePos = 0;\n        const keyIsBeyondCurrentEntry = includeUppers ?\n            key => ascending(key, set[rangePos][1]) > 0 :\n            key => ascending(key, set[rangePos][1]) >= 0;\n        const keyIsBeforeCurrentEntry = includeLowers ?\n            key => descending(key, set[rangePos][0]) > 0 :\n            key => descending(key, set[rangePos][0]) >= 0;\n        function keyWithinCurrentRange(key) {\n            return !keyIsBeyondCurrentEntry(key) && !keyIsBeforeCurrentEntry(key);\n        }\n        let checkKey = keyIsBeyondCurrentEntry;\n        const c = new this.Collection(this, () => createRange(set[0][0], set[set.length - 1][1], !includeLowers, !includeUppers));\n        c._ondirectionchange = direction => {\n            if (direction === \"next\") {\n                checkKey = keyIsBeyondCurrentEntry;\n                sortDirection = ascending;\n            }\n            else {\n                checkKey = keyIsBeforeCurrentEntry;\n                sortDirection = descending;\n            }\n            set.sort(rangeSorter);\n        };\n        c._addAlgorithm((cursor, advance, resolve) => {\n            var key = cursor.key;\n            while (checkKey(key)) {\n                ++rangePos;\n                if (rangePos === set.length) {\n                    advance(resolve);\n                    return false;\n                }\n            }\n            if (keyWithinCurrentRange(key)) {\n                return true;\n            }\n            else if (this._cmp(key, set[rangePos][1]) === 0 || this._cmp(key, set[rangePos][0]) === 0) {\n                return false;\n            }\n            else {\n                advance(() => {\n                    if (sortDirection === ascending)\n                        cursor.continue(set[rangePos][0]);\n                    else\n                        cursor.continue(set[rangePos][1]);\n                });\n                return false;\n            }\n        });\n        return c;\n    }\n    startsWithAnyOf() {\n        const set = getArrayOf.apply(NO_CHAR_ARRAY, arguments);\n        if (!set.every(s => typeof s === 'string')) {\n            return fail(this, \"startsWithAnyOf() only works with strings\");\n        }\n        if (set.length === 0)\n            return emptyCollection(this);\n        return this.inAnyRange(set.map((str) => [str, str + maxString]));\n    }\n}\n\nfunction createWhereClauseConstructor(db) {\n    return makeClassConstructor(WhereClause.prototype, function WhereClause(table, index, orCollection) {\n        this.db = db;\n        this._ctx = {\n            table: table,\n            index: index === \":id\" ? null : index,\n            or: orCollection\n        };\n        this._cmp = this._ascending = cmp;\n        this._descending = (a, b) => cmp(b, a);\n        this._max = (a, b) => cmp(a, b) > 0 ? a : b;\n        this._min = (a, b) => cmp(a, b) < 0 ? a : b;\n        this._IDBKeyRange = db._deps.IDBKeyRange;\n        if (!this._IDBKeyRange)\n            throw new exceptions.MissingAPI();\n    });\n}\n\nfunction eventRejectHandler(reject) {\n    return wrap(function (event) {\n        preventDefault(event);\n        reject(event.target.error);\n        return false;\n    });\n}\nfunction preventDefault(event) {\n    if (event.stopPropagation)\n        event.stopPropagation();\n    if (event.preventDefault)\n        event.preventDefault();\n}\n\nconst DEXIE_STORAGE_MUTATED_EVENT_NAME = 'storagemutated';\nconst STORAGE_MUTATED_DOM_EVENT_NAME = 'x-storagemutated-1';\nconst globalEvents = Events(null, DEXIE_STORAGE_MUTATED_EVENT_NAME);\n\nclass Transaction {\n    _lock() {\n        assert(!PSD.global);\n        ++this._reculock;\n        if (this._reculock === 1 && !PSD.global)\n            PSD.lockOwnerFor = this;\n        return this;\n    }\n    _unlock() {\n        assert(!PSD.global);\n        if (--this._reculock === 0) {\n            if (!PSD.global)\n                PSD.lockOwnerFor = null;\n            while (this._blockedFuncs.length > 0 && !this._locked()) {\n                var fnAndPSD = this._blockedFuncs.shift();\n                try {\n                    usePSD(fnAndPSD[1], fnAndPSD[0]);\n                }\n                catch (e) { }\n            }\n        }\n        return this;\n    }\n    _locked() {\n        return this._reculock && PSD.lockOwnerFor !== this;\n    }\n    create(idbtrans) {\n        if (!this.mode)\n            return this;\n        const idbdb = this.db.idbdb;\n        const dbOpenError = this.db._state.dbOpenError;\n        assert(!this.idbtrans);\n        if (!idbtrans && !idbdb) {\n            switch (dbOpenError && dbOpenError.name) {\n                case \"DatabaseClosedError\":\n                    throw new exceptions.DatabaseClosed(dbOpenError);\n                case \"MissingAPIError\":\n                    throw new exceptions.MissingAPI(dbOpenError.message, dbOpenError);\n                default:\n                    throw new exceptions.OpenFailed(dbOpenError);\n            }\n        }\n        if (!this.active)\n            throw new exceptions.TransactionInactive();\n        assert(this._completion._state === null);\n        idbtrans = this.idbtrans = idbtrans ||\n            (this.db.core\n                ? this.db.core.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability })\n                : idbdb.transaction(this.storeNames, this.mode, { durability: this.chromeTransactionDurability }));\n        idbtrans.onerror = wrap(ev => {\n            preventDefault(ev);\n            this._reject(idbtrans.error);\n        });\n        idbtrans.onabort = wrap(ev => {\n            preventDefault(ev);\n            this.active && this._reject(new exceptions.Abort(idbtrans.error));\n            this.active = false;\n            this.on(\"abort\").fire(ev);\n        });\n        idbtrans.oncomplete = wrap(() => {\n            this.active = false;\n            this._resolve();\n            if ('mutatedParts' in idbtrans) {\n                globalEvents.storagemutated.fire(idbtrans[\"mutatedParts\"]);\n            }\n        });\n        return this;\n    }\n    _promise(mode, fn, bWriteLock) {\n        if (mode === 'readwrite' && this.mode !== 'readwrite')\n            return rejection(new exceptions.ReadOnly(\"Transaction is readonly\"));\n        if (!this.active)\n            return rejection(new exceptions.TransactionInactive());\n        if (this._locked()) {\n            return new DexiePromise((resolve, reject) => {\n                this._blockedFuncs.push([() => {\n                        this._promise(mode, fn, bWriteLock).then(resolve, reject);\n                    }, PSD]);\n            });\n        }\n        else if (bWriteLock) {\n            return newScope(() => {\n                var p = new DexiePromise((resolve, reject) => {\n                    this._lock();\n                    const rv = fn(resolve, reject, this);\n                    if (rv && rv.then)\n                        rv.then(resolve, reject);\n                });\n                p.finally(() => this._unlock());\n                p._lib = true;\n                return p;\n            });\n        }\n        else {\n            var p = new DexiePromise((resolve, reject) => {\n                var rv = fn(resolve, reject, this);\n                if (rv && rv.then)\n                    rv.then(resolve, reject);\n            });\n            p._lib = true;\n            return p;\n        }\n    }\n    _root() {\n        return this.parent ? this.parent._root() : this;\n    }\n    waitFor(promiseLike) {\n        var root = this._root();\n        const promise = DexiePromise.resolve(promiseLike);\n        if (root._waitingFor) {\n            root._waitingFor = root._waitingFor.then(() => promise);\n        }\n        else {\n            root._waitingFor = promise;\n            root._waitingQueue = [];\n            var store = root.idbtrans.objectStore(root.storeNames[0]);\n            (function spin() {\n                ++root._spinCount;\n                while (root._waitingQueue.length)\n                    (root._waitingQueue.shift())();\n                if (root._waitingFor)\n                    store.get(-Infinity).onsuccess = spin;\n            }());\n        }\n        var currentWaitPromise = root._waitingFor;\n        return new DexiePromise((resolve, reject) => {\n            promise.then(res => root._waitingQueue.push(wrap(resolve.bind(null, res))), err => root._waitingQueue.push(wrap(reject.bind(null, err)))).finally(() => {\n                if (root._waitingFor === currentWaitPromise) {\n                    root._waitingFor = null;\n                }\n            });\n        });\n    }\n    abort() {\n        if (this.active) {\n            this.active = false;\n            if (this.idbtrans)\n                this.idbtrans.abort();\n            this._reject(new exceptions.Abort());\n        }\n    }\n    table(tableName) {\n        const memoizedTables = (this._memoizedTables || (this._memoizedTables = {}));\n        if (hasOwn(memoizedTables, tableName))\n            return memoizedTables[tableName];\n        const tableSchema = this.schema[tableName];\n        if (!tableSchema) {\n            throw new exceptions.NotFound(\"Table \" + tableName + \" not part of transaction\");\n        }\n        const transactionBoundTable = new this.db.Table(tableName, tableSchema, this);\n        transactionBoundTable.core = this.db.core.table(tableName);\n        memoizedTables[tableName] = transactionBoundTable;\n        return transactionBoundTable;\n    }\n}\n\nfunction createTransactionConstructor(db) {\n    return makeClassConstructor(Transaction.prototype, function Transaction(mode, storeNames, dbschema, chromeTransactionDurability, parent) {\n        this.db = db;\n        this.mode = mode;\n        this.storeNames = storeNames;\n        this.schema = dbschema;\n        this.chromeTransactionDurability = chromeTransactionDurability;\n        this.idbtrans = null;\n        this.on = Events(this, \"complete\", \"error\", \"abort\");\n        this.parent = parent || null;\n        this.active = true;\n        this._reculock = 0;\n        this._blockedFuncs = [];\n        this._resolve = null;\n        this._reject = null;\n        this._waitingFor = null;\n        this._waitingQueue = null;\n        this._spinCount = 0;\n        this._completion = new DexiePromise((resolve, reject) => {\n            this._resolve = resolve;\n            this._reject = reject;\n        });\n        this._completion.then(() => {\n            this.active = false;\n            this.on.complete.fire();\n        }, e => {\n            var wasActive = this.active;\n            this.active = false;\n            this.on.error.fire(e);\n            this.parent ?\n                this.parent._reject(e) :\n                wasActive && this.idbtrans && this.idbtrans.abort();\n            return rejection(e);\n        });\n    });\n}\n\nfunction createIndexSpec(name, keyPath, unique, multi, auto, compound, isPrimKey) {\n    return {\n        name,\n        keyPath,\n        unique,\n        multi,\n        auto,\n        compound,\n        src: (unique && !isPrimKey ? '&' : '') + (multi ? '*' : '') + (auto ? \"++\" : \"\") + nameFromKeyPath(keyPath)\n    };\n}\nfunction nameFromKeyPath(keyPath) {\n    return typeof keyPath === 'string' ?\n        keyPath :\n        keyPath ? ('[' + [].join.call(keyPath, '+') + ']') : \"\";\n}\n\nfunction createTableSchema(name, primKey, indexes) {\n    return {\n        name,\n        primKey,\n        indexes,\n        mappedClass: null,\n        idxByName: arrayToObject(indexes, index => [index.name, index])\n    };\n}\n\nfunction safariMultiStoreFix(storeNames) {\n    return storeNames.length === 1 ? storeNames[0] : storeNames;\n}\nlet getMaxKey = (IdbKeyRange) => {\n    try {\n        IdbKeyRange.only([[]]);\n        getMaxKey = () => [[]];\n        return [[]];\n    }\n    catch (e) {\n        getMaxKey = () => maxString;\n        return maxString;\n    }\n};\n\nfunction getKeyExtractor(keyPath) {\n    if (keyPath == null) {\n        return () => undefined;\n    }\n    else if (typeof keyPath === 'string') {\n        return getSinglePathKeyExtractor(keyPath);\n    }\n    else {\n        return obj => getByKeyPath(obj, keyPath);\n    }\n}\nfunction getSinglePathKeyExtractor(keyPath) {\n    const split = keyPath.split('.');\n    if (split.length === 1) {\n        return obj => obj[keyPath];\n    }\n    else {\n        return obj => getByKeyPath(obj, keyPath);\n    }\n}\n\nfunction arrayify(arrayLike) {\n    return [].slice.call(arrayLike);\n}\nlet _id_counter = 0;\nfunction getKeyPathAlias(keyPath) {\n    return keyPath == null ?\n        \":id\" :\n        typeof keyPath === 'string' ?\n            keyPath :\n            `[${keyPath.join('+')}]`;\n}\nfunction createDBCore(db, IdbKeyRange, tmpTrans) {\n    function extractSchema(db, trans) {\n        const tables = arrayify(db.objectStoreNames);\n        return {\n            schema: {\n                name: db.name,\n                tables: tables.map(table => trans.objectStore(table)).map(store => {\n                    const { keyPath, autoIncrement } = store;\n                    const compound = isArray(keyPath);\n                    const outbound = keyPath == null;\n                    const indexByKeyPath = {};\n                    const result = {\n                        name: store.name,\n                        primaryKey: {\n                            name: null,\n                            isPrimaryKey: true,\n                            outbound,\n                            compound,\n                            keyPath,\n                            autoIncrement,\n                            unique: true,\n                            extractKey: getKeyExtractor(keyPath)\n                        },\n                        indexes: arrayify(store.indexNames).map(indexName => store.index(indexName))\n                            .map(index => {\n                            const { name, unique, multiEntry, keyPath } = index;\n                            const compound = isArray(keyPath);\n                            const result = {\n                                name,\n                                compound,\n                                keyPath,\n                                unique,\n                                multiEntry,\n                                extractKey: getKeyExtractor(keyPath)\n                            };\n                            indexByKeyPath[getKeyPathAlias(keyPath)] = result;\n                            return result;\n                        }),\n                        getIndexByKeyPath: (keyPath) => indexByKeyPath[getKeyPathAlias(keyPath)]\n                    };\n                    indexByKeyPath[\":id\"] = result.primaryKey;\n                    if (keyPath != null) {\n                        indexByKeyPath[getKeyPathAlias(keyPath)] = result.primaryKey;\n                    }\n                    return result;\n                })\n            },\n            hasGetAll: tables.length > 0 && ('getAll' in trans.objectStore(tables[0])) &&\n                !(typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n                    !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n                    [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604)\n        };\n    }\n    function makeIDBKeyRange(range) {\n        if (range.type === 3 )\n            return null;\n        if (range.type === 4 )\n            throw new Error(\"Cannot convert never type to IDBKeyRange\");\n        const { lower, upper, lowerOpen, upperOpen } = range;\n        const idbRange = lower === undefined ?\n            upper === undefined ?\n                null :\n                IdbKeyRange.upperBound(upper, !!upperOpen) :\n            upper === undefined ?\n                IdbKeyRange.lowerBound(lower, !!lowerOpen) :\n                IdbKeyRange.bound(lower, upper, !!lowerOpen, !!upperOpen);\n        return idbRange;\n    }\n    function createDbCoreTable(tableSchema) {\n        const tableName = tableSchema.name;\n        function mutate({ trans, type, keys, values, range }) {\n            return new Promise((resolve, reject) => {\n                resolve = wrap(resolve);\n                const store = trans.objectStore(tableName);\n                const outbound = store.keyPath == null;\n                const isAddOrPut = type === \"put\" || type === \"add\";\n                if (!isAddOrPut && type !== 'delete' && type !== 'deleteRange')\n                    throw new Error(\"Invalid operation type: \" + type);\n                const { length } = keys || values || { length: 1 };\n                if (keys && values && keys.length !== values.length) {\n                    throw new Error(\"Given keys array must have same length as given values array.\");\n                }\n                if (length === 0)\n                    return resolve({ numFailures: 0, failures: {}, results: [], lastResult: undefined });\n                let req;\n                const reqs = [];\n                const failures = [];\n                let numFailures = 0;\n                const errorHandler = event => {\n                    ++numFailures;\n                    preventDefault(event);\n                };\n                if (type === 'deleteRange') {\n                    if (range.type === 4 )\n                        return resolve({ numFailures, failures, results: [], lastResult: undefined });\n                    if (range.type === 3 )\n                        reqs.push(req = store.clear());\n                    else\n                        reqs.push(req = store.delete(makeIDBKeyRange(range)));\n                }\n                else {\n                    const [args1, args2] = isAddOrPut ?\n                        outbound ?\n                            [values, keys] :\n                            [values, null] :\n                        [keys, null];\n                    if (isAddOrPut) {\n                        for (let i = 0; i < length; ++i) {\n                            reqs.push(req = (args2 && args2[i] !== undefined ?\n                                store[type](args1[i], args2[i]) :\n                                store[type](args1[i])));\n                            req.onerror = errorHandler;\n                        }\n                    }\n                    else {\n                        for (let i = 0; i < length; ++i) {\n                            reqs.push(req = store[type](args1[i]));\n                            req.onerror = errorHandler;\n                        }\n                    }\n                }\n                const done = event => {\n                    const lastResult = event.target.result;\n                    reqs.forEach((req, i) => req.error != null && (failures[i] = req.error));\n                    resolve({\n                        numFailures,\n                        failures,\n                        results: type === \"delete\" ? keys : reqs.map(req => req.result),\n                        lastResult\n                    });\n                };\n                req.onerror = event => {\n                    errorHandler(event);\n                    done(event);\n                };\n                req.onsuccess = done;\n            });\n        }\n        function openCursor({ trans, values, query, reverse, unique }) {\n            return new Promise((resolve, reject) => {\n                resolve = wrap(resolve);\n                const { index, range } = query;\n                const store = trans.objectStore(tableName);\n                const source = index.isPrimaryKey ?\n                    store :\n                    store.index(index.name);\n                const direction = reverse ?\n                    unique ?\n                        \"prevunique\" :\n                        \"prev\" :\n                    unique ?\n                        \"nextunique\" :\n                        \"next\";\n                const req = values || !('openKeyCursor' in source) ?\n                    source.openCursor(makeIDBKeyRange(range), direction) :\n                    source.openKeyCursor(makeIDBKeyRange(range), direction);\n                req.onerror = eventRejectHandler(reject);\n                req.onsuccess = wrap(ev => {\n                    const cursor = req.result;\n                    if (!cursor) {\n                        resolve(null);\n                        return;\n                    }\n                    cursor.___id = ++_id_counter;\n                    cursor.done = false;\n                    const _cursorContinue = cursor.continue.bind(cursor);\n                    let _cursorContinuePrimaryKey = cursor.continuePrimaryKey;\n                    if (_cursorContinuePrimaryKey)\n                        _cursorContinuePrimaryKey = _cursorContinuePrimaryKey.bind(cursor);\n                    const _cursorAdvance = cursor.advance.bind(cursor);\n                    const doThrowCursorIsNotStarted = () => { throw new Error(\"Cursor not started\"); };\n                    const doThrowCursorIsStopped = () => { throw new Error(\"Cursor not stopped\"); };\n                    cursor.trans = trans;\n                    cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsNotStarted;\n                    cursor.fail = wrap(reject);\n                    cursor.next = function () {\n                        let gotOne = 1;\n                        return this.start(() => gotOne-- ? this.continue() : this.stop()).then(() => this);\n                    };\n                    cursor.start = (callback) => {\n                        const iterationPromise = new Promise((resolveIteration, rejectIteration) => {\n                            resolveIteration = wrap(resolveIteration);\n                            req.onerror = eventRejectHandler(rejectIteration);\n                            cursor.fail = rejectIteration;\n                            cursor.stop = value => {\n                                cursor.stop = cursor.continue = cursor.continuePrimaryKey = cursor.advance = doThrowCursorIsStopped;\n                                resolveIteration(value);\n                            };\n                        });\n                        const guardedCallback = () => {\n                            if (req.result) {\n                                try {\n                                    callback();\n                                }\n                                catch (err) {\n                                    cursor.fail(err);\n                                }\n                            }\n                            else {\n                                cursor.done = true;\n                                cursor.start = () => { throw new Error(\"Cursor behind last entry\"); };\n                                cursor.stop();\n                            }\n                        };\n                        req.onsuccess = wrap(ev => {\n                            req.onsuccess = guardedCallback;\n                            guardedCallback();\n                        });\n                        cursor.continue = _cursorContinue;\n                        cursor.continuePrimaryKey = _cursorContinuePrimaryKey;\n                        cursor.advance = _cursorAdvance;\n                        guardedCallback();\n                        return iterationPromise;\n                    };\n                    resolve(cursor);\n                }, reject);\n            });\n        }\n        function query(hasGetAll) {\n            return (request) => {\n                return new Promise((resolve, reject) => {\n                    resolve = wrap(resolve);\n                    const { trans, values, limit, query } = request;\n                    const nonInfinitLimit = limit === Infinity ? undefined : limit;\n                    const { index, range } = query;\n                    const store = trans.objectStore(tableName);\n                    const source = index.isPrimaryKey ? store : store.index(index.name);\n                    const idbKeyRange = makeIDBKeyRange(range);\n                    if (limit === 0)\n                        return resolve({ result: [] });\n                    if (hasGetAll) {\n                        const req = values ?\n                            source.getAll(idbKeyRange, nonInfinitLimit) :\n                            source.getAllKeys(idbKeyRange, nonInfinitLimit);\n                        req.onsuccess = event => resolve({ result: event.target.result });\n                        req.onerror = eventRejectHandler(reject);\n                    }\n                    else {\n                        let count = 0;\n                        const req = values || !('openKeyCursor' in source) ?\n                            source.openCursor(idbKeyRange) :\n                            source.openKeyCursor(idbKeyRange);\n                        const result = [];\n                        req.onsuccess = event => {\n                            const cursor = req.result;\n                            if (!cursor)\n                                return resolve({ result });\n                            result.push(values ? cursor.value : cursor.primaryKey);\n                            if (++count === limit)\n                                return resolve({ result });\n                            cursor.continue();\n                        };\n                        req.onerror = eventRejectHandler(reject);\n                    }\n                });\n            };\n        }\n        return {\n            name: tableName,\n            schema: tableSchema,\n            mutate,\n            getMany({ trans, keys }) {\n                return new Promise((resolve, reject) => {\n                    resolve = wrap(resolve);\n                    const store = trans.objectStore(tableName);\n                    const length = keys.length;\n                    const result = new Array(length);\n                    let keyCount = 0;\n                    let callbackCount = 0;\n                    let req;\n                    const successHandler = event => {\n                        const req = event.target;\n                        if ((result[req._pos] = req.result) != null)\n                            ;\n                        if (++callbackCount === keyCount)\n                            resolve(result);\n                    };\n                    const errorHandler = eventRejectHandler(reject);\n                    for (let i = 0; i < length; ++i) {\n                        const key = keys[i];\n                        if (key != null) {\n                            req = store.get(keys[i]);\n                            req._pos = i;\n                            req.onsuccess = successHandler;\n                            req.onerror = errorHandler;\n                            ++keyCount;\n                        }\n                    }\n                    if (keyCount === 0)\n                        resolve(result);\n                });\n            },\n            get({ trans, key }) {\n                return new Promise((resolve, reject) => {\n                    resolve = wrap(resolve);\n                    const store = trans.objectStore(tableName);\n                    const req = store.get(key);\n                    req.onsuccess = event => resolve(event.target.result);\n                    req.onerror = eventRejectHandler(reject);\n                });\n            },\n            query: query(hasGetAll),\n            openCursor,\n            count({ query, trans }) {\n                const { index, range } = query;\n                return new Promise((resolve, reject) => {\n                    const store = trans.objectStore(tableName);\n                    const source = index.isPrimaryKey ? store : store.index(index.name);\n                    const idbKeyRange = makeIDBKeyRange(range);\n                    const req = idbKeyRange ? source.count(idbKeyRange) : source.count();\n                    req.onsuccess = wrap(ev => resolve(ev.target.result));\n                    req.onerror = eventRejectHandler(reject);\n                });\n            }\n        };\n    }\n    const { schema, hasGetAll } = extractSchema(db, tmpTrans);\n    const tables = schema.tables.map(tableSchema => createDbCoreTable(tableSchema));\n    const tableMap = {};\n    tables.forEach(table => tableMap[table.name] = table);\n    return {\n        stack: \"dbcore\",\n        transaction: db.transaction.bind(db),\n        table(name) {\n            const result = tableMap[name];\n            if (!result)\n                throw new Error(`Table '${name}' not found`);\n            return tableMap[name];\n        },\n        MIN_KEY: -Infinity,\n        MAX_KEY: getMaxKey(IdbKeyRange),\n        schema\n    };\n}\n\nfunction createMiddlewareStack(stackImpl, middlewares) {\n    return middlewares.reduce((down, { create }) => ({ ...down, ...create(down) }), stackImpl);\n}\nfunction createMiddlewareStacks(middlewares, idbdb, { IDBKeyRange, indexedDB }, tmpTrans) {\n    const dbcore = createMiddlewareStack(createDBCore(idbdb, IDBKeyRange, tmpTrans), middlewares.dbcore);\n    return {\n        dbcore\n    };\n}\nfunction generateMiddlewareStacks(db, tmpTrans) {\n    const idbdb = tmpTrans.db;\n    const stacks = createMiddlewareStacks(db._middlewares, idbdb, db._deps, tmpTrans);\n    db.core = stacks.dbcore;\n    db.tables.forEach(table => {\n        const tableName = table.name;\n        if (db.core.schema.tables.some(tbl => tbl.name === tableName)) {\n            table.core = db.core.table(tableName);\n            if (db[tableName] instanceof db.Table) {\n                db[tableName].core = table.core;\n            }\n        }\n    });\n}\n\nfunction setApiOnPlace(db, objs, tableNames, dbschema) {\n    tableNames.forEach(tableName => {\n        const schema = dbschema[tableName];\n        objs.forEach(obj => {\n            const propDesc = getPropertyDescriptor(obj, tableName);\n            if (!propDesc || (\"value\" in propDesc && propDesc.value === undefined)) {\n                if (obj === db.Transaction.prototype || obj instanceof db.Transaction) {\n                    setProp(obj, tableName, {\n                        get() { return this.table(tableName); },\n                        set(value) {\n                            defineProperty(this, tableName, { value, writable: true, configurable: true, enumerable: true });\n                        }\n                    });\n                }\n                else {\n                    obj[tableName] = new db.Table(tableName, schema);\n                }\n            }\n        });\n    });\n}\nfunction removeTablesApi(db, objs) {\n    objs.forEach(obj => {\n        for (let key in obj) {\n            if (obj[key] instanceof db.Table)\n                delete obj[key];\n        }\n    });\n}\nfunction lowerVersionFirst(a, b) {\n    return a._cfg.version - b._cfg.version;\n}\nfunction runUpgraders(db, oldVersion, idbUpgradeTrans, reject) {\n    const globalSchema = db._dbSchema;\n    if (idbUpgradeTrans.objectStoreNames.contains('$meta') && !globalSchema.$meta) {\n        globalSchema.$meta = createTableSchema(\"$meta\", parseIndexSyntax(\"\")[0], []);\n        db._storeNames.push('$meta');\n    }\n    const trans = db._createTransaction('readwrite', db._storeNames, globalSchema);\n    trans.create(idbUpgradeTrans);\n    trans._completion.catch(reject);\n    const rejectTransaction = trans._reject.bind(trans);\n    const transless = PSD.transless || PSD;\n    newScope(() => {\n        PSD.trans = trans;\n        PSD.transless = transless;\n        if (oldVersion === 0) {\n            keys(globalSchema).forEach(tableName => {\n                createTable(idbUpgradeTrans, tableName, globalSchema[tableName].primKey, globalSchema[tableName].indexes);\n            });\n            generateMiddlewareStacks(db, idbUpgradeTrans);\n            DexiePromise.follow(() => db.on.populate.fire(trans)).catch(rejectTransaction);\n        }\n        else {\n            generateMiddlewareStacks(db, idbUpgradeTrans);\n            return getExistingVersion(db, trans, oldVersion)\n                .then(oldVersion => updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans))\n                .catch(rejectTransaction);\n        }\n    });\n}\nfunction patchCurrentVersion(db, idbUpgradeTrans) {\n    createMissingTables(db._dbSchema, idbUpgradeTrans);\n    if (idbUpgradeTrans.db.version % 10 === 0 && !idbUpgradeTrans.objectStoreNames.contains('$meta')) {\n        idbUpgradeTrans.db.createObjectStore('$meta').add(Math.ceil((idbUpgradeTrans.db.version / 10) - 1), 'version');\n    }\n    const globalSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n    adjustToExistingIndexNames(db, db._dbSchema, idbUpgradeTrans);\n    const diff = getSchemaDiff(globalSchema, db._dbSchema);\n    for (const tableChange of diff.change) {\n        if (tableChange.change.length || tableChange.recreate) {\n            console.warn(`Unable to patch indexes of table ${tableChange.name} because it has changes on the type of index or primary key.`);\n            return;\n        }\n        const store = idbUpgradeTrans.objectStore(tableChange.name);\n        tableChange.add.forEach(idx => {\n            if (debug)\n                console.debug(`Dexie upgrade patch: Creating missing index ${tableChange.name}.${idx.src}`);\n            addIndex(store, idx);\n        });\n    }\n}\nfunction getExistingVersion(db, trans, oldVersion) {\n    if (trans.storeNames.includes('$meta')) {\n        return trans.table('$meta').get('version').then(metaVersion => {\n            return metaVersion != null ? metaVersion : oldVersion;\n        });\n    }\n    else {\n        return DexiePromise.resolve(oldVersion);\n    }\n}\nfunction updateTablesAndIndexes(db, oldVersion, trans, idbUpgradeTrans) {\n    const queue = [];\n    const versions = db._versions;\n    let globalSchema = db._dbSchema = buildGlobalSchema(db, db.idbdb, idbUpgradeTrans);\n    const versToRun = versions.filter(v => v._cfg.version >= oldVersion);\n    if (versToRun.length === 0) {\n        return DexiePromise.resolve();\n    }\n    versToRun.forEach(version => {\n        queue.push(() => {\n            const oldSchema = globalSchema;\n            const newSchema = version._cfg.dbschema;\n            adjustToExistingIndexNames(db, oldSchema, idbUpgradeTrans);\n            adjustToExistingIndexNames(db, newSchema, idbUpgradeTrans);\n            globalSchema = db._dbSchema = newSchema;\n            const diff = getSchemaDiff(oldSchema, newSchema);\n            diff.add.forEach(tuple => {\n                createTable(idbUpgradeTrans, tuple[0], tuple[1].primKey, tuple[1].indexes);\n            });\n            diff.change.forEach(change => {\n                if (change.recreate) {\n                    throw new exceptions.Upgrade(\"Not yet support for changing primary key\");\n                }\n                else {\n                    const store = idbUpgradeTrans.objectStore(change.name);\n                    change.add.forEach(idx => addIndex(store, idx));\n                    change.change.forEach(idx => {\n                        store.deleteIndex(idx.name);\n                        addIndex(store, idx);\n                    });\n                    change.del.forEach(idxName => store.deleteIndex(idxName));\n                }\n            });\n            const contentUpgrade = version._cfg.contentUpgrade;\n            if (contentUpgrade && version._cfg.version > oldVersion) {\n                generateMiddlewareStacks(db, idbUpgradeTrans);\n                trans._memoizedTables = {};\n                let upgradeSchema = shallowClone(newSchema);\n                diff.del.forEach(table => {\n                    upgradeSchema[table] = oldSchema[table];\n                });\n                removeTablesApi(db, [db.Transaction.prototype]);\n                setApiOnPlace(db, [db.Transaction.prototype], keys(upgradeSchema), upgradeSchema);\n                trans.schema = upgradeSchema;\n                const contentUpgradeIsAsync = isAsyncFunction(contentUpgrade);\n                if (contentUpgradeIsAsync) {\n                    incrementExpectedAwaits();\n                }\n                let returnValue;\n                const promiseFollowed = DexiePromise.follow(() => {\n                    returnValue = contentUpgrade(trans);\n                    if (returnValue) {\n                        if (contentUpgradeIsAsync) {\n                            var decrementor = decrementExpectedAwaits.bind(null, null);\n                            returnValue.then(decrementor, decrementor);\n                        }\n                    }\n                });\n                return (returnValue && typeof returnValue.then === 'function' ?\n                    DexiePromise.resolve(returnValue) : promiseFollowed.then(() => returnValue));\n            }\n        });\n        queue.push(idbtrans => {\n            const newSchema = version._cfg.dbschema;\n            deleteRemovedTables(newSchema, idbtrans);\n            removeTablesApi(db, [db.Transaction.prototype]);\n            setApiOnPlace(db, [db.Transaction.prototype], db._storeNames, db._dbSchema);\n            trans.schema = db._dbSchema;\n        });\n        queue.push(idbtrans => {\n            if (db.idbdb.objectStoreNames.contains('$meta')) {\n                if (Math.ceil(db.idbdb.version / 10) === version._cfg.version) {\n                    db.idbdb.deleteObjectStore('$meta');\n                    delete db._dbSchema.$meta;\n                    db._storeNames = db._storeNames.filter(name => name !== '$meta');\n                }\n                else {\n                    idbtrans.objectStore('$meta').put(version._cfg.version, 'version');\n                }\n            }\n        });\n    });\n    function runQueue() {\n        return queue.length ? DexiePromise.resolve(queue.shift()(trans.idbtrans)).then(runQueue) :\n            DexiePromise.resolve();\n    }\n    return runQueue().then(() => {\n        createMissingTables(globalSchema, idbUpgradeTrans);\n    });\n}\nfunction getSchemaDiff(oldSchema, newSchema) {\n    const diff = {\n        del: [],\n        add: [],\n        change: []\n    };\n    let table;\n    for (table in oldSchema) {\n        if (!newSchema[table])\n            diff.del.push(table);\n    }\n    for (table in newSchema) {\n        const oldDef = oldSchema[table], newDef = newSchema[table];\n        if (!oldDef) {\n            diff.add.push([table, newDef]);\n        }\n        else {\n            const change = {\n                name: table,\n                def: newDef,\n                recreate: false,\n                del: [],\n                add: [],\n                change: []\n            };\n            if ((\n            '' + (oldDef.primKey.keyPath || '')) !== ('' + (newDef.primKey.keyPath || '')) ||\n                (oldDef.primKey.auto !== newDef.primKey.auto)) {\n                change.recreate = true;\n                diff.change.push(change);\n            }\n            else {\n                const oldIndexes = oldDef.idxByName;\n                const newIndexes = newDef.idxByName;\n                let idxName;\n                for (idxName in oldIndexes) {\n                    if (!newIndexes[idxName])\n                        change.del.push(idxName);\n                }\n                for (idxName in newIndexes) {\n                    const oldIdx = oldIndexes[idxName], newIdx = newIndexes[idxName];\n                    if (!oldIdx)\n                        change.add.push(newIdx);\n                    else if (oldIdx.src !== newIdx.src)\n                        change.change.push(newIdx);\n                }\n                if (change.del.length > 0 || change.add.length > 0 || change.change.length > 0) {\n                    diff.change.push(change);\n                }\n            }\n        }\n    }\n    return diff;\n}\nfunction createTable(idbtrans, tableName, primKey, indexes) {\n    const store = idbtrans.db.createObjectStore(tableName, primKey.keyPath ?\n        { keyPath: primKey.keyPath, autoIncrement: primKey.auto } :\n        { autoIncrement: primKey.auto });\n    indexes.forEach(idx => addIndex(store, idx));\n    return store;\n}\nfunction createMissingTables(newSchema, idbtrans) {\n    keys(newSchema).forEach(tableName => {\n        if (!idbtrans.db.objectStoreNames.contains(tableName)) {\n            if (debug)\n                console.debug('Dexie: Creating missing table', tableName);\n            createTable(idbtrans, tableName, newSchema[tableName].primKey, newSchema[tableName].indexes);\n        }\n    });\n}\nfunction deleteRemovedTables(newSchema, idbtrans) {\n    [].slice.call(idbtrans.db.objectStoreNames).forEach(storeName => newSchema[storeName] == null && idbtrans.db.deleteObjectStore(storeName));\n}\nfunction addIndex(store, idx) {\n    store.createIndex(idx.name, idx.keyPath, { unique: idx.unique, multiEntry: idx.multi });\n}\nfunction buildGlobalSchema(db, idbdb, tmpTrans) {\n    const globalSchema = {};\n    const dbStoreNames = slice(idbdb.objectStoreNames, 0);\n    dbStoreNames.forEach(storeName => {\n        const store = tmpTrans.objectStore(storeName);\n        let keyPath = store.keyPath;\n        const primKey = createIndexSpec(nameFromKeyPath(keyPath), keyPath || \"\", true, false, !!store.autoIncrement, keyPath && typeof keyPath !== \"string\", true);\n        const indexes = [];\n        for (let j = 0; j < store.indexNames.length; ++j) {\n            const idbindex = store.index(store.indexNames[j]);\n            keyPath = idbindex.keyPath;\n            var index = createIndexSpec(idbindex.name, keyPath, !!idbindex.unique, !!idbindex.multiEntry, false, keyPath && typeof keyPath !== \"string\", false);\n            indexes.push(index);\n        }\n        globalSchema[storeName] = createTableSchema(storeName, primKey, indexes);\n    });\n    return globalSchema;\n}\nfunction readGlobalSchema(db, idbdb, tmpTrans) {\n    db.verno = idbdb.version / 10;\n    const globalSchema = db._dbSchema = buildGlobalSchema(db, idbdb, tmpTrans);\n    db._storeNames = slice(idbdb.objectStoreNames, 0);\n    setApiOnPlace(db, [db._allTables], keys(globalSchema), globalSchema);\n}\nfunction verifyInstalledSchema(db, tmpTrans) {\n    const installedSchema = buildGlobalSchema(db, db.idbdb, tmpTrans);\n    const diff = getSchemaDiff(installedSchema, db._dbSchema);\n    return !(diff.add.length || diff.change.some(ch => ch.add.length || ch.change.length));\n}\nfunction adjustToExistingIndexNames(db, schema, idbtrans) {\n    const storeNames = idbtrans.db.objectStoreNames;\n    for (let i = 0; i < storeNames.length; ++i) {\n        const storeName = storeNames[i];\n        const store = idbtrans.objectStore(storeName);\n        db._hasGetAll = 'getAll' in store;\n        for (let j = 0; j < store.indexNames.length; ++j) {\n            const indexName = store.indexNames[j];\n            const keyPath = store.index(indexName).keyPath;\n            const dexieName = typeof keyPath === 'string' ? keyPath : \"[\" + slice(keyPath).join('+') + \"]\";\n            if (schema[storeName]) {\n                const indexSpec = schema[storeName].idxByName[dexieName];\n                if (indexSpec) {\n                    indexSpec.name = indexName;\n                    delete schema[storeName].idxByName[dexieName];\n                    schema[storeName].idxByName[indexName] = indexSpec;\n                }\n            }\n        }\n    }\n    if (typeof navigator !== 'undefined' && /Safari/.test(navigator.userAgent) &&\n        !/(Chrome\\/|Edge\\/)/.test(navigator.userAgent) &&\n        _global.WorkerGlobalScope && _global instanceof _global.WorkerGlobalScope &&\n        [].concat(navigator.userAgent.match(/Safari\\/(\\d*)/))[1] < 604) {\n        db._hasGetAll = false;\n    }\n}\nfunction parseIndexSyntax(primKeyAndIndexes) {\n    return primKeyAndIndexes.split(',').map((index, indexNum) => {\n        index = index.trim();\n        const name = index.replace(/([&*]|\\+\\+)/g, \"\");\n        const keyPath = /^\\[/.test(name) ? name.match(/^\\[(.*)\\]$/)[1].split('+') : name;\n        return createIndexSpec(name, keyPath || null, /\\&/.test(index), /\\*/.test(index), /\\+\\+/.test(index), isArray(keyPath), indexNum === 0);\n    });\n}\n\nclass Version {\n    _parseStoresSpec(stores, outSchema) {\n        keys(stores).forEach(tableName => {\n            if (stores[tableName] !== null) {\n                var indexes = parseIndexSyntax(stores[tableName]);\n                var primKey = indexes.shift();\n                primKey.unique = true;\n                if (primKey.multi)\n                    throw new exceptions.Schema(\"Primary key cannot be multi-valued\");\n                indexes.forEach(idx => {\n                    if (idx.auto)\n                        throw new exceptions.Schema(\"Only primary key can be marked as autoIncrement (++)\");\n                    if (!idx.keyPath)\n                        throw new exceptions.Schema(\"Index must have a name and cannot be an empty string\");\n                });\n                outSchema[tableName] = createTableSchema(tableName, primKey, indexes);\n            }\n        });\n    }\n    stores(stores) {\n        const db = this.db;\n        this._cfg.storesSource = this._cfg.storesSource ?\n            extend(this._cfg.storesSource, stores) :\n            stores;\n        const versions = db._versions;\n        const storesSpec = {};\n        let dbschema = {};\n        versions.forEach(version => {\n            extend(storesSpec, version._cfg.storesSource);\n            dbschema = (version._cfg.dbschema = {});\n            version._parseStoresSpec(storesSpec, dbschema);\n        });\n        db._dbSchema = dbschema;\n        removeTablesApi(db, [db._allTables, db, db.Transaction.prototype]);\n        setApiOnPlace(db, [db._allTables, db, db.Transaction.prototype, this._cfg.tables], keys(dbschema), dbschema);\n        db._storeNames = keys(dbschema);\n        return this;\n    }\n    upgrade(upgradeFunction) {\n        this._cfg.contentUpgrade = promisableChain(this._cfg.contentUpgrade || nop, upgradeFunction);\n        return this;\n    }\n}\n\nfunction createVersionConstructor(db) {\n    return makeClassConstructor(Version.prototype, function Version(versionNumber) {\n        this.db = db;\n        this._cfg = {\n            version: versionNumber,\n            storesSource: null,\n            dbschema: {},\n            tables: {},\n            contentUpgrade: null\n        };\n    });\n}\n\nfunction getDbNamesTable(indexedDB, IDBKeyRange) {\n    let dbNamesDB = indexedDB[\"_dbNamesDB\"];\n    if (!dbNamesDB) {\n        dbNamesDB = indexedDB[\"_dbNamesDB\"] = new Dexie$1(DBNAMES_DB, {\n            addons: [],\n            indexedDB,\n            IDBKeyRange,\n        });\n        dbNamesDB.version(1).stores({ dbnames: \"name\" });\n    }\n    return dbNamesDB.table(\"dbnames\");\n}\nfunction hasDatabasesNative(indexedDB) {\n    return indexedDB && typeof indexedDB.databases === \"function\";\n}\nfunction getDatabaseNames({ indexedDB, IDBKeyRange, }) {\n    return hasDatabasesNative(indexedDB)\n        ? Promise.resolve(indexedDB.databases()).then((infos) => infos\n            .map((info) => info.name)\n            .filter((name) => name !== DBNAMES_DB))\n        : getDbNamesTable(indexedDB, IDBKeyRange).toCollection().primaryKeys();\n}\nfunction _onDatabaseCreated({ indexedDB, IDBKeyRange }, name) {\n    !hasDatabasesNative(indexedDB) &&\n        name !== DBNAMES_DB &&\n        getDbNamesTable(indexedDB, IDBKeyRange).put({ name }).catch(nop);\n}\nfunction _onDatabaseDeleted({ indexedDB, IDBKeyRange }, name) {\n    !hasDatabasesNative(indexedDB) &&\n        name !== DBNAMES_DB &&\n        getDbNamesTable(indexedDB, IDBKeyRange).delete(name).catch(nop);\n}\n\nfunction vip(fn) {\n    return newScope(function () {\n        PSD.letThrough = true;\n        return fn();\n    });\n}\n\nfunction idbReady() {\n    var isSafari = !navigator.userAgentData &&\n        /Safari\\//.test(navigator.userAgent) &&\n        !/Chrom(e|ium)\\//.test(navigator.userAgent);\n    if (!isSafari || !indexedDB.databases)\n        return Promise.resolve();\n    var intervalId;\n    return new Promise(function (resolve) {\n        var tryIdb = function () { return indexedDB.databases().finally(resolve); };\n        intervalId = setInterval(tryIdb, 100);\n        tryIdb();\n    }).finally(function () { return clearInterval(intervalId); });\n}\n\nfunction isEmptyRange(node) {\n    return !(\"from\" in node);\n}\nconst RangeSet = function (fromOrTree, to) {\n    if (this) {\n        extend(this, arguments.length ? { d: 1, from: fromOrTree, to: arguments.length > 1 ? to : fromOrTree } : { d: 0 });\n    }\n    else {\n        const rv = new RangeSet();\n        if (fromOrTree && (\"d\" in fromOrTree)) {\n            extend(rv, fromOrTree);\n        }\n        return rv;\n    }\n};\nprops(RangeSet.prototype, {\n    add(rangeSet) {\n        mergeRanges(this, rangeSet);\n        return this;\n    },\n    addKey(key) {\n        addRange(this, key, key);\n        return this;\n    },\n    addKeys(keys) {\n        keys.forEach(key => addRange(this, key, key));\n        return this;\n    },\n    hasKey(key) {\n        const node = getRangeSetIterator(this).next(key).value;\n        return node && cmp(node.from, key) <= 0 && cmp(node.to, key) >= 0;\n    },\n    [iteratorSymbol]() {\n        return getRangeSetIterator(this);\n    }\n});\nfunction addRange(target, from, to) {\n    const diff = cmp(from, to);\n    if (isNaN(diff))\n        return;\n    if (diff > 0)\n        throw RangeError();\n    if (isEmptyRange(target))\n        return extend(target, { from, to, d: 1 });\n    const left = target.l;\n    const right = target.r;\n    if (cmp(to, target.from) < 0) {\n        left\n            ? addRange(left, from, to)\n            : (target.l = { from, to, d: 1, l: null, r: null });\n        return rebalance(target);\n    }\n    if (cmp(from, target.to) > 0) {\n        right\n            ? addRange(right, from, to)\n            : (target.r = { from, to, d: 1, l: null, r: null });\n        return rebalance(target);\n    }\n    if (cmp(from, target.from) < 0) {\n        target.from = from;\n        target.l = null;\n        target.d = right ? right.d + 1 : 1;\n    }\n    if (cmp(to, target.to) > 0) {\n        target.to = to;\n        target.r = null;\n        target.d = target.l ? target.l.d + 1 : 1;\n    }\n    const rightWasCutOff = !target.r;\n    if (left && !target.l) {\n        mergeRanges(target, left);\n    }\n    if (right && rightWasCutOff) {\n        mergeRanges(target, right);\n    }\n}\nfunction mergeRanges(target, newSet) {\n    function _addRangeSet(target, { from, to, l, r }) {\n        addRange(target, from, to);\n        if (l)\n            _addRangeSet(target, l);\n        if (r)\n            _addRangeSet(target, r);\n    }\n    if (!isEmptyRange(newSet))\n        _addRangeSet(target, newSet);\n}\nfunction rangesOverlap(rangeSet1, rangeSet2) {\n    const i1 = getRangeSetIterator(rangeSet2);\n    let nextResult1 = i1.next();\n    if (nextResult1.done)\n        return false;\n    let a = nextResult1.value;\n    const i2 = getRangeSetIterator(rangeSet1);\n    let nextResult2 = i2.next(a.from);\n    let b = nextResult2.value;\n    while (!nextResult1.done && !nextResult2.done) {\n        if (cmp(b.from, a.to) <= 0 && cmp(b.to, a.from) >= 0)\n            return true;\n        cmp(a.from, b.from) < 0\n            ? (a = (nextResult1 = i1.next(b.from)).value)\n            : (b = (nextResult2 = i2.next(a.from)).value);\n    }\n    return false;\n}\nfunction getRangeSetIterator(node) {\n    let state = isEmptyRange(node) ? null : { s: 0, n: node };\n    return {\n        next(key) {\n            const keyProvided = arguments.length > 0;\n            while (state) {\n                switch (state.s) {\n                    case 0:\n                        state.s = 1;\n                        if (keyProvided) {\n                            while (state.n.l && cmp(key, state.n.from) < 0)\n                                state = { up: state, n: state.n.l, s: 1 };\n                        }\n                        else {\n                            while (state.n.l)\n                                state = { up: state, n: state.n.l, s: 1 };\n                        }\n                    case 1:\n                        state.s = 2;\n                        if (!keyProvided || cmp(key, state.n.to) <= 0)\n                            return { value: state.n, done: false };\n                    case 2:\n                        if (state.n.r) {\n                            state.s = 3;\n                            state = { up: state, n: state.n.r, s: 0 };\n                            continue;\n                        }\n                    case 3:\n                        state = state.up;\n                }\n            }\n            return { done: true };\n        },\n    };\n}\nfunction rebalance(target) {\n    const diff = (target.r?.d || 0) - (target.l?.d || 0);\n    const r = diff > 1 ? \"r\" : diff < -1 ? \"l\" : \"\";\n    if (r) {\n        const l = r === \"r\" ? \"l\" : \"r\";\n        const rootClone = { ...target };\n        const oldRootRight = target[r];\n        target.from = oldRootRight.from;\n        target.to = oldRootRight.to;\n        target[r] = oldRootRight[r];\n        rootClone[r] = oldRootRight[l];\n        target[l] = rootClone;\n        rootClone.d = computeDepth(rootClone);\n    }\n    target.d = computeDepth(target);\n}\nfunction computeDepth({ r, l }) {\n    return (r ? (l ? Math.max(r.d, l.d) : r.d) : l ? l.d : 0) + 1;\n}\n\nfunction extendObservabilitySet(target, newSet) {\n    keys(newSet).forEach(part => {\n        if (target[part])\n            mergeRanges(target[part], newSet[part]);\n        else\n            target[part] = cloneSimpleObjectTree(newSet[part]);\n    });\n    return target;\n}\n\nfunction obsSetsOverlap(os1, os2) {\n    return os1.all || os2.all || Object.keys(os1).some((key) => os2[key] && rangesOverlap(os2[key], os1[key]));\n}\n\nconst cache = {};\n\nlet unsignaledParts = {};\nlet isTaskEnqueued = false;\nfunction signalSubscribersLazily(part, optimistic = false) {\n    extendObservabilitySet(unsignaledParts, part);\n    if (!isTaskEnqueued) {\n        isTaskEnqueued = true;\n        setTimeout(() => {\n            isTaskEnqueued = false;\n            const parts = unsignaledParts;\n            unsignaledParts = {};\n            signalSubscribersNow(parts, false);\n        }, 0);\n    }\n}\nfunction signalSubscribersNow(updatedParts, deleteAffectedCacheEntries = false) {\n    const queriesToSignal = new Set();\n    if (updatedParts.all) {\n        for (const tblCache of Object.values(cache)) {\n            collectTableSubscribers(tblCache, updatedParts, queriesToSignal, deleteAffectedCacheEntries);\n        }\n    }\n    else {\n        for (const key in updatedParts) {\n            const parts = /^idb\\:\\/\\/(.*)\\/(.*)\\//.exec(key);\n            if (parts) {\n                const [, dbName, tableName] = parts;\n                const tblCache = cache[`idb://${dbName}/${tableName}`];\n                if (tblCache)\n                    collectTableSubscribers(tblCache, updatedParts, queriesToSignal, deleteAffectedCacheEntries);\n            }\n        }\n    }\n    queriesToSignal.forEach((requery) => requery());\n}\nfunction collectTableSubscribers(tblCache, updatedParts, outQueriesToSignal, deleteAffectedCacheEntries) {\n    const updatedEntryLists = [];\n    for (const [indexName, entries] of Object.entries(tblCache.queries.query)) {\n        const filteredEntries = [];\n        for (const entry of entries) {\n            if (obsSetsOverlap(updatedParts, entry.obsSet)) {\n                entry.subscribers.forEach((requery) => outQueriesToSignal.add(requery));\n            }\n            else if (deleteAffectedCacheEntries) {\n                filteredEntries.push(entry);\n            }\n        }\n        if (deleteAffectedCacheEntries)\n            updatedEntryLists.push([indexName, filteredEntries]);\n    }\n    if (deleteAffectedCacheEntries) {\n        for (const [indexName, filteredEntries] of updatedEntryLists) {\n            tblCache.queries.query[indexName] = filteredEntries;\n        }\n    }\n}\n\nfunction dexieOpen(db) {\n    const state = db._state;\n    const { indexedDB } = db._deps;\n    if (state.isBeingOpened || db.idbdb)\n        return state.dbReadyPromise.then(() => state.dbOpenError ?\n            rejection(state.dbOpenError) :\n            db);\n    state.isBeingOpened = true;\n    state.dbOpenError = null;\n    state.openComplete = false;\n    const openCanceller = state.openCanceller;\n    let nativeVerToOpen = Math.round(db.verno * 10);\n    let schemaPatchMode = false;\n    function throwIfCancelled() {\n        if (state.openCanceller !== openCanceller)\n            throw new exceptions.DatabaseClosed('db.open() was cancelled');\n    }\n    let resolveDbReady = state.dbReadyResolve,\n    upgradeTransaction = null, wasCreated = false;\n    const tryOpenDB = () => new DexiePromise((resolve, reject) => {\n        throwIfCancelled();\n        if (!indexedDB)\n            throw new exceptions.MissingAPI();\n        const dbName = db.name;\n        const req = state.autoSchema || !nativeVerToOpen ?\n            indexedDB.open(dbName) :\n            indexedDB.open(dbName, nativeVerToOpen);\n        if (!req)\n            throw new exceptions.MissingAPI();\n        req.onerror = eventRejectHandler(reject);\n        req.onblocked = wrap(db._fireOnBlocked);\n        req.onupgradeneeded = wrap(e => {\n            upgradeTransaction = req.transaction;\n            if (state.autoSchema && !db._options.allowEmptyDB) {\n                req.onerror = preventDefault;\n                upgradeTransaction.abort();\n                req.result.close();\n                const delreq = indexedDB.deleteDatabase(dbName);\n                delreq.onsuccess = delreq.onerror = wrap(() => {\n                    reject(new exceptions.NoSuchDatabase(`Database ${dbName} doesnt exist`));\n                });\n            }\n            else {\n                upgradeTransaction.onerror = eventRejectHandler(reject);\n                const oldVer = e.oldVersion > Math.pow(2, 62) ? 0 : e.oldVersion;\n                wasCreated = oldVer < 1;\n                db.idbdb = req.result;\n                if (schemaPatchMode) {\n                    patchCurrentVersion(db, upgradeTransaction);\n                }\n                runUpgraders(db, oldVer / 10, upgradeTransaction, reject);\n            }\n        }, reject);\n        req.onsuccess = wrap(() => {\n            upgradeTransaction = null;\n            const idbdb = db.idbdb = req.result;\n            const objectStoreNames = slice(idbdb.objectStoreNames);\n            if (objectStoreNames.length > 0)\n                try {\n                    const tmpTrans = idbdb.transaction(safariMultiStoreFix(objectStoreNames), 'readonly');\n                    if (state.autoSchema)\n                        readGlobalSchema(db, idbdb, tmpTrans);\n                    else {\n                        adjustToExistingIndexNames(db, db._dbSchema, tmpTrans);\n                        if (!verifyInstalledSchema(db, tmpTrans) && !schemaPatchMode) {\n                            console.warn(`Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this.`);\n                            idbdb.close();\n                            nativeVerToOpen = idbdb.version + 1;\n                            schemaPatchMode = true;\n                            return resolve(tryOpenDB());\n                        }\n                    }\n                    generateMiddlewareStacks(db, tmpTrans);\n                }\n                catch (e) {\n                }\n            connections.push(db);\n            idbdb.onversionchange = wrap(ev => {\n                state.vcFired = true;\n                db.on(\"versionchange\").fire(ev);\n            });\n            idbdb.onclose = wrap(ev => {\n                db.on(\"close\").fire(ev);\n            });\n            if (wasCreated)\n                _onDatabaseCreated(db._deps, dbName);\n            resolve();\n        }, reject);\n    }).catch(err => {\n        switch (err?.name) {\n            case \"UnknownError\":\n                if (state.PR1398_maxLoop > 0) {\n                    state.PR1398_maxLoop--;\n                    console.warn('Dexie: Workaround for Chrome UnknownError on open()');\n                    return tryOpenDB();\n                }\n                break;\n            case \"VersionError\":\n                if (nativeVerToOpen > 0) {\n                    nativeVerToOpen = 0;\n                    return tryOpenDB();\n                }\n                break;\n        }\n        return DexiePromise.reject(err);\n    });\n    return DexiePromise.race([\n        openCanceller,\n        (typeof navigator === 'undefined' ? DexiePromise.resolve() : idbReady()).then(tryOpenDB)\n    ]).then(() => {\n        throwIfCancelled();\n        state.onReadyBeingFired = [];\n        return DexiePromise.resolve(vip(() => db.on.ready.fire(db.vip))).then(function fireRemainders() {\n            if (state.onReadyBeingFired.length > 0) {\n                let remainders = state.onReadyBeingFired.reduce(promisableChain, nop);\n                state.onReadyBeingFired = [];\n                return DexiePromise.resolve(vip(() => remainders(db.vip))).then(fireRemainders);\n            }\n        });\n    }).finally(() => {\n        if (state.openCanceller === openCanceller) {\n            state.onReadyBeingFired = null;\n            state.isBeingOpened = false;\n        }\n    }).catch(err => {\n        state.dbOpenError = err;\n        try {\n            upgradeTransaction && upgradeTransaction.abort();\n        }\n        catch { }\n        if (openCanceller === state.openCanceller) {\n            db._close();\n        }\n        return rejection(err);\n    }).finally(() => {\n        state.openComplete = true;\n        resolveDbReady();\n    }).then(() => {\n        if (wasCreated) {\n            const everything = {};\n            db.tables.forEach(table => {\n                table.schema.indexes.forEach(idx => {\n                    if (idx.name)\n                        everything[`idb://${db.name}/${table.name}/${idx.name}`] = new RangeSet(-Infinity, [[[]]]);\n                });\n                everything[`idb://${db.name}/${table.name}/`] = everything[`idb://${db.name}/${table.name}/:dels`] = new RangeSet(-Infinity, [[[]]]);\n            });\n            globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME).fire(everything);\n            signalSubscribersNow(everything, true);\n        }\n        return db;\n    });\n}\n\nfunction awaitIterator(iterator) {\n    var callNext = result => iterator.next(result), doThrow = error => iterator.throw(error), onSuccess = step(callNext), onError = step(doThrow);\n    function step(getNext) {\n        return (val) => {\n            var next = getNext(val), value = next.value;\n            return next.done ? value :\n                (!value || typeof value.then !== 'function' ?\n                    isArray(value) ? Promise.all(value).then(onSuccess, onError) : onSuccess(value) :\n                    value.then(onSuccess, onError));\n        };\n    }\n    return step(callNext)();\n}\n\nfunction extractTransactionArgs(mode, _tableArgs_, scopeFunc) {\n    var i = arguments.length;\n    if (i < 2)\n        throw new exceptions.InvalidArgument(\"Too few arguments\");\n    var args = new Array(i - 1);\n    while (--i)\n        args[i - 1] = arguments[i];\n    scopeFunc = args.pop();\n    var tables = flatten(args);\n    return [mode, tables, scopeFunc];\n}\nfunction enterTransactionScope(db, mode, storeNames, parentTransaction, scopeFunc) {\n    return DexiePromise.resolve().then(() => {\n        const transless = PSD.transless || PSD;\n        const trans = db._createTransaction(mode, storeNames, db._dbSchema, parentTransaction);\n        trans.explicit = true;\n        const zoneProps = {\n            trans: trans,\n            transless: transless\n        };\n        if (parentTransaction) {\n            trans.idbtrans = parentTransaction.idbtrans;\n        }\n        else {\n            try {\n                trans.create();\n                trans.idbtrans._explicit = true;\n                db._state.PR1398_maxLoop = 3;\n            }\n            catch (ex) {\n                if (ex.name === errnames.InvalidState && db.isOpen() && --db._state.PR1398_maxLoop > 0) {\n                    console.warn('Dexie: Need to reopen db');\n                    db.close({ disableAutoOpen: false });\n                    return db.open().then(() => enterTransactionScope(db, mode, storeNames, null, scopeFunc));\n                }\n                return rejection(ex);\n            }\n        }\n        const scopeFuncIsAsync = isAsyncFunction(scopeFunc);\n        if (scopeFuncIsAsync) {\n            incrementExpectedAwaits();\n        }\n        let returnValue;\n        const promiseFollowed = DexiePromise.follow(() => {\n            returnValue = scopeFunc.call(trans, trans);\n            if (returnValue) {\n                if (scopeFuncIsAsync) {\n                    var decrementor = decrementExpectedAwaits.bind(null, null);\n                    returnValue.then(decrementor, decrementor);\n                }\n                else if (typeof returnValue.next === 'function' && typeof returnValue.throw === 'function') {\n                    returnValue = awaitIterator(returnValue);\n                }\n            }\n        }, zoneProps);\n        return (returnValue && typeof returnValue.then === 'function' ?\n            DexiePromise.resolve(returnValue).then(x => trans.active ?\n                x\n                : rejection(new exceptions.PrematureCommit(\"Transaction committed too early. See http://bit.ly/2kdckMn\")))\n            : promiseFollowed.then(() => returnValue)).then(x => {\n            if (parentTransaction)\n                trans._resolve();\n            return trans._completion.then(() => x);\n        }).catch(e => {\n            trans._reject(e);\n            return rejection(e);\n        });\n    });\n}\n\nfunction pad(a, value, count) {\n    const result = isArray(a) ? a.slice() : [a];\n    for (let i = 0; i < count; ++i)\n        result.push(value);\n    return result;\n}\nfunction createVirtualIndexMiddleware(down) {\n    return {\n        ...down,\n        table(tableName) {\n            const table = down.table(tableName);\n            const { schema } = table;\n            const indexLookup = {};\n            const allVirtualIndexes = [];\n            function addVirtualIndexes(keyPath, keyTail, lowLevelIndex) {\n                const keyPathAlias = getKeyPathAlias(keyPath);\n                const indexList = (indexLookup[keyPathAlias] = indexLookup[keyPathAlias] || []);\n                const keyLength = keyPath == null ? 0 : typeof keyPath === 'string' ? 1 : keyPath.length;\n                const isVirtual = keyTail > 0;\n                const virtualIndex = {\n                    ...lowLevelIndex,\n                    name: isVirtual\n                        ? `${keyPathAlias}(virtual-from:${lowLevelIndex.name})`\n                        : lowLevelIndex.name,\n                    lowLevelIndex,\n                    isVirtual,\n                    keyTail,\n                    keyLength,\n                    extractKey: getKeyExtractor(keyPath),\n                    unique: !isVirtual && lowLevelIndex.unique\n                };\n                indexList.push(virtualIndex);\n                if (!virtualIndex.isPrimaryKey) {\n                    allVirtualIndexes.push(virtualIndex);\n                }\n                if (keyLength > 1) {\n                    const virtualKeyPath = keyLength === 2 ?\n                        keyPath[0] :\n                        keyPath.slice(0, keyLength - 1);\n                    addVirtualIndexes(virtualKeyPath, keyTail + 1, lowLevelIndex);\n                }\n                indexList.sort((a, b) => a.keyTail - b.keyTail);\n                return virtualIndex;\n            }\n            const primaryKey = addVirtualIndexes(schema.primaryKey.keyPath, 0, schema.primaryKey);\n            indexLookup[\":id\"] = [primaryKey];\n            for (const index of schema.indexes) {\n                addVirtualIndexes(index.keyPath, 0, index);\n            }\n            function findBestIndex(keyPath) {\n                const result = indexLookup[getKeyPathAlias(keyPath)];\n                return result && result[0];\n            }\n            function translateRange(range, keyTail) {\n                return {\n                    type: range.type === 1  ?\n                        2  :\n                        range.type,\n                    lower: pad(range.lower, range.lowerOpen ? down.MAX_KEY : down.MIN_KEY, keyTail),\n                    lowerOpen: true,\n                    upper: pad(range.upper, range.upperOpen ? down.MIN_KEY : down.MAX_KEY, keyTail),\n                    upperOpen: true\n                };\n            }\n            function translateRequest(req) {\n                const index = req.query.index;\n                return index.isVirtual ? {\n                    ...req,\n                    query: {\n                        index: index.lowLevelIndex,\n                        range: translateRange(req.query.range, index.keyTail)\n                    }\n                } : req;\n            }\n            const result = {\n                ...table,\n                schema: {\n                    ...schema,\n                    primaryKey,\n                    indexes: allVirtualIndexes,\n                    getIndexByKeyPath: findBestIndex\n                },\n                count(req) {\n                    return table.count(translateRequest(req));\n                },\n                query(req) {\n                    return table.query(translateRequest(req));\n                },\n                openCursor(req) {\n                    const { keyTail, isVirtual, keyLength } = req.query.index;\n                    if (!isVirtual)\n                        return table.openCursor(req);\n                    function createVirtualCursor(cursor) {\n                        function _continue(key) {\n                            key != null ?\n                                cursor.continue(pad(key, req.reverse ? down.MAX_KEY : down.MIN_KEY, keyTail)) :\n                                req.unique ?\n                                    cursor.continue(cursor.key.slice(0, keyLength)\n                                        .concat(req.reverse\n                                        ? down.MIN_KEY\n                                        : down.MAX_KEY, keyTail)) :\n                                    cursor.continue();\n                        }\n                        const virtualCursor = Object.create(cursor, {\n                            continue: { value: _continue },\n                            continuePrimaryKey: {\n                                value(key, primaryKey) {\n                                    cursor.continuePrimaryKey(pad(key, down.MAX_KEY, keyTail), primaryKey);\n                                }\n                            },\n                            primaryKey: {\n                                get() {\n                                    return cursor.primaryKey;\n                                }\n                            },\n                            key: {\n                                get() {\n                                    const key = cursor.key;\n                                    return keyLength === 1 ?\n                                        key[0] :\n                                        key.slice(0, keyLength);\n                                }\n                            },\n                            value: {\n                                get() {\n                                    return cursor.value;\n                                }\n                            }\n                        });\n                        return virtualCursor;\n                    }\n                    return table.openCursor(translateRequest(req))\n                        .then(cursor => cursor && createVirtualCursor(cursor));\n                }\n            };\n            return result;\n        }\n    };\n}\nconst virtualIndexMiddleware = {\n    stack: \"dbcore\",\n    name: \"VirtualIndexMiddleware\",\n    level: 1,\n    create: createVirtualIndexMiddleware\n};\n\nfunction getObjectDiff(a, b, rv, prfx) {\n    rv = rv || {};\n    prfx = prfx || '';\n    keys(a).forEach((prop) => {\n        if (!hasOwn(b, prop)) {\n            rv[prfx + prop] = undefined;\n        }\n        else {\n            var ap = a[prop], bp = b[prop];\n            if (typeof ap === 'object' && typeof bp === 'object' && ap && bp) {\n                const apTypeName = toStringTag(ap);\n                const bpTypeName = toStringTag(bp);\n                if (apTypeName !== bpTypeName) {\n                    rv[prfx + prop] = b[prop];\n                }\n                else if (apTypeName === 'Object') {\n                    getObjectDiff(ap, bp, rv, prfx + prop + '.');\n                }\n                else if (ap !== bp) {\n                    rv[prfx + prop] = b[prop];\n                }\n            }\n            else if (ap !== bp)\n                rv[prfx + prop] = b[prop];\n        }\n    });\n    keys(b).forEach((prop) => {\n        if (!hasOwn(a, prop)) {\n            rv[prfx + prop] = b[prop];\n        }\n    });\n    return rv;\n}\n\nfunction getEffectiveKeys(primaryKey, req) {\n    if (req.type === 'delete')\n        return req.keys;\n    return req.keys || req.values.map(primaryKey.extractKey);\n}\n\nconst hooksMiddleware = {\n    stack: \"dbcore\",\n    name: \"HooksMiddleware\",\n    level: 2,\n    create: (downCore) => ({\n        ...downCore,\n        table(tableName) {\n            const downTable = downCore.table(tableName);\n            const { primaryKey } = downTable.schema;\n            const tableMiddleware = {\n                ...downTable,\n                mutate(req) {\n                    const dxTrans = PSD.trans;\n                    const { deleting, creating, updating } = dxTrans.table(tableName).hook;\n                    switch (req.type) {\n                        case 'add':\n                            if (creating.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => addPutOrDelete(req), true);\n                        case 'put':\n                            if (creating.fire === nop && updating.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => addPutOrDelete(req), true);\n                        case 'delete':\n                            if (deleting.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => addPutOrDelete(req), true);\n                        case 'deleteRange':\n                            if (deleting.fire === nop)\n                                break;\n                            return dxTrans._promise('readwrite', () => deleteRange(req), true);\n                    }\n                    return downTable.mutate(req);\n                    function addPutOrDelete(req) {\n                        const dxTrans = PSD.trans;\n                        const keys = req.keys || getEffectiveKeys(primaryKey, req);\n                        if (!keys)\n                            throw new Error(\"Keys missing\");\n                        req = req.type === 'add' || req.type === 'put' ?\n                            { ...req, keys } :\n                            { ...req };\n                        if (req.type !== 'delete')\n                            req.values = [...req.values];\n                        if (req.keys)\n                            req.keys = [...req.keys];\n                        return getExistingValues(downTable, req, keys).then(existingValues => {\n                            const contexts = keys.map((key, i) => {\n                                const existingValue = existingValues[i];\n                                const ctx = { onerror: null, onsuccess: null };\n                                if (req.type === 'delete') {\n                                    deleting.fire.call(ctx, key, existingValue, dxTrans);\n                                }\n                                else if (req.type === 'add' || existingValue === undefined) {\n                                    const generatedPrimaryKey = creating.fire.call(ctx, key, req.values[i], dxTrans);\n                                    if (key == null && generatedPrimaryKey != null) {\n                                        key = generatedPrimaryKey;\n                                        req.keys[i] = key;\n                                        if (!primaryKey.outbound) {\n                                            setByKeyPath(req.values[i], primaryKey.keyPath, key);\n                                        }\n                                    }\n                                }\n                                else {\n                                    const objectDiff = getObjectDiff(existingValue, req.values[i]);\n                                    const additionalChanges = updating.fire.call(ctx, objectDiff, key, existingValue, dxTrans);\n                                    if (additionalChanges) {\n                                        const requestedValue = req.values[i];\n                                        Object.keys(additionalChanges).forEach(keyPath => {\n                                            if (hasOwn(requestedValue, keyPath)) {\n                                                requestedValue[keyPath] = additionalChanges[keyPath];\n                                            }\n                                            else {\n                                                setByKeyPath(requestedValue, keyPath, additionalChanges[keyPath]);\n                                            }\n                                        });\n                                    }\n                                }\n                                return ctx;\n                            });\n                            return downTable.mutate(req).then(({ failures, results, numFailures, lastResult }) => {\n                                for (let i = 0; i < keys.length; ++i) {\n                                    const primKey = results ? results[i] : keys[i];\n                                    const ctx = contexts[i];\n                                    if (primKey == null) {\n                                        ctx.onerror && ctx.onerror(failures[i]);\n                                    }\n                                    else {\n                                        ctx.onsuccess && ctx.onsuccess(req.type === 'put' && existingValues[i] ?\n                                            req.values[i] :\n                                            primKey\n                                        );\n                                    }\n                                }\n                                return { failures, results, numFailures, lastResult };\n                            }).catch(error => {\n                                contexts.forEach(ctx => ctx.onerror && ctx.onerror(error));\n                                return Promise.reject(error);\n                            });\n                        });\n                    }\n                    function deleteRange(req) {\n                        return deleteNextChunk(req.trans, req.range, 10000);\n                    }\n                    function deleteNextChunk(trans, range, limit) {\n                        return downTable.query({ trans, values: false, query: { index: primaryKey, range }, limit })\n                            .then(({ result }) => {\n                            return addPutOrDelete({ type: 'delete', keys: result, trans }).then(res => {\n                                if (res.numFailures > 0)\n                                    return Promise.reject(res.failures[0]);\n                                if (result.length < limit) {\n                                    return { failures: [], numFailures: 0, lastResult: undefined };\n                                }\n                                else {\n                                    return deleteNextChunk(trans, { ...range, lower: result[result.length - 1], lowerOpen: true }, limit);\n                                }\n                            });\n                        });\n                    }\n                }\n            };\n            return tableMiddleware;\n        },\n    })\n};\nfunction getExistingValues(table, req, effectiveKeys) {\n    return req.type === \"add\"\n        ? Promise.resolve([])\n        : table.getMany({ trans: req.trans, keys: effectiveKeys, cache: \"immutable\" });\n}\n\nfunction getFromTransactionCache(keys, cache, clone) {\n    try {\n        if (!cache)\n            return null;\n        if (cache.keys.length < keys.length)\n            return null;\n        const result = [];\n        for (let i = 0, j = 0; i < cache.keys.length && j < keys.length; ++i) {\n            if (cmp(cache.keys[i], keys[j]) !== 0)\n                continue;\n            result.push(clone ? deepClone(cache.values[i]) : cache.values[i]);\n            ++j;\n        }\n        return result.length === keys.length ? result : null;\n    }\n    catch {\n        return null;\n    }\n}\nconst cacheExistingValuesMiddleware = {\n    stack: \"dbcore\",\n    level: -1,\n    create: (core) => {\n        return {\n            table: (tableName) => {\n                const table = core.table(tableName);\n                return {\n                    ...table,\n                    getMany: (req) => {\n                        if (!req.cache) {\n                            return table.getMany(req);\n                        }\n                        const cachedResult = getFromTransactionCache(req.keys, req.trans[\"_cache\"], req.cache === \"clone\");\n                        if (cachedResult) {\n                            return DexiePromise.resolve(cachedResult);\n                        }\n                        return table.getMany(req).then((res) => {\n                            req.trans[\"_cache\"] = {\n                                keys: req.keys,\n                                values: req.cache === \"clone\" ? deepClone(res) : res,\n                            };\n                            return res;\n                        });\n                    },\n                    mutate: (req) => {\n                        if (req.type !== \"add\")\n                            req.trans[\"_cache\"] = null;\n                        return table.mutate(req);\n                    },\n                };\n            },\n        };\n    },\n};\n\nfunction isCachableContext(ctx, table) {\n    return (ctx.trans.mode === 'readonly' &&\n        !!ctx.subscr &&\n        !ctx.trans.explicit &&\n        ctx.trans.db._options.cache !== 'disabled' &&\n        !table.schema.primaryKey.outbound);\n}\n\nfunction isCachableRequest(type, req) {\n    switch (type) {\n        case 'query':\n            return req.values && !req.unique;\n        case 'get':\n            return false;\n        case 'getMany':\n            return false;\n        case 'count':\n            return false;\n        case 'openCursor':\n            return false;\n    }\n}\n\nconst observabilityMiddleware = {\n    stack: \"dbcore\",\n    level: 0,\n    name: \"Observability\",\n    create: (core) => {\n        const dbName = core.schema.name;\n        const FULL_RANGE = new RangeSet(core.MIN_KEY, core.MAX_KEY);\n        return {\n            ...core,\n            transaction: (stores, mode, options) => {\n                if (PSD.subscr && mode !== 'readonly') {\n                    throw new exceptions.ReadOnly(`Readwrite transaction in liveQuery context. Querier source: ${PSD.querier}`);\n                }\n                return core.transaction(stores, mode, options);\n            },\n            table: (tableName) => {\n                const table = core.table(tableName);\n                const { schema } = table;\n                const { primaryKey, indexes } = schema;\n                const { extractKey, outbound } = primaryKey;\n                const indexesWithAutoIncPK = primaryKey.autoIncrement && indexes.filter((index) => index.compound && index.keyPath.includes(primaryKey.keyPath));\n                const tableClone = {\n                    ...table,\n                    mutate: (req) => {\n                        const trans = req.trans;\n                        const mutatedParts = req.mutatedParts || (req.mutatedParts = {});\n                        const getRangeSet = (indexName) => {\n                            const part = `idb://${dbName}/${tableName}/${indexName}`;\n                            return (mutatedParts[part] ||\n                                (mutatedParts[part] = new RangeSet()));\n                        };\n                        const pkRangeSet = getRangeSet(\"\");\n                        const delsRangeSet = getRangeSet(\":dels\");\n                        const { type } = req;\n                        let [keys, newObjs] = req.type === \"deleteRange\"\n                            ? [req.range]\n                            : req.type === \"delete\"\n                                ? [req.keys]\n                                : req.values.length < 50\n                                    ? [getEffectiveKeys(primaryKey, req).filter(id => id), req.values]\n                                    : [];\n                        const oldCache = req.trans[\"_cache\"];\n                        if (isArray(keys)) {\n                            pkRangeSet.addKeys(keys);\n                            const oldObjs = type === 'delete' || keys.length === newObjs.length ? getFromTransactionCache(keys, oldCache) : null;\n                            if (!oldObjs) {\n                                delsRangeSet.addKeys(keys);\n                            }\n                            if (oldObjs || newObjs) {\n                                trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs);\n                            }\n                        }\n                        else if (keys) {\n                            const range = { from: keys.lower, to: keys.upper };\n                            delsRangeSet.add(range);\n                            pkRangeSet.add(range);\n                        }\n                        else {\n                            pkRangeSet.add(FULL_RANGE);\n                            delsRangeSet.add(FULL_RANGE);\n                            schema.indexes.forEach(idx => getRangeSet(idx.name).add(FULL_RANGE));\n                        }\n                        return table.mutate(req).then((res) => {\n                            if (keys && (req.type === 'add' || req.type === 'put')) {\n                                pkRangeSet.addKeys(res.results);\n                                if (indexesWithAutoIncPK) {\n                                    indexesWithAutoIncPK.forEach(idx => {\n                                        const idxVals = req.values.map(v => idx.extractKey(v));\n                                        const pkPos = idx.keyPath.findIndex(prop => prop === primaryKey.keyPath);\n                                        res.results.forEach(pk => idxVals[pkPos] = pk);\n                                        getRangeSet(idx.name).addKeys(idxVals);\n                                    });\n                                }\n                            }\n                            trans.mutatedParts = extendObservabilitySet(trans.mutatedParts || {}, mutatedParts);\n                            return res;\n                        });\n                    },\n                };\n                const getRange = ({ query: { index, range }, }) => [\n                    index,\n                    new RangeSet(range.lower ?? core.MIN_KEY, range.upper ?? core.MAX_KEY),\n                ];\n                const readSubscribers = {\n                    get: (req) => [primaryKey, new RangeSet(req.key)],\n                    getMany: (req) => [primaryKey, new RangeSet().addKeys(req.keys)],\n                    count: getRange,\n                    query: getRange,\n                    openCursor: getRange,\n                };\n                keys(readSubscribers).forEach((method) => {\n                    tableClone[method] = function (req) {\n                        const { subscr } = PSD;\n                        const isLiveQuery = !!subscr;\n                        let cachable = isCachableContext(PSD, table) && isCachableRequest(method, req);\n                        const obsSet = cachable\n                            ? req.obsSet = {}\n                            : subscr;\n                        if (isLiveQuery) {\n                            const getRangeSet = (indexName) => {\n                                const part = `idb://${dbName}/${tableName}/${indexName}`;\n                                return (obsSet[part] ||\n                                    (obsSet[part] = new RangeSet()));\n                            };\n                            const pkRangeSet = getRangeSet(\"\");\n                            const delsRangeSet = getRangeSet(\":dels\");\n                            const [queriedIndex, queriedRanges] = readSubscribers[method](req);\n                            if (method === 'query' && queriedIndex.isPrimaryKey && !req.values) {\n                                delsRangeSet.add(queriedRanges);\n                            }\n                            else {\n                                getRangeSet(queriedIndex.name || \"\").add(queriedRanges);\n                            }\n                            if (!queriedIndex.isPrimaryKey) {\n                                if (method === \"count\") {\n                                    delsRangeSet.add(FULL_RANGE);\n                                }\n                                else {\n                                    const keysPromise = method === \"query\" &&\n                                        outbound &&\n                                        req.values &&\n                                        table.query({\n                                            ...req,\n                                            values: false,\n                                        });\n                                    return table[method].apply(this, arguments).then((res) => {\n                                        if (method === \"query\") {\n                                            if (outbound && req.values) {\n                                                return keysPromise.then(({ result: resultingKeys }) => {\n                                                    pkRangeSet.addKeys(resultingKeys);\n                                                    return res;\n                                                });\n                                            }\n                                            const pKeys = req.values\n                                                ? res.result.map(extractKey)\n                                                : res.result;\n                                            if (req.values) {\n                                                pkRangeSet.addKeys(pKeys);\n                                            }\n                                            else {\n                                                delsRangeSet.addKeys(pKeys);\n                                            }\n                                        }\n                                        else if (method === \"openCursor\") {\n                                            const cursor = res;\n                                            const wantValues = req.values;\n                                            return (cursor &&\n                                                Object.create(cursor, {\n                                                    key: {\n                                                        get() {\n                                                            delsRangeSet.addKey(cursor.primaryKey);\n                                                            return cursor.key;\n                                                        },\n                                                    },\n                                                    primaryKey: {\n                                                        get() {\n                                                            const pkey = cursor.primaryKey;\n                                                            delsRangeSet.addKey(pkey);\n                                                            return pkey;\n                                                        },\n                                                    },\n                                                    value: {\n                                                        get() {\n                                                            wantValues && pkRangeSet.addKey(cursor.primaryKey);\n                                                            return cursor.value;\n                                                        },\n                                                    },\n                                                }));\n                                        }\n                                        return res;\n                                    });\n                                }\n                            }\n                        }\n                        return table[method].apply(this, arguments);\n                    };\n                });\n                return tableClone;\n            },\n        };\n    },\n};\nfunction trackAffectedIndexes(getRangeSet, schema, oldObjs, newObjs) {\n    function addAffectedIndex(ix) {\n        const rangeSet = getRangeSet(ix.name || \"\");\n        function extractKey(obj) {\n            return obj != null ? ix.extractKey(obj) : null;\n        }\n        const addKeyOrKeys = (key) => ix.multiEntry && isArray(key)\n            ? key.forEach(key => rangeSet.addKey(key))\n            : rangeSet.addKey(key);\n        (oldObjs || newObjs).forEach((_, i) => {\n            const oldKey = oldObjs && extractKey(oldObjs[i]);\n            const newKey = newObjs && extractKey(newObjs[i]);\n            if (cmp(oldKey, newKey) !== 0) {\n                if (oldKey != null)\n                    addKeyOrKeys(oldKey);\n                if (newKey != null)\n                    addKeyOrKeys(newKey);\n            }\n        });\n    }\n    schema.indexes.forEach(addAffectedIndex);\n}\n\nfunction adjustOptimisticFromFailures(tblCache, req, res) {\n    if (res.numFailures === 0)\n        return req;\n    if (req.type === 'deleteRange') {\n        return null;\n    }\n    const numBulkOps = req.keys\n        ? req.keys.length\n        : 'values' in req && req.values\n            ? req.values.length\n            : 1;\n    if (res.numFailures === numBulkOps) {\n        return null;\n    }\n    const clone = { ...req };\n    if (isArray(clone.keys)) {\n        clone.keys = clone.keys.filter((_, i) => !(i in res.failures));\n    }\n    if ('values' in clone && isArray(clone.values)) {\n        clone.values = clone.values.filter((_, i) => !(i in res.failures));\n    }\n    return clone;\n}\n\nfunction isAboveLower(key, range) {\n    return range.lower === undefined\n        ? true\n        : range.lowerOpen\n            ? cmp(key, range.lower) > 0\n            : cmp(key, range.lower) >= 0;\n}\nfunction isBelowUpper(key, range) {\n    return range.upper === undefined\n        ? true\n        : range.upperOpen\n            ? cmp(key, range.upper) < 0\n            : cmp(key, range.upper) <= 0;\n}\nfunction isWithinRange(key, range) {\n    return isAboveLower(key, range) && isBelowUpper(key, range);\n}\n\nfunction applyOptimisticOps(result, req, ops, table, cacheEntry, immutable) {\n    if (!ops || ops.length === 0)\n        return result;\n    const index = req.query.index;\n    const { multiEntry } = index;\n    const queryRange = req.query.range;\n    const primaryKey = table.schema.primaryKey;\n    const extractPrimKey = primaryKey.extractKey;\n    const extractIndex = index.extractKey;\n    const extractLowLevelIndex = (index.lowLevelIndex || index).extractKey;\n    let finalResult = ops.reduce((result, op) => {\n        let modifedResult = result;\n        const includedValues = [];\n        if (op.type === 'add' || op.type === 'put') {\n            const includedPKs = new RangeSet();\n            for (let i = op.values.length - 1; i >= 0; --i) {\n                const value = op.values[i];\n                const pk = extractPrimKey(value);\n                if (includedPKs.hasKey(pk))\n                    continue;\n                const key = extractIndex(value);\n                if (multiEntry && isArray(key)\n                    ? key.some((k) => isWithinRange(k, queryRange))\n                    : isWithinRange(key, queryRange)) {\n                    includedPKs.addKey(pk);\n                    includedValues.push(value);\n                }\n            }\n        }\n        switch (op.type) {\n            case 'add':\n                modifedResult = result.concat(req.values\n                    ? includedValues\n                    : includedValues.map((v) => extractPrimKey(v)));\n                break;\n            case 'put':\n                const keySet = new RangeSet().addKeys(op.values.map((v) => extractPrimKey(v)));\n                modifedResult = result\n                    .filter(\n                (item) => !keySet.hasKey(req.values ? extractPrimKey(item) : item))\n                    .concat(\n                req.values\n                    ? includedValues\n                    : includedValues.map((v) => extractPrimKey(v)));\n                break;\n            case 'delete':\n                const keysToDelete = new RangeSet().addKeys(op.keys);\n                modifedResult = result.filter((item) => !keysToDelete.hasKey(req.values ? extractPrimKey(item) : item));\n                break;\n            case 'deleteRange':\n                const range = op.range;\n                modifedResult = result.filter((item) => !isWithinRange(extractPrimKey(item), range));\n                break;\n        }\n        return modifedResult;\n    }, result);\n    if (finalResult === result)\n        return result;\n    finalResult.sort((a, b) => cmp(extractLowLevelIndex(a), extractLowLevelIndex(b)) ||\n        cmp(extractPrimKey(a), extractPrimKey(b)));\n    if (req.limit && req.limit < Infinity) {\n        if (finalResult.length > req.limit) {\n            finalResult.length = req.limit;\n        }\n        else if (result.length === req.limit && finalResult.length < req.limit) {\n            cacheEntry.dirty = true;\n        }\n    }\n    return immutable ? Object.freeze(finalResult) : finalResult;\n}\n\nfunction areRangesEqual(r1, r2) {\n    return (cmp(r1.lower, r2.lower) === 0 &&\n        cmp(r1.upper, r2.upper) === 0 &&\n        !!r1.lowerOpen === !!r2.lowerOpen &&\n        !!r1.upperOpen === !!r2.upperOpen);\n}\n\nfunction compareLowers(lower1, lower2, lowerOpen1, lowerOpen2) {\n    if (lower1 === undefined)\n        return lower2 !== undefined ? -1 : 0;\n    if (lower2 === undefined)\n        return 1;\n    const c = cmp(lower1, lower2);\n    if (c === 0) {\n        if (lowerOpen1 && lowerOpen2)\n            return 0;\n        if (lowerOpen1)\n            return 1;\n        if (lowerOpen2)\n            return -1;\n    }\n    return c;\n}\nfunction compareUppers(upper1, upper2, upperOpen1, upperOpen2) {\n    if (upper1 === undefined)\n        return upper2 !== undefined ? 1 : 0;\n    if (upper2 === undefined)\n        return -1;\n    const c = cmp(upper1, upper2);\n    if (c === 0) {\n        if (upperOpen1 && upperOpen2)\n            return 0;\n        if (upperOpen1)\n            return -1;\n        if (upperOpen2)\n            return 1;\n    }\n    return c;\n}\nfunction isSuperRange(r1, r2) {\n    return (compareLowers(r1.lower, r2.lower, r1.lowerOpen, r2.lowerOpen) <= 0 &&\n        compareUppers(r1.upper, r2.upper, r1.upperOpen, r2.upperOpen) >= 0);\n}\n\nfunction findCompatibleQuery(dbName, tableName, type, req) {\n    const tblCache = cache[`idb://${dbName}/${tableName}`];\n    if (!tblCache)\n        return [];\n    const queries = tblCache.queries[type];\n    if (!queries)\n        return [null, false, tblCache, null];\n    const indexName = req.query ? req.query.index.name : null;\n    const entries = queries[indexName || ''];\n    if (!entries)\n        return [null, false, tblCache, null];\n    switch (type) {\n        case 'query':\n            const equalEntry = entries.find((entry) => entry.req.limit === req.limit &&\n                entry.req.values === req.values &&\n                areRangesEqual(entry.req.query.range, req.query.range));\n            if (equalEntry)\n                return [\n                    equalEntry,\n                    true,\n                    tblCache,\n                    entries,\n                ];\n            const superEntry = entries.find((entry) => {\n                const limit = 'limit' in entry.req ? entry.req.limit : Infinity;\n                return (limit >= req.limit &&\n                    (req.values ? entry.req.values : true) &&\n                    isSuperRange(entry.req.query.range, req.query.range));\n            });\n            return [superEntry, false, tblCache, entries];\n        case 'count':\n            const countQuery = entries.find((entry) => areRangesEqual(entry.req.query.range, req.query.range));\n            return [countQuery, !!countQuery, tblCache, entries];\n    }\n}\n\nfunction subscribeToCacheEntry(cacheEntry, container, requery, signal) {\n    cacheEntry.subscribers.add(requery);\n    signal.addEventListener(\"abort\", () => {\n        cacheEntry.subscribers.delete(requery);\n        if (cacheEntry.subscribers.size === 0) {\n            enqueForDeletion(cacheEntry, container);\n        }\n    });\n}\nfunction enqueForDeletion(cacheEntry, container) {\n    setTimeout(() => {\n        if (cacheEntry.subscribers.size === 0) {\n            delArrayItem(container, cacheEntry);\n        }\n    }, 3000);\n}\n\nconst cacheMiddleware = {\n    stack: 'dbcore',\n    level: 0,\n    name: 'Cache',\n    create: (core) => {\n        const dbName = core.schema.name;\n        const coreMW = {\n            ...core,\n            transaction: (stores, mode, options) => {\n                const idbtrans = core.transaction(stores, mode, options);\n                if (mode === 'readwrite') {\n                    const ac = new AbortController();\n                    const { signal } = ac;\n                    const endTransaction = (wasCommitted) => () => {\n                        ac.abort();\n                        if (mode === 'readwrite') {\n                            const affectedSubscribers = new Set();\n                            for (const storeName of stores) {\n                                const tblCache = cache[`idb://${dbName}/${storeName}`];\n                                if (tblCache) {\n                                    const table = core.table(storeName);\n                                    const ops = tblCache.optimisticOps.filter((op) => op.trans === idbtrans);\n                                    if (idbtrans._explicit && wasCommitted && idbtrans.mutatedParts) {\n                                        for (const entries of Object.values(tblCache.queries.query)) {\n                                            for (const entry of entries.slice()) {\n                                                if (obsSetsOverlap(entry.obsSet, idbtrans.mutatedParts)) {\n                                                    delArrayItem(entries, entry);\n                                                    entry.subscribers.forEach((requery) => affectedSubscribers.add(requery));\n                                                }\n                                            }\n                                        }\n                                    }\n                                    else if (ops.length > 0) {\n                                        tblCache.optimisticOps = tblCache.optimisticOps.filter((op) => op.trans !== idbtrans);\n                                        for (const entries of Object.values(tblCache.queries.query)) {\n                                            for (const entry of entries.slice()) {\n                                                if (entry.res != null &&\n                                                    idbtrans.mutatedParts\n) {\n                                                    if (wasCommitted && !entry.dirty) {\n                                                        const freezeResults = Object.isFrozen(entry.res);\n                                                        const modRes = applyOptimisticOps(entry.res, entry.req, ops, table, entry, freezeResults);\n                                                        if (entry.dirty) {\n                                                            delArrayItem(entries, entry);\n                                                            entry.subscribers.forEach((requery) => affectedSubscribers.add(requery));\n                                                        }\n                                                        else if (modRes !== entry.res) {\n                                                            entry.res = modRes;\n                                                            entry.promise = DexiePromise.resolve({ result: modRes });\n                                                        }\n                                                    }\n                                                    else {\n                                                        if (entry.dirty) {\n                                                            delArrayItem(entries, entry);\n                                                        }\n                                                        entry.subscribers.forEach((requery) => affectedSubscribers.add(requery));\n                                                    }\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            }\n                            affectedSubscribers.forEach((requery) => requery());\n                        }\n                    };\n                    idbtrans.addEventListener('abort', endTransaction(false), {\n                        signal,\n                    });\n                    idbtrans.addEventListener('error', endTransaction(false), {\n                        signal,\n                    });\n                    idbtrans.addEventListener('complete', endTransaction(true), {\n                        signal,\n                    });\n                }\n                return idbtrans;\n            },\n            table(tableName) {\n                const downTable = core.table(tableName);\n                const primKey = downTable.schema.primaryKey;\n                const tableMW = {\n                    ...downTable,\n                    mutate(req) {\n                        const trans = PSD.trans;\n                        if (primKey.outbound ||\n                            trans.db._options.cache === 'disabled' ||\n                            trans.explicit\n                        ) {\n                            return downTable.mutate(req);\n                        }\n                        const tblCache = cache[`idb://${dbName}/${tableName}`];\n                        if (!tblCache)\n                            return downTable.mutate(req);\n                        const promise = downTable.mutate(req);\n                        if ((req.type === 'add' || req.type === 'put') && (req.values.length >= 50 || getEffectiveKeys(primKey, req).some(key => key == null))) {\n                            promise.then((res) => {\n                                const reqWithResolvedKeys = {\n                                    ...req,\n                                    values: req.values.map((value, i) => {\n                                        const valueWithKey = primKey.keyPath?.includes('.')\n                                            ? deepClone(value)\n                                            : {\n                                                ...value,\n                                            };\n                                        setByKeyPath(valueWithKey, primKey.keyPath, res.results[i]);\n                                        return valueWithKey;\n                                    })\n                                };\n                                const adjustedReq = adjustOptimisticFromFailures(tblCache, reqWithResolvedKeys, res);\n                                tblCache.optimisticOps.push(adjustedReq);\n                                queueMicrotask(() => req.mutatedParts && signalSubscribersLazily(req.mutatedParts));\n                            });\n                        }\n                        else {\n                            tblCache.optimisticOps.push(req);\n                            req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                            promise.then((res) => {\n                                if (res.numFailures > 0) {\n                                    delArrayItem(tblCache.optimisticOps, req);\n                                    const adjustedReq = adjustOptimisticFromFailures(tblCache, req, res);\n                                    if (adjustedReq) {\n                                        tblCache.optimisticOps.push(adjustedReq);\n                                    }\n                                    req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                                }\n                            });\n                            promise.catch(() => {\n                                delArrayItem(tblCache.optimisticOps, req);\n                                req.mutatedParts && signalSubscribersLazily(req.mutatedParts);\n                            });\n                        }\n                        return promise;\n                    },\n                    query(req) {\n                        if (!isCachableContext(PSD, downTable) || !isCachableRequest(\"query\", req))\n                            return downTable.query(req);\n                        const freezeResults = PSD.trans?.db._options.cache === 'immutable';\n                        const { requery, signal } = PSD;\n                        let [cacheEntry, exactMatch, tblCache, container] = findCompatibleQuery(dbName, tableName, 'query', req);\n                        if (cacheEntry && exactMatch) {\n                            cacheEntry.obsSet = req.obsSet;\n                        }\n                        else {\n                            const promise = downTable.query(req).then((res) => {\n                                const result = res.result;\n                                if (cacheEntry)\n                                    cacheEntry.res = result;\n                                if (freezeResults) {\n                                    for (let i = 0, l = result.length; i < l; ++i) {\n                                        Object.freeze(result[i]);\n                                    }\n                                    Object.freeze(result);\n                                }\n                                else {\n                                    res.result = deepClone(result);\n                                }\n                                return res;\n                            }).catch(error => {\n                                if (container && cacheEntry)\n                                    delArrayItem(container, cacheEntry);\n                                return Promise.reject(error);\n                            });\n                            cacheEntry = {\n                                obsSet: req.obsSet,\n                                promise,\n                                subscribers: new Set(),\n                                type: 'query',\n                                req,\n                                dirty: false,\n                            };\n                            if (container) {\n                                container.push(cacheEntry);\n                            }\n                            else {\n                                container = [cacheEntry];\n                                if (!tblCache) {\n                                    tblCache = cache[`idb://${dbName}/${tableName}`] = {\n                                        queries: {\n                                            query: {},\n                                            count: {},\n                                        },\n                                        objs: new Map(),\n                                        optimisticOps: [],\n                                        unsignaledParts: {}\n                                    };\n                                }\n                                tblCache.queries.query[req.query.index.name || ''] = container;\n                            }\n                        }\n                        subscribeToCacheEntry(cacheEntry, container, requery, signal);\n                        return cacheEntry.promise.then((res) => {\n                            return {\n                                result: applyOptimisticOps(res.result, req, tblCache?.optimisticOps, downTable, cacheEntry, freezeResults),\n                            };\n                        });\n                    },\n                };\n                return tableMW;\n            },\n        };\n        return coreMW;\n    },\n};\n\nfunction vipify(target, vipDb) {\n    return new Proxy(target, {\n        get(target, prop, receiver) {\n            if (prop === 'db')\n                return vipDb;\n            return Reflect.get(target, prop, receiver);\n        }\n    });\n}\n\nclass Dexie$1 {\n    constructor(name, options) {\n        this._middlewares = {};\n        this.verno = 0;\n        const deps = Dexie$1.dependencies;\n        this._options = options = {\n            addons: Dexie$1.addons,\n            autoOpen: true,\n            indexedDB: deps.indexedDB,\n            IDBKeyRange: deps.IDBKeyRange,\n            cache: 'cloned',\n            ...options\n        };\n        this._deps = {\n            indexedDB: options.indexedDB,\n            IDBKeyRange: options.IDBKeyRange\n        };\n        const { addons, } = options;\n        this._dbSchema = {};\n        this._versions = [];\n        this._storeNames = [];\n        this._allTables = {};\n        this.idbdb = null;\n        this._novip = this;\n        const state = {\n            dbOpenError: null,\n            isBeingOpened: false,\n            onReadyBeingFired: null,\n            openComplete: false,\n            dbReadyResolve: nop,\n            dbReadyPromise: null,\n            cancelOpen: nop,\n            openCanceller: null,\n            autoSchema: true,\n            PR1398_maxLoop: 3,\n            autoOpen: options.autoOpen,\n        };\n        state.dbReadyPromise = new DexiePromise(resolve => {\n            state.dbReadyResolve = resolve;\n        });\n        state.openCanceller = new DexiePromise((_, reject) => {\n            state.cancelOpen = reject;\n        });\n        this._state = state;\n        this.name = name;\n        this.on = Events(this, \"populate\", \"blocked\", \"versionchange\", \"close\", { ready: [promisableChain, nop] });\n        this.on.ready.subscribe = override(this.on.ready.subscribe, subscribe => {\n            return (subscriber, bSticky) => {\n                Dexie$1.vip(() => {\n                    const state = this._state;\n                    if (state.openComplete) {\n                        if (!state.dbOpenError)\n                            DexiePromise.resolve().then(subscriber);\n                        if (bSticky)\n                            subscribe(subscriber);\n                    }\n                    else if (state.onReadyBeingFired) {\n                        state.onReadyBeingFired.push(subscriber);\n                        if (bSticky)\n                            subscribe(subscriber);\n                    }\n                    else {\n                        subscribe(subscriber);\n                        const db = this;\n                        if (!bSticky)\n                            subscribe(function unsubscribe() {\n                                db.on.ready.unsubscribe(subscriber);\n                                db.on.ready.unsubscribe(unsubscribe);\n                            });\n                    }\n                });\n            };\n        });\n        this.Collection = createCollectionConstructor(this);\n        this.Table = createTableConstructor(this);\n        this.Transaction = createTransactionConstructor(this);\n        this.Version = createVersionConstructor(this);\n        this.WhereClause = createWhereClauseConstructor(this);\n        this.on(\"versionchange\", ev => {\n            if (ev.newVersion > 0)\n                console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`);\n            else\n                console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`);\n            this.close({ disableAutoOpen: false });\n        });\n        this.on(\"blocked\", ev => {\n            if (!ev.newVersion || ev.newVersion < ev.oldVersion)\n                console.warn(`Dexie.delete('${this.name}') was blocked`);\n            else\n                console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${ev.oldVersion / 10}`);\n        });\n        this._maxKey = getMaxKey(options.IDBKeyRange);\n        this._createTransaction = (mode, storeNames, dbschema, parentTransaction) => new this.Transaction(mode, storeNames, dbschema, this._options.chromeTransactionDurability, parentTransaction);\n        this._fireOnBlocked = ev => {\n            this.on(\"blocked\").fire(ev);\n            connections\n                .filter(c => c.name === this.name && c !== this && !c._state.vcFired)\n                .map(c => c.on(\"versionchange\").fire(ev));\n        };\n        this.use(cacheExistingValuesMiddleware);\n        this.use(cacheMiddleware);\n        this.use(observabilityMiddleware);\n        this.use(virtualIndexMiddleware);\n        this.use(hooksMiddleware);\n        const vipDB = new Proxy(this, {\n            get: (_, prop, receiver) => {\n                if (prop === '_vip')\n                    return true;\n                if (prop === 'table')\n                    return (tableName) => vipify(this.table(tableName), vipDB);\n                const rv = Reflect.get(_, prop, receiver);\n                if (rv instanceof Table)\n                    return vipify(rv, vipDB);\n                if (prop === 'tables')\n                    return rv.map(t => vipify(t, vipDB));\n                if (prop === '_createTransaction')\n                    return function () {\n                        const tx = rv.apply(this, arguments);\n                        return vipify(tx, vipDB);\n                    };\n                return rv;\n            }\n        });\n        this.vip = vipDB;\n        addons.forEach(addon => addon(this));\n    }\n    version(versionNumber) {\n        if (isNaN(versionNumber) || versionNumber < 0.1)\n            throw new exceptions.Type(`Given version is not a positive number`);\n        versionNumber = Math.round(versionNumber * 10) / 10;\n        if (this.idbdb || this._state.isBeingOpened)\n            throw new exceptions.Schema(\"Cannot add version when database is open\");\n        this.verno = Math.max(this.verno, versionNumber);\n        const versions = this._versions;\n        var versionInstance = versions.filter(v => v._cfg.version === versionNumber)[0];\n        if (versionInstance)\n            return versionInstance;\n        versionInstance = new this.Version(versionNumber);\n        versions.push(versionInstance);\n        versions.sort(lowerVersionFirst);\n        versionInstance.stores({});\n        this._state.autoSchema = false;\n        return versionInstance;\n    }\n    _whenReady(fn) {\n        return (this.idbdb && (this._state.openComplete || PSD.letThrough || this._vip)) ? fn() : new DexiePromise((resolve, reject) => {\n            if (this._state.openComplete) {\n                return reject(new exceptions.DatabaseClosed(this._state.dbOpenError));\n            }\n            if (!this._state.isBeingOpened) {\n                if (!this._state.autoOpen) {\n                    reject(new exceptions.DatabaseClosed());\n                    return;\n                }\n                this.open().catch(nop);\n            }\n            this._state.dbReadyPromise.then(resolve, reject);\n        }).then(fn);\n    }\n    use({ stack, create, level, name }) {\n        if (name)\n            this.unuse({ stack, name });\n        const middlewares = this._middlewares[stack] || (this._middlewares[stack] = []);\n        middlewares.push({ stack, create, level: level == null ? 10 : level, name });\n        middlewares.sort((a, b) => a.level - b.level);\n        return this;\n    }\n    unuse({ stack, name, create }) {\n        if (stack && this._middlewares[stack]) {\n            this._middlewares[stack] = this._middlewares[stack].filter(mw => create ? mw.create !== create :\n                name ? mw.name !== name :\n                    false);\n        }\n        return this;\n    }\n    open() {\n        return usePSD(globalPSD,\n        () => dexieOpen(this));\n    }\n    _close() {\n        const state = this._state;\n        const idx = connections.indexOf(this);\n        if (idx >= 0)\n            connections.splice(idx, 1);\n        if (this.idbdb) {\n            try {\n                this.idbdb.close();\n            }\n            catch (e) { }\n            this.idbdb = null;\n        }\n        if (!state.isBeingOpened) {\n            state.dbReadyPromise = new DexiePromise(resolve => {\n                state.dbReadyResolve = resolve;\n            });\n            state.openCanceller = new DexiePromise((_, reject) => {\n                state.cancelOpen = reject;\n            });\n        }\n    }\n    close({ disableAutoOpen } = { disableAutoOpen: true }) {\n        const state = this._state;\n        if (disableAutoOpen) {\n            if (state.isBeingOpened) {\n                state.cancelOpen(new exceptions.DatabaseClosed());\n            }\n            this._close();\n            state.autoOpen = false;\n            state.dbOpenError = new exceptions.DatabaseClosed();\n        }\n        else {\n            this._close();\n            state.autoOpen = this._options.autoOpen ||\n                state.isBeingOpened;\n            state.openComplete = false;\n            state.dbOpenError = null;\n        }\n    }\n    delete(closeOptions = { disableAutoOpen: true }) {\n        const hasInvalidArguments = arguments.length > 0 && typeof arguments[0] !== 'object';\n        const state = this._state;\n        return new DexiePromise((resolve, reject) => {\n            const doDelete = () => {\n                this.close(closeOptions);\n                var req = this._deps.indexedDB.deleteDatabase(this.name);\n                req.onsuccess = wrap(() => {\n                    _onDatabaseDeleted(this._deps, this.name);\n                    resolve();\n                });\n                req.onerror = eventRejectHandler(reject);\n                req.onblocked = this._fireOnBlocked;\n            };\n            if (hasInvalidArguments)\n                throw new exceptions.InvalidArgument(\"Invalid closeOptions argument to db.delete()\");\n            if (state.isBeingOpened) {\n                state.dbReadyPromise.then(doDelete);\n            }\n            else {\n                doDelete();\n            }\n        });\n    }\n    backendDB() {\n        return this.idbdb;\n    }\n    isOpen() {\n        return this.idbdb !== null;\n    }\n    hasBeenClosed() {\n        const dbOpenError = this._state.dbOpenError;\n        return dbOpenError && (dbOpenError.name === 'DatabaseClosed');\n    }\n    hasFailed() {\n        return this._state.dbOpenError !== null;\n    }\n    dynamicallyOpened() {\n        return this._state.autoSchema;\n    }\n    get tables() {\n        return keys(this._allTables).map(name => this._allTables[name]);\n    }\n    transaction() {\n        const args = extractTransactionArgs.apply(this, arguments);\n        return this._transaction.apply(this, args);\n    }\n    _transaction(mode, tables, scopeFunc) {\n        let parentTransaction = PSD.trans;\n        if (!parentTransaction || parentTransaction.db !== this || mode.indexOf('!') !== -1)\n            parentTransaction = null;\n        const onlyIfCompatible = mode.indexOf('?') !== -1;\n        mode = mode.replace('!', '').replace('?', '');\n        let idbMode, storeNames;\n        try {\n            storeNames = tables.map(table => {\n                var storeName = table instanceof this.Table ? table.name : table;\n                if (typeof storeName !== 'string')\n                    throw new TypeError(\"Invalid table argument to Dexie.transaction(). Only Table or String are allowed\");\n                return storeName;\n            });\n            if (mode == \"r\" || mode === READONLY)\n                idbMode = READONLY;\n            else if (mode == \"rw\" || mode == READWRITE)\n                idbMode = READWRITE;\n            else\n                throw new exceptions.InvalidArgument(\"Invalid transaction mode: \" + mode);\n            if (parentTransaction) {\n                if (parentTransaction.mode === READONLY && idbMode === READWRITE) {\n                    if (onlyIfCompatible) {\n                        parentTransaction = null;\n                    }\n                    else\n                        throw new exceptions.SubTransaction(\"Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY\");\n                }\n                if (parentTransaction) {\n                    storeNames.forEach(storeName => {\n                        if (parentTransaction && parentTransaction.storeNames.indexOf(storeName) === -1) {\n                            if (onlyIfCompatible) {\n                                parentTransaction = null;\n                            }\n                            else\n                                throw new exceptions.SubTransaction(\"Table \" + storeName +\n                                    \" not included in parent transaction.\");\n                        }\n                    });\n                }\n                if (onlyIfCompatible && parentTransaction && !parentTransaction.active) {\n                    parentTransaction = null;\n                }\n            }\n        }\n        catch (e) {\n            return parentTransaction ?\n                parentTransaction._promise(null, (_, reject) => { reject(e); }) :\n                rejection(e);\n        }\n        const enterTransaction = enterTransactionScope.bind(null, this, idbMode, storeNames, parentTransaction, scopeFunc);\n        return (parentTransaction ?\n            parentTransaction._promise(idbMode, enterTransaction, \"lock\") :\n            PSD.trans ?\n                usePSD(PSD.transless, () => this._whenReady(enterTransaction)) :\n                this._whenReady(enterTransaction));\n    }\n    table(tableName) {\n        if (!hasOwn(this._allTables, tableName)) {\n            throw new exceptions.InvalidTable(`Table ${tableName} does not exist`);\n        }\n        return this._allTables[tableName];\n    }\n}\n\nconst symbolObservable = typeof Symbol !== \"undefined\" && \"observable\" in Symbol\n    ? Symbol.observable\n    : \"@@observable\";\nclass Observable {\n    constructor(subscribe) {\n        this._subscribe = subscribe;\n    }\n    subscribe(x, error, complete) {\n        return this._subscribe(!x || typeof x === \"function\" ? { next: x, error, complete } : x);\n    }\n    [symbolObservable]() {\n        return this;\n    }\n}\n\nlet domDeps;\ntry {\n    domDeps = {\n        indexedDB: _global.indexedDB || _global.mozIndexedDB || _global.webkitIndexedDB || _global.msIndexedDB,\n        IDBKeyRange: _global.IDBKeyRange || _global.webkitIDBKeyRange\n    };\n}\ncatch (e) {\n    domDeps = { indexedDB: null, IDBKeyRange: null };\n}\n\nfunction liveQuery(querier) {\n    let hasValue = false;\n    let currentValue;\n    const observable = new Observable((observer) => {\n        const scopeFuncIsAsync = isAsyncFunction(querier);\n        function execute(ctx) {\n            const wasRootExec = beginMicroTickScope();\n            try {\n                if (scopeFuncIsAsync) {\n                    incrementExpectedAwaits();\n                }\n                let rv = newScope(querier, ctx);\n                if (scopeFuncIsAsync) {\n                    rv = rv.finally(decrementExpectedAwaits);\n                }\n                return rv;\n            }\n            finally {\n                wasRootExec && endMicroTickScope();\n            }\n        }\n        let closed = false;\n        let abortController;\n        let accumMuts = {};\n        let currentObs = {};\n        const subscription = {\n            get closed() {\n                return closed;\n            },\n            unsubscribe: () => {\n                if (closed)\n                    return;\n                closed = true;\n                if (abortController)\n                    abortController.abort();\n                if (startedListening)\n                    globalEvents.storagemutated.unsubscribe(mutationListener);\n            },\n        };\n        observer.start && observer.start(subscription);\n        let startedListening = false;\n        const doQuery = () => execInGlobalContext(_doQuery);\n        function shouldNotify() {\n            return obsSetsOverlap(currentObs, accumMuts);\n        }\n        const mutationListener = (parts) => {\n            extendObservabilitySet(accumMuts, parts);\n            if (shouldNotify()) {\n                doQuery();\n            }\n        };\n        const _doQuery = () => {\n            if (closed ||\n                !domDeps.indexedDB)\n             {\n                return;\n            }\n            accumMuts = {};\n            const subscr = {};\n            if (abortController)\n                abortController.abort();\n            abortController = new AbortController();\n            const ctx = {\n                subscr,\n                signal: abortController.signal,\n                requery: doQuery,\n                querier,\n                trans: null\n            };\n            const ret = execute(ctx);\n            Promise.resolve(ret).then((result) => {\n                hasValue = true;\n                currentValue = result;\n                if (closed || ctx.signal.aborted) {\n                    return;\n                }\n                accumMuts = {};\n                currentObs = subscr;\n                if (!objectIsEmpty(currentObs) && !startedListening) {\n                    globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, mutationListener);\n                    startedListening = true;\n                }\n                execInGlobalContext(() => !closed && observer.next && observer.next(result));\n            }, (err) => {\n                hasValue = false;\n                if (!['DatabaseClosedError', 'AbortError'].includes(err?.name)) {\n                    if (!closed)\n                        execInGlobalContext(() => {\n                            if (closed)\n                                return;\n                            observer.error && observer.error(err);\n                        });\n                }\n            });\n        };\n        setTimeout(doQuery, 0);\n        return subscription;\n    });\n    observable.hasValue = () => hasValue;\n    observable.getValue = () => currentValue;\n    return observable;\n}\n\nconst Dexie = Dexie$1;\nprops(Dexie, {\n    ...fullNameExceptions,\n    delete(databaseName) {\n        const db = new Dexie(databaseName, { addons: [] });\n        return db.delete();\n    },\n    exists(name) {\n        return new Dexie(name, { addons: [] }).open().then(db => {\n            db.close();\n            return true;\n        }).catch('NoSuchDatabaseError', () => false);\n    },\n    getDatabaseNames(cb) {\n        try {\n            return getDatabaseNames(Dexie.dependencies).then(cb);\n        }\n        catch {\n            return rejection(new exceptions.MissingAPI());\n        }\n    },\n    defineClass() {\n        function Class(content) {\n            extend(this, content);\n        }\n        return Class;\n    },\n    ignoreTransaction(scopeFunc) {\n        return PSD.trans ?\n            usePSD(PSD.transless, scopeFunc) :\n            scopeFunc();\n    },\n    vip,\n    async: function (generatorFn) {\n        return function () {\n            try {\n                var rv = awaitIterator(generatorFn.apply(this, arguments));\n                if (!rv || typeof rv.then !== 'function')\n                    return DexiePromise.resolve(rv);\n                return rv;\n            }\n            catch (e) {\n                return rejection(e);\n            }\n        };\n    },\n    spawn: function (generatorFn, args, thiz) {\n        try {\n            var rv = awaitIterator(generatorFn.apply(thiz, args || []));\n            if (!rv || typeof rv.then !== 'function')\n                return DexiePromise.resolve(rv);\n            return rv;\n        }\n        catch (e) {\n            return rejection(e);\n        }\n    },\n    currentTransaction: {\n        get: () => PSD.trans || null\n    },\n    waitFor: function (promiseOrFunction, optionalTimeout) {\n        const promise = DexiePromise.resolve(typeof promiseOrFunction === 'function' ?\n            Dexie.ignoreTransaction(promiseOrFunction) :\n            promiseOrFunction)\n            .timeout(optionalTimeout || 60000);\n        return PSD.trans ?\n            PSD.trans.waitFor(promise) :\n            promise;\n    },\n    Promise: DexiePromise,\n    debug: {\n        get: () => debug,\n        set: value => {\n            setDebug(value);\n        }\n    },\n    derive: derive,\n    extend: extend,\n    props: props,\n    override: override,\n    Events: Events,\n    on: globalEvents,\n    liveQuery,\n    extendObservabilitySet,\n    getByKeyPath: getByKeyPath,\n    setByKeyPath: setByKeyPath,\n    delByKeyPath: delByKeyPath,\n    shallowClone: shallowClone,\n    deepClone: deepClone,\n    getObjectDiff: getObjectDiff,\n    cmp,\n    asap: asap$1,\n    minKey: minKey,\n    addons: [],\n    connections: connections,\n    errnames: errnames,\n    dependencies: domDeps,\n    cache,\n    semVer: DEXIE_VERSION,\n    version: DEXIE_VERSION.split('.')\n        .map(n => parseInt(n))\n        .reduce((p, c, i) => p + (c / Math.pow(10, i * 2))),\n});\nDexie.maxKey = getMaxKey(Dexie.dependencies.IDBKeyRange);\n\nif (typeof dispatchEvent !== 'undefined' && typeof addEventListener !== 'undefined') {\n    globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, updatedParts => {\n        if (!propagatingLocally) {\n            let event;\n            event = new CustomEvent(STORAGE_MUTATED_DOM_EVENT_NAME, {\n                detail: updatedParts\n            });\n            propagatingLocally = true;\n            dispatchEvent(event);\n            propagatingLocally = false;\n        }\n    });\n    addEventListener(STORAGE_MUTATED_DOM_EVENT_NAME, ({ detail }) => {\n        if (!propagatingLocally) {\n            propagateLocally(detail);\n        }\n    });\n}\nfunction propagateLocally(updateParts) {\n    let wasMe = propagatingLocally;\n    try {\n        propagatingLocally = true;\n        globalEvents.storagemutated.fire(updateParts);\n        signalSubscribersNow(updateParts, true);\n    }\n    finally {\n        propagatingLocally = wasMe;\n    }\n}\nlet propagatingLocally = false;\n\nlet bc;\nlet createBC = () => { };\nif (typeof BroadcastChannel !== 'undefined') {\n    createBC = () => {\n        bc = new BroadcastChannel(STORAGE_MUTATED_DOM_EVENT_NAME);\n        bc.onmessage = ev => ev.data && propagateLocally(ev.data);\n    };\n    createBC();\n    if (typeof bc.unref === 'function') {\n        bc.unref();\n    }\n    globalEvents(DEXIE_STORAGE_MUTATED_EVENT_NAME, (changedParts) => {\n        if (!propagatingLocally) {\n            bc.postMessage(changedParts);\n        }\n    });\n}\n\nif (typeof addEventListener !== 'undefined') {\n    addEventListener('pagehide', (event) => {\n        if (!Dexie$1.disableBfCache && event.persisted) {\n            if (debug)\n                console.debug('Dexie: handling persisted pagehide');\n            bc?.close();\n            for (const db of connections) {\n                db.close({ disableAutoOpen: false });\n            }\n        }\n    });\n    addEventListener('pageshow', (event) => {\n        if (!Dexie$1.disableBfCache && event.persisted) {\n            if (debug)\n                console.debug('Dexie: handling persisted pageshow');\n            createBC();\n            propagateLocally({ all: new RangeSet(-Infinity, [[]]) });\n        }\n    });\n}\n\nfunction add(value) {\n    return new PropModification({ add: value });\n}\n\nfunction remove(value) {\n    return new PropModification({ remove: value });\n}\n\nfunction replacePrefix(a, b) {\n    return new PropModification({ replacePrefix: [a, b] });\n}\n\nDexiePromise.rejectionMapper = mapError;\nsetDebug(debug);\n\nexport { Dexie$1 as Dexie, Entity, PropModSymbol, PropModification, RangeSet, add, cmp, Dexie$1 as default, liveQuery, mergeRanges, rangesOverlap, remove, replacePrefix };\n//# sourceMappingURL=dexie.mjs.map\n", "type OptionInner<T> = { some: true; value: T } | { some: false };\r\n\r\ninterface OptionMatcher<T, O> {\r\n\tsome(value: T): O;\r\n\tnone(): O;\r\n}\r\n\r\nexport class Option<T> {\r\n\tprivate readonly inner: OptionInner<T>;\r\n\r\n\tprivate constructor(inner: OptionInner<T>) {\r\n\t\tthis.inner = inner;\r\n\t}\r\n\r\n\tpublic static Some<T>(value: T): Option<T> {\r\n\t\treturn new Option<T>({ some: true, value: value });\r\n\t}\r\n\r\n\tpublic static None<T, E>(): Option<T> {\r\n\t\treturn new Option<T>({ some: false });\r\n\t}\r\n\r\n\tpublic match<O>(matcher: OptionMatcher<T, O>): O {\r\n\t\tif (this.inner.some) {\r\n\t\t\treturn matcher.some(this.inner.value);\r\n\t\t}\r\n\t\treturn matcher.none();\r\n\t}\r\n\r\n\tpublic map<O>(fn: (_: T) => O): Option<O> {\r\n\t\treturn this.match({\r\n\t\t\tsome: (t) => Option.Some(fn(t)),\r\n\t\t\tnone: () => Option.None(),\r\n\t\t});\r\n\t}\r\n\r\n\tpublic andThen<O>(fn: (_: T) => Option<O>): Option<O> {\r\n\t\treturn this.match({\r\n\t\t\tsome: (t) => fn(t),\r\n\t\t\tnone: () => Option.None(),\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport const Some = <T>(value: T): Option<T> => {\r\n\treturn Option.Some(value);\r\n};\r\n\r\nexport const None = <T>(): Option<T> => {\r\n\treturn Option.None();\r\n};\r\n\r\ntype ResultInner<T, E> = { ok: true; value: T } | { ok: false; error: E };\r\n\r\ninterface ResultMatcher<T, E, O> {\r\n\tok(value: T): O;\r\n\terr(error: E): O;\r\n}\r\n\r\nexport class Result<T, E = Error> {\r\n\tprivate readonly inner: ResultInner<T, E>;\r\n\r\n\tprivate constructor(inner: ResultInner<T, E>) {\r\n\t\tthis.inner = inner;\r\n\t}\r\n\r\n\tpublic static Ok<T, E>(value: T): Result<T, E> {\r\n\t\treturn new Result<T, E>({ ok: true, value: value });\r\n\t}\r\n\r\n\tpublic static Err<T, E>(error: E): Result<T, E> {\r\n\t\treturn new Result<T, E>({ ok: false, error: error });\r\n\t}\r\n\r\n\tpublic isOk(): boolean {\r\n\t\treturn this.inner.ok;\r\n\t}\r\n\r\n\tpublic match<O>(matcher: ResultMatcher<T, E, O>): O {\r\n\t\tif (this.inner.ok) {\r\n\t\t\treturn matcher.ok(this.inner.value);\r\n\t\t}\r\n\t\treturn matcher.err(this.inner.error);\r\n\t}\r\n\r\n\tpublic map<O>(fn: (_: T) => O): Result<O, E> {\r\n\t\treturn this.match({\r\n\t\t\tok: (t) => Result.Ok(fn(t)),\r\n\t\t\terr: (e) => Result.Err(e),\r\n\t\t});\r\n\t}\r\n\r\n\tpublic mapErr<O>(fn: (_: E) => O): Result<T, O> {\r\n\t\treturn this.match({\r\n\t\t\tok: (t) => Result.Ok(t),\r\n\t\t\terr: (e) => Result.Err(fn(e)),\r\n\t\t});\r\n\t}\r\n\r\n\tpublic andThen<O>(fn: (_: T) => Result<O, E>): Result<O, E> {\r\n\t\treturn this.match({\r\n\t\t\tok: (t) => fn(t),\r\n\t\t\terr: (e) => Result.Err(e),\r\n\t\t});\r\n\t}\r\n\r\n\tpublic asOk(): Option<T> {\r\n\t\treturn this.match({\r\n\t\t\tok: (t) => Option.Some(t),\r\n\t\t\terr: (_) => Option.None(),\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport const Ok = <T, E = Error>(value: T): Result<T, E> => {\r\n\treturn Result.Ok(value);\r\n};\r\n\r\nexport const Err = <T, E = Error>(error: E): Result<T, E> => {\r\n\treturn Result.Err(error);\r\n};\r\n\r\nexport function to<\r\n\t// biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n\tT extends { readonly __tag: symbol; value: any } = {\r\n\t\treadonly __tag: unique symbol;\r\n\t\tvalue: never;\r\n\t},\r\n>(value: T[\"value\"]): T {\r\n\t// biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n\treturn value as any as T;\r\n}\r\n\r\nexport function from<\r\n\t// biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n\tT extends { readonly __tag: symbol; value: any },\r\n>(value: T): T[\"value\"] {\r\n\t// biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n\treturn value as any as T[\"value\"];\r\n}\r\n\r\nexport function arrayShuffle<T>(array: T[], seed: number): T[] {\r\n\tlet currentIndex = array.length;\r\n\tlet temporaryValue: T;\r\n\tlet randomIndex: number;\r\n\r\n\tconst random = (seed: number) => {\r\n\t\t// biome-ignore lint/style/noParameterAssign: <explanation>\r\n\t\tconst x = Math.sin(seed++) * 10000;\r\n\t\treturn x - Math.floor(x);\r\n\t};\r\n\r\n\t// While there remain elements to shuffle...\r\n\twhile (0 !== currentIndex) {\r\n\t\t// Pick a remaining element...\r\n\t\trandomIndex = Math.floor(random(seed) * currentIndex--);\r\n\r\n\t\t// And swap it with the current element.\r\n\t\ttemporaryValue = array[currentIndex];\r\n\t\tarray[currentIndex] = array[randomIndex];\r\n\t\tarray[randomIndex] = temporaryValue;\r\n\r\n\t\t// biome-ignore lint/style/noParameterAssign: <explanation>\r\n\t\t++seed;\r\n\t}\r\n\r\n\treturn array;\r\n}\r\n\r\nexport const until = (conditionFunction: () => boolean): Promise<void> => {\r\n\tconst poll = (resolve: () => void) => {\r\n\t\tif (conditionFunction()) {\r\n\t\t\tresolve();\r\n\t\t} else {\r\n\t\t\tsetTimeout(() => poll(resolve), 400);\r\n\t\t}\r\n\t};\r\n\r\n\treturn new Promise(poll);\r\n};\r\n", "import Dexie, { type EntityTable } from \"../libraries/dexie\";\r\n\r\nimport { BookType } from \"../models/database\";\r\nimport type {\r\n\tBook,\r\n\tBookId,\r\n\tBookshelf,\r\n\tBookshelfId,\r\n\tUserBook,\r\n\tUserBookId,\r\n} from \"../models/database\";\r\n\r\nimport { arrayShuffle, Err, Ok, type Result, to } from \"../utils\";\r\n\r\nconst createBook = (\r\n\tuserId: string,\r\n\tbookId: string,\r\n\tcover: string,\r\n): UserBook => {\r\n\treturn {\r\n\t\tid: to<UserBookId>(userId),\r\n\t\tbook: {\r\n\t\t\tid: to<BookId>(bookId),\r\n\r\n\t\t\tcover: cover,\r\n\r\n\t\t\ttitle: \"\",\r\n\t\t\ttype: BookType.Paperback,\r\n\t\t\tpages: 0,\r\n\t\t\tdescription: \"\",\r\n\t\t\tpublished: new Date(),\r\n\t\t},\r\n\t\trating: 0,\r\n\t\tpurchased: new Date(),\r\n\t};\r\n};\r\n\r\n// biome-ignore format: Get way too nig to easily edit\r\nconst BOOKS: UserBook[] = [\r\n    createBook(\"ybw-djFeWs3vbQf25xECQ\", \"T62kQhbo_aIOeCpwHrQGi\", \"./public/0009276845-L.jpg\"),\r\n    createBook(\"LPJ8qsBpZ1y8P_rYIT9Gh\", \"_GxMZyg9UKMitNaR5Edv9\", \"./public/0009970034-L.jpg\"),\r\n    createBook(\"xOkcThsOnbJZunwyT7-WQ\", \"XCOIWR0WVVl3w-xU_7E1C\", \"./public/0010128852-L.jpg\"),\r\n    createBook(\"Z6DOq8S4Myv_3zARzpKqi\", \"Vy6o4DHiOD4oLsX0spCkB\", \"./public/0011865531-L.jpg\"),\r\n    createBook(\"YeastuskxRucUS6LcVGgM\", \"pCXbm02mtO-nLh4vSDLv7\", \"./public/0011918737-L.jpg\"),\r\n    createBook(\"5UsM88R9aWmu_99QE_txN\", \"p9uMVa7JPB8KHww4T23-y\", \"./public/0011922810-L.jpg\"),\r\n    createBook(\"B4co_lLhlipaaqJIOfd_q\", \"05R5JdXJnKCPXKXkhQ5kg\", \"./public/0012791623-L.jpg\"),\r\n    createBook(\"2_ngDyhiju9ICYcj74e9I\", \"c9Qid8p9zEPqx6F4SF4KE\", \"./public/0013070958-L.jpg\"),\r\n    createBook(\"77k448mgkXtvNt3ZAatR-\", \"tJjkqPq-S_Ps9IYBbxpcs\", \"./public/0013416640-L.jpg\"),\r\n    createBook(\"c_ge0A-VrqeUyAeIYwUUG\", \"4hauXlVpAPYklHr34ZIca\", \"./public/3002898-L.jpg\"),\r\n    createBook(\"X1i9K4u6PAQuKNnxPicjH\", \"k-BhTcS47DH67PC2MM9jB\", \"./public/4607078-L.jpg\"),\r\n    createBook(\"FaX5sR_EfK5fd6Rxp0r3H\", \"KiXRSYeIzMbMOAyKp0698\", \"./public/5654258-L.jpg\"),\r\n    createBook(\"WHHZAfI1iKOT34Bv67Aew\", \"BNYH3hfbZ6OioHWCjqrJp\", \"./public/573479-L.jpg\"),\r\n    createBook(\"8DcfoeHezAOv_RxhLiJCR\", \"UHOjdK4MZp9abgQMO3Evl\", \"./public/5742496-L.jpg\"),\r\n    createBook(\"B-a26--EClbZb2Q5lqfP7\", \"5oeIFqpV-5GcnKiBaUQQb\", \"./public/6136328-L.jpg\"),\r\n    createBook(\"Iv7BJCsfV7IGi_Wd6LGZX\", \"sut-OS24Emr1K3veiUVKo\", \"./public/7132786-L.jpg\"),\r\n    createBook(\"STfmfyurEOWITHNZ-WeJt\", \"3iJzTSfLDMY2_7LSTO2Sj\", \"./public/7943675-L.jpg\"),\r\n];\r\n\r\nconst database = new Dexie(\"sissix\") as Dexie & {\r\n\tbooks: EntityTable<Book, \"id\">;\r\n\tuserBooks: EntityTable<UserBook, \"id\">;\r\n\tbookshelves: EntityTable<Bookshelf, \"id\">;\r\n};\r\n\r\ndatabase.version(1).stores({\r\n\tbooks: \"++id\",\r\n\tuserBooks: \"++id\",\r\n\tbookshelves: \"++id\",\r\n});\r\n\r\nexport const getBookshelves = async (): Promise<Result<Bookshelf[]>> => {\r\n\treturn Ok([\r\n\t\t{\r\n\t\t\tid: to<BookshelfId>(\"1\"),\r\n\t\t\tname: \"Test Bookshelf\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: to<BookshelfId>(\"2\"),\r\n\t\t\tname: \"Test Bookshelf\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: to<BookshelfId>(\"3\"),\r\n\t\t\tname: \"Test Bookshelf\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tid: to<BookshelfId>(\"4\"),\r\n\t\t\tname: \"Test Bookshelf\",\r\n\t\t},\r\n\t]);\r\n};\r\n\r\nexport const getBooks = async (\r\n\tid: BookshelfId,\r\n): Promise<Result<UserBook[]>> => {\r\n\tif (id === to<BookshelfId>(\"1\")) {\r\n\t\treturn Ok(BOOKS);\r\n\t}\r\n\tif (id === to<BookshelfId>(\"2\")) {\r\n\t\treturn Ok(BOOKS);\r\n\t}\r\n\tif (id === to<BookshelfId>(\"3\")) {\r\n\t\treturn Ok(BOOKS);\r\n\t}\r\n\tif (id === to<BookshelfId>(\"4\")) {\r\n\t\treturn Ok(BOOKS);\r\n\t}\r\n\r\n\treturn Err(new Error(\"Method not implemented.\"));\r\n};\r\n", "/// <reference lib=\"webworker\" />\r\n\r\n// biome-ignore lint/complexity/noUselessEmptyExport: THis is needed to get service worker types working, thanks Typescript.\r\nexport type {};\r\ndeclare const self: ServiceWorkerGlobalScope;\r\n\r\nimport Path, { type TestMatch } from \"@/path\";\r\n\r\nimport { getBookshelves, getBooks } from \"./database/worker\";\r\nimport { type Result, to } from \"./utils\";\r\n\r\nconst CACHE_NAME = `sissix-cache-${SISSIX.gitHash}`;\r\n\r\nconst fetchHandler = (() => {\r\n\t// biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n\ttype Handler<T extends Record<string, any> = Record<string, any>> = (\r\n\t\trequest: Request,\r\n\t\tparams: TestMatch<T>,\r\n\t) => Promise<Response>;\r\n\r\n\t// biome-ignore lint/suspicious/noExplicitAny: <explanation>\r\n\ttype Route<T extends Record<string, any> = Record<string, any>> = [Path<T>, Handler<T>];\r\n\r\n\tconst responseApi = <T>(data: T) => {\r\n\t\treturn Response.json({ data: data }, { status: 200 });\r\n\t};\r\n\r\n\tconst responseError = (status: number, code: string, message: string) => {\r\n\t\treturn Response.json({ code: code, message: message }, { status: status });\r\n\t};\r\n\r\n\tconst responseNotFound = (message: string) => responseError(404, \"NOT_FOUND\", message);\r\n\r\n\tconst responseInternal = (message: string) => responseError(500, \"INTERNAL_SERVER_ERROR\", message);\r\n\r\n\tconst intoResponse = <T>(result: Result<T>) =>\r\n\t\tresult.match({\r\n\t\t\tok: (value) => responseApi(value),\r\n\t\t\terr: (error) => responseInternal(error.message),\r\n\t\t});\r\n\r\n\tconst bookshelves: Handler = async (request, _) => {\r\n\t\tif (request.method === \"GET\") {\r\n\t\t\treturn intoResponse(await getBookshelves());\r\n\t\t}\r\n\r\n\t\treturn responseNotFound(\"\");\r\n\t};\r\n\r\n\tconst bookshelf: Handler = async (request, params) => {\r\n\t\tif (params == null) {\r\n\t\t\treturn responseNotFound(\"\");\r\n\t\t}\r\n\r\n\t\tif (typeof params.id === \"string\") {\r\n\t\t\tif (request.method === \"GET\") {\r\n\t\t\t\treturn intoResponse(await getBooks(to(params.id)));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn responseNotFound(\"\");\r\n\t};\r\n\r\n\tconst handlers: Route[] = [\r\n\t\t[new Path(\"/api/bookshelves\"), bookshelves],\r\n\t\t[new Path(\"/api/bookshelves/:id\"), bookshelf],\r\n\t];\r\n\r\n\treturn async (request: Request): Promise<Response> => {\r\n\t\tconst url = new URL(request.url);\r\n\r\n\t\tif (url.hostname === self.location.hostname) {\r\n\t\t\tif (!SISSIX.production && url.pathname === \"/esbuild\") {\r\n\t\t\t\treturn await fetch(request);\r\n\t\t\t}\r\n\r\n\t\t\tfor (const [path, handler] of handlers) {\r\n\t\t\t\tconst parsed = path.test(url.pathname);\r\n\t\t\t\tif (parsed == null) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn await handler(request, parsed);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn await fetch(request);\r\n\t};\r\n})();\r\n\r\nself.addEventListener(\"activate\", (event) => {\r\n\tevent.waitUntil(\r\n\t\t(async () => {\r\n\t\t\tconst keys = await caches.keys();\r\n\t\t\tconst jobs = keys.map((key) => (key !== CACHE_NAME ? caches.delete(key) : Promise.resolve()));\r\n\t\t\treturn Promise.all(jobs);\r\n\t\t})(),\r\n\t);\r\n\r\n\tself.clients.claim();\r\n});\r\n\r\nself.addEventListener(\"fetch\", (event) => {\r\n\tevent.respondWith(fetchHandler(event.request));\r\n});\r\n\r\nself.addEventListener(\"install\", (event) => {\r\n\tconst cachedPaths = [\r\n\t\t\"./\",\r\n\t\t\"./android-chrome-144x144.png\",\r\n\t\t\"./android-chrome-192x192.png\",\r\n\t\t\"./android-chrome-256x256.png\",\r\n\t\t\"./android-chrome-36x36.png\",\r\n\t\t\"./android-chrome-384x384.png\",\r\n\t\t\"./android-chrome-48x48.png\",\r\n\t\t\"./android-chrome-512x512.png\",\r\n\t\t\"./android-chrome-72x72.png\",\r\n\t\t\"./android-chrome-96x96.png\",\r\n\t\t\"./apple-touch-icon-114x114-precomposed.png\",\r\n\t\t\"./apple-touch-icon-114x114.png\",\r\n\t\t\"./apple-touch-icon-120x120-precomposed.png\",\r\n\t\t\"./apple-touch-icon-120x120.png\",\r\n\t\t\"./apple-touch-icon-144x144-precomposed.png\",\r\n\t\t\"./apple-touch-icon-144x144.png\",\r\n\t\t\"./apple-touch-icon-152x152-precomposed.png\",\r\n\t\t\"./apple-touch-icon-152x152.png\",\r\n\t\t\"./apple-touch-icon-180x180-precomposed.png\",\r\n\t\t\"./apple-touch-icon-180x180.png\",\r\n\t\t\"./apple-touch-icon-57x57-precomposed.png\",\r\n\t\t\"./apple-touch-icon-57x57.png\",\r\n\t\t\"./apple-touch-icon-60x60-precomposed.png\",\r\n\t\t\"./apple-touch-icon-60x60.png\",\r\n\t\t\"./apple-touch-icon-72x72-precomposed.png\",\r\n\t\t\"./apple-touch-icon-72x72.png\",\r\n\t\t\"./apple-touch-icon-76x76-precomposed.png\",\r\n\t\t\"./apple-touch-icon-76x76.png\",\r\n\t\t\"./apple-touch-icon-precomposed.png\",\r\n\t\t\"./apple-touch-icon.png\",\r\n\t\t\"./favicon-16x16.png\",\r\n\t\t\"./favicon-194x194.png\",\r\n\t\t\"./favicon-32x32.png\",\r\n\t\t\"./favicon.ico\",\r\n\t\t\"./index.html\",\r\n\t\t\"./main.css\",\r\n\t\t\"./main.js\",\r\n\t\t\"./main.js.map\",\r\n\t\t\"./manifest.json\",\r\n\t\t\"./maskable-icon-1024x1024.png\",\r\n\t\t\"./maskable-icon-128x128.png\",\r\n\t\t\"./maskable-icon-192x192.png\",\r\n\t\t\"./maskable-icon-384x384.png\",\r\n\t\t\"./maskable-icon-48x48.png\",\r\n\t\t\"./maskable-icon-512x512.png\",\r\n\t\t\"./maskable-icon-72x72.png\",\r\n\t\t\"./maskable-icon-96x96.png\",\r\n\t\t\"./mstile-144x144.png\",\r\n\t\t\"./mstile-150x150.png\",\r\n\t\t\"./mstile-310x150.png\",\r\n\t\t\"./mstile-310x310.png\",\r\n\t\t\"./mstile-70x70.png\",\r\n\t\t\"./open-graph.png\",\r\n\t\t\"./robots.txt\",\r\n\t\t\"./safari-pinned-tab.svg\",\r\n\t\t\"./service-worker.js\",\r\n\t\t\"./service-worker.js.map\",\r\n\t];\r\n\r\n\tself.skipWaiting();\r\n\r\n\tevent.waitUntil(caches.open(CACHE_NAME).then((cache) => cache.addAll(cachedPaths)));\r\n});\r\n\r\nself.addEventListener(\"message\", (_event) => {});\r\n"],
  "mappings": "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",
  "names": ["makeOptions", "opts", "encodeValue", "value", "decodeValue", "encodeBoolean", "name", "encodedValue", "encodeNull", "getNameEncoder", "index", "encodeArray", "arr", "encodeName", "val", "encode", "encodedName", "decode", "decodedValue", "getSearch", "path", "pos", "isSerializable", "parseName", "bracketPosition", "hasBrackets", "parseQueryParams", "options", "params", "param", "rawName", "decodedName", "currentValue", "buildQueryParams", "paramName", "excludeSubDelimiters", "encodeURIComponentExcludingSubDelims", "segment", "match", "encodingMethods", "decodingMethods", "encodeParam", "encoding", "isSpatParam", "encoder", "decodeParam", "defaultOrConstrained", "rules", "tokenise", "str", "tokens", "rule", "exists", "optTrailingSlash", "source", "strictTrailingSlash", "upToDelimiter", "delimiter", "appendQueryParam", "existingVal", "defaultOptions", "Path", "_Path", "t", "queryParams", "p", "encodedUrlParams", "acc", "key", "v", "missingParameters", "base", "searchParams", "sparams", "searchPart", "type", "predicate", "caseSensitive", "urlParamsEncoding", "regex", "m", "i", "path_default", "_global", "keys", "isArray", "extend", "obj", "extension", "key", "getProto", "_hasOwn", "hasOwn", "prop", "props", "proto", "setProp", "defineProperty", "functionOrGetSet", "options", "derive", "Child", "Parent", "getOwnPropertyDescriptor", "getPropertyDescriptor", "pd", "_slice", "slice", "args", "start", "end", "override", "origFunc", "overridedFactory", "assert", "b", "asap$1", "fn", "arrayToObject", "array", "extractor", "result", "item", "i", "nameAndValue", "getByKeyPath", "keyPath", "rv", "l", "val", "period", "innerObj", "setByKeyPath", "value", "currentKeyPath", "remainingKeyPath", "delByKeyPath", "kp", "shallowClone", "m", "concat", "flatten", "a", "intrinsicTypeNames", "num", "t", "intrinsicTypes", "cloneSimpleObjectTree", "o", "k", "v", "objectIsEmpty", "circularRefs", "deepClone", "any", "innerDeepClone", "x", "toString", "toStringTag", "iteratorSymbol", "getIteratorOf", "delArrayItem", "NO_CHAR_ARRAY", "getArrayOf", "arrayLike", "it", "isAsyncFunction", "dexieErrorNames", "idbDomErrorNames", "errorList", "defaultTexts", "DexieError", "name", "msg", "getMultiErrorMessage", "failures", "ModifyError", "successCount", "failedKeys", "BulkError", "pos", "errnames", "BaseException", "exceptions", "fullName", "msgOrInner", "inner", "exceptionMap", "mapError", "domError", "message", "fullNameExceptions", "nop", "mirror", "pureFunctionChain", "f1", "f2", "callBoth", "on1", "on2", "hookCreatingChain", "res", "onsuccess", "onerror", "res2", "hookDeletingChain", "hookUpdatingChain", "modifications", "reverseStoppableEventChain", "promisableChain", "thiz", "debug", "setDebug", "filter", "INTERNAL", "ZONE_ECHO_LIMIT", "resolvedNativePromise", "nativePromiseProto", "resolvedGlobalPromise", "globalP", "nativeP", "nativePromiseThen", "NativePromise", "patchGlobalPromise", "schedulePhysicalTick", "physicalTick", "asap", "callback", "microtickQueue", "needsNewPhysicalTick", "isOutsideMicroTick", "unhandledErrors", "rejectingErrors", "rejectionMapper", "globalPSD", "PSD", "numScheduledCalls", "tickFinalizers", "DexiePromise", "psd", "handleRejection", "executePromiseTask", "thenProp", "microTaskId", "totalEchoes", "then", "onFulfilled", "onRejected", "possibleAwait", "cleanup", "decrementExpectedAwaits", "resolve", "reject", "propagateToListener", "Listener", "nativeAwaitCompatibleWrap", "type", "handler", "err", "PromiseReject", "onFinally", "ms", "handle", "snapShot", "zone", "values", "onPossibleParallellAsync", "remaining", "newScope", "usePSD", "zoneProps", "run_at_end_of_this_or_next_physical_tick", "possiblePromises", "results", "p", "reason", "failure", "promise", "shouldExecuteTick", "beginMicroTickScope", "propagateAllListeners", "endMicroTickScope", "ex", "addPossiblyUnhandledError", "listeners", "len", "finalizePhysicalTick", "listener", "cb", "callListener", "ret", "markErrorAsHandled", "e", "wasRootExec", "callbacks", "unhandledErrs", "finalizers", "finalizer", "wrap", "errorCatcher", "outerScope", "switchToZone", "task", "taskCounter", "zoneStack", "zoneEchoes", "zone_id_counter", "a1", "a2", "parent", "incrementExpectedAwaits", "possiblePromise", "rejection", "zoneEnterEcho", "targetZone", "zoneLeaveEcho", "bEnteringZone", "currentZone", "GlobalPromise", "targetEnv", "a3", "outerZone", "execInGlobalContext", "tempTransaction", "db", "mode", "storeNames", "trans", "DEXIE_VERSION", "maxString", "minKey", "INVALID_KEY_ARGUMENT", "STRING_EXPECTED", "connections", "DBNAMES_DB", "READONLY", "READWRITE", "combine", "filter1", "filter2", "AnyRange", "workaroundForUndefinedPrimKey", "Entity", "cmp", "ta", "tb", "compareUint8Arrays", "getUint8Array", "compareArrays", "al", "bl", "tsTag", "Table", "writeLocked", "tableName", "checkTableInTransaction", "keyOrCrit", "indexOrCrit", "keyPaths", "compoundIndex", "ix", "keyPathsInValidOrder", "idxByName", "idb", "equals", "idx", "filterFunction", "prevIndex", "prevFilterFn", "index", "thenShortcut", "offset", "numRows", "constructor", "inheritedProps", "propName", "readHook", "Class", "content", "auto", "objToAdd", "lastResult", "keyOrObject", "objects", "keysOrOptions", "wantResults", "numObjects", "objectsToAdd", "numFailures", "objectsToPut", "keysAndChanges", "coreTable", "entry", "changeSpecs", "offsetMap", "objs", "resultKeys", "resultObjs", "changes", "numEntries", "mappedOffset", "numKeys", "Events", "ctx", "evs", "eventName", "subscriber", "add", "chainFunction", "defaultFunction", "addConfiguredEvents", "context", "cfg", "makeClassConstructor", "prototype", "createTableConstructor", "tableSchema", "isPlainKeyRange", "ignoreLimitFilter", "addFilter", "addReplayFilter", "factory", "isLimitFilter", "curr", "addMatchFilter", "getIndexOrStore", "coreSchema", "openCursor", "iter", "coreTrans", "set", "union", "cursor", "advance", "primaryKey", "iterate", "cursorPromise", "valueMapper", "mappedFn", "c", "wrappedFn", "advancer", "PropModSymbol", "PropModification", "term", "subtrahend", "prefixToReplace", "spec", "Collection", "count", "parts", "lastPart", "lastIndex", "getval", "order", "sorter", "aVal", "bVal", "offsetLeft", "rowsLeft", "bIncludeStopEntry", "indexName", "strKey", "found", "modifyer", "anythingModified", "origVal", "outbound", "extractKey", "limit", "totalFailures", "applyMutateResult", "expectedCount", "criteria", "deleteCallback", "nextChunk", "addValues", "putValues", "putKeys", "deleteKeys", "origValue", "range", "coreRange", "createCollectionConstructor", "whereClause", "keyRangeGenerator", "keyRange", "error", "whereCtx", "table", "readingHook", "simpleCompare", "simpleCompareReverse", "fail", "collectionOrWhereClause", "T", "collection", "WhereClause", "emptyCollection", "rangeEqual", "upperFactory", "dir", "s", "lowerFactory", "nextCasing", "lowerKey", "upperNeedle", "lowerNeedle", "length", "llp", "lwrKeyChar", "addIgnoreCaseAlgorithm", "match", "needles", "suffix", "upper", "lower", "compare", "upperNeedles", "lowerNeedles", "direction", "nextKeySuffix", "needlesLen", "initDirection", "needleBounds", "needle", "nb", "createRange", "firstPossibleNeedle", "lowestPossibleCasing", "casing", "lowerOpen", "upperOpen", "includeLower", "includeUpper", "str", "n", "ranges", "ascending", "descending", "min", "max", "includeLowers", "includeUppers", "addRange", "newRange", "sortDirection", "rangeSorter", "rangePos", "keyIsBeyondCurrentEntry", "keyIsBeforeCurrentEntry", "keyWithinCurrentRange", "checkKey", "createWhereClauseConstructor", "orCollection", "eventRejectHandler", "event", "preventDefault", "DEXIE_STORAGE_MUTATED_EVENT_NAME", "STORAGE_MUTATED_DOM_EVENT_NAME", "globalEvents", "Transaction", "fnAndPSD", "idbtrans", "idbdb", "dbOpenError", "ev", "bWriteLock", "promiseLike", "root", "store", "spin", "currentWaitPromise", "memoizedTables", "transactionBoundTable", "createTransactionConstructor", "dbschema", "chromeTransactionDurability", "wasActive", "createIndexSpec", "unique", "multi", "compound", "isPrimKey", "nameFromKeyPath", "createTableSchema", "primKey", "indexes", "safariMultiStoreFix", "getMaxKey", "IdbKeyRange", "getKeyExtractor", "getSinglePathKeyExtractor", "arrayify", "_id_counter", "getKeyPathAlias", "createDBCore", "tmpTrans", "extractSchema", "tables", "autoIncrement", "indexByKeyPath", "multiEntry", "makeIDBKeyRange", "createDbCoreTable", "mutate", "isAddOrPut", "req", "reqs", "errorHandler", "args1", "args2", "done", "query", "reverse", "source", "_cursorContinue", "_cursorContinuePrimaryKey", "_cursorAdvance", "doThrowCursorIsNotStarted", "doThrowCursorIsStopped", "gotOne", "iterationPromise", "resolveIteration", "rejectIteration", "guardedCallback", "hasGetAll", "request", "nonInfinitLimit", "idbKeyRange", "keyCount", "callbackCount", "successHandler", "schema", "tableMap", "createMiddlewareStack", "stackImpl", "middlewares", "down", "create", "createMiddlewareStacks", "IDBKeyRange", "indexedDB", "generateMiddlewareStacks", "stacks", "tbl", "setApiOnPlace", "tableNames", "propDesc", "removeTablesApi", "lowerVersionFirst", "runUpgraders", "oldVersion", "idbUpgradeTrans", "globalSchema", "parseIndexSyntax", "rejectTransaction", "transless", "createTable", "getExistingVersion", "updateTablesAndIndexes", "patchCurrentVersion", "createMissingTables", "buildGlobalSchema", "adjustToExistingIndexNames", "diff", "getSchemaDiff", "tableChange", "addIndex", "metaVersion", "queue", "versions", "versToRun", "version", "oldSchema", "newSchema", "tuple", "change", "idxName", "contentUpgrade", "upgradeSchema", "contentUpgradeIsAsync", "returnValue", "promiseFollowed", "decrementor", "deleteRemovedTables", "runQueue", "oldDef", "newDef", "oldIndexes", "newIndexes", "oldIdx", "newIdx", "storeName", "j", "idbindex", "readGlobalSchema", "verifyInstalledSchema", "installedSchema", "ch", "dexieName", "indexSpec", "primKeyAndIndexes", "indexNum", "Version", "stores", "outSchema", "storesSpec", "upgradeFunction", "createVersionConstructor", "versionNumber", "getDbNamesTable", "dbNamesDB", "Dexie$1", "hasDatabasesNative", "getDatabaseNames", "infos", "info", "_onDatabaseCreated", "_onDatabaseDeleted", "vip", "idbReady", "isSafari", "intervalId", "tryIdb", "isEmptyRange", "node", "RangeSet", "fromOrTree", "to", "rangeSet", "mergeRanges", "getRangeSetIterator", "target", "from", "left", "right", "rebalance", "rightWasCutOff", "newSet", "_addRangeSet", "r", "rangesOverlap", "rangeSet1", "rangeSet2", "i1", "nextResult1", "i2", "nextResult2", "state", "keyProvided", "rootClone", "oldRootRight", "computeDepth", "extendObservabilitySet", "part", "obsSetsOverlap", "os1", "os2", "cache", "unsignaledParts", "isTaskEnqueued", "signalSubscribersLazily", "optimistic", "signalSubscribersNow", "updatedParts", "deleteAffectedCacheEntries", "queriesToSignal", "tblCache", "collectTableSubscribers", "dbName", "requery", "outQueriesToSignal", "updatedEntryLists", "entries", "filteredEntries", "dexieOpen", "openCanceller", "nativeVerToOpen", "schemaPatchMode", "throwIfCancelled", "resolveDbReady", "upgradeTransaction", "wasCreated", "tryOpenDB", "delreq", "oldVer", "objectStoreNames", "fireRemainders", "remainders", "everything", "awaitIterator", "iterator", "callNext", "doThrow", "onSuccess", "step", "onError", "getNext", "next", "extractTransactionArgs", "_tableArgs_", "scopeFunc", "enterTransactionScope", "parentTransaction", "scopeFuncIsAsync", "pad", "createVirtualIndexMiddleware", "indexLookup", "allVirtualIndexes", "addVirtualIndexes", "keyTail", "lowLevelIndex", "keyPathAlias", "indexList", "keyLength", "isVirtual", "virtualIndex", "virtualKeyPath", "findBestIndex", "translateRange", "translateRequest", "createVirtualCursor", "_continue", "virtualIndexMiddleware", "getObjectDiff", "prfx", "ap", "bp", "apTypeName", "bpTypeName", "getEffectiveKeys", "hooksMiddleware", "downCore", "downTable", "dxTrans", "deleting", "creating", "updating", "addPutOrDelete", "deleteRange", "getExistingValues", "existingValues", "contexts", "existingValue", "generatedPrimaryKey", "objectDiff", "additionalChanges", "requestedValue", "deleteNextChunk", "effectiveKeys", "getFromTransactionCache", "clone", "cacheExistingValuesMiddleware", "core", "cachedResult", "isCachableContext", "isCachableRequest", "observabilityMiddleware", "FULL_RANGE", "indexesWithAutoIncPK", "tableClone", "mutatedParts", "getRangeSet", "pkRangeSet", "delsRangeSet", "newObjs", "id", "oldCache", "oldObjs", "trackAffectedIndexes", "idxVals", "pkPos", "pk", "getRange", "readSubscribers", "method", "subscr", "isLiveQuery", "obsSet", "queriedIndex", "queriedRanges", "keysPromise", "resultingKeys", "pKeys", "wantValues", "pkey", "addAffectedIndex", "addKeyOrKeys", "_", "oldKey", "newKey", "adjustOptimisticFromFailures", "numBulkOps", "isAboveLower", "isBelowUpper", "isWithinRange", "applyOptimisticOps", "ops", "cacheEntry", "immutable", "queryRange", "extractPrimKey", "extractIndex", "extractLowLevelIndex", "finalResult", "op", "modifedResult", "includedValues", "includedPKs", "keySet", "keysToDelete", "areRangesEqual", "r1", "r2", "compareLowers", "lower1", "lower2", "lowerOpen1", "lowerOpen2", "compareUppers", "upper1", "upper2", "upperOpen1", "upperOpen2", "isSuperRange", "findCompatibleQuery", "queries", "equalEntry", "countQuery", "subscribeToCacheEntry", "container", "signal", "enqueForDeletion", "cacheMiddleware", "ac", "endTransaction", "wasCommitted", "affectedSubscribers", "freezeResults", "modRes", "reqWithResolvedKeys", "valueWithKey", "adjustedReq", "exactMatch", "vipify", "vipDb", "receiver", "_Dexie$1", "deps", "addons", "subscribe", "bSticky", "unsubscribe", "vipDB", "tx", "addon", "versionInstance", "stack", "level", "mw", "disableAutoOpen", "closeOptions", "hasInvalidArguments", "doDelete", "onlyIfCompatible", "idbMode", "enterTransaction", "symbolObservable", "Observable", "complete", "domDeps", "liveQuery", "querier", "hasValue", "currentValue", "observable", "observer", "execute", "closed", "abortController", "accumMuts", "currentObs", "subscription", "startedListening", "mutationListener", "doQuery", "_doQuery", "shouldNotify", "Dexie", "databaseName", "generatorFn", "promiseOrFunction", "optionalTimeout", "propagatingLocally", "detail", "propagateLocally", "updateParts", "wasMe", "bc", "createBC", "changedParts", "DexiePromise", "mapError", "setDebug", "debug", "Option", "_Option", "inner", "value", "matcher", "fn", "t", "Result", "_Result", "inner", "value", "error", "matcher", "fn", "t", "e", "Option", "_", "Ok", "Err", "createBook", "userId", "bookId", "cover", "BOOKS", "database", "Dexie$1", "getBookshelves", "Ok", "getBooks", "id", "Err", "CACHE_NAME", "fetchHandler", "responseApi", "data", "responseError", "status", "code", "message", "responseNotFound", "responseInternal", "intoResponse", "result", "value", "error", "bookshelves", "request", "_", "getBookshelves", "bookshelf", "params", "getBooks", "handlers", "path_default", "url", "path", "handler", "parsed", "event", "jobs", "key", "cachedPaths", "cache", "_event"]
}
